<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"h01iday.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="SSRF服务器端请求伪造01产生漏洞的函数file_get_contents()具体说明：​        file_get_contents( string $filename） ​        filename是文件或URL的名称。 函数作用：​        将整个文件读入一个字符串 要求：​        需要将php.ini的allow_url_fopen设置为On 测试：​">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://h01iday.github.io/2021/10/10/SSRF/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="SSRF服务器端请求伪造01产生漏洞的函数file_get_contents()具体说明：​        file_get_contents( string $filename） ​        filename是文件或URL的名称。 函数作用：​        将整个文件读入一个字符串 要求：​        需要将php.ini的allow_url_fopen设置为On 测试：​">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf3.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf2.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf4.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf5.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf6.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf7.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf8.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf9.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf10.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf11.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf12.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/gopher.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf13.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf14.png">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf15.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf16.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf17.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf18.png">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf19.jpg">
<meta property="og:image" content="d:/blog/H01iday/source/_posts/pics/ssrf20.jpg">
<meta property="og:image" content="d:/blog/H01iday/source_posts/pics/ssrf22.jpg">
<meta property="article:published_time" content="2021-10-10T11:36:14.672Z">
<meta property="article:modified_time" content="2021-10-25T05:01:29.881Z">
<meta property="article:author" content="H01iday">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="d:/blog/H01iday/source_posts/pics/ssrf3.png">


<link rel="canonical" href="https://h01iday.github.io/2021/10/10/SSRF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://h01iday.github.io/2021/10/10/SSRF/","path":"2021/10/10/SSRF/","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title> | Hexo</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SSRF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="nav-number">1.</span> <span class="nav-text">SSRF服务器端请求伪造</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#01%E4%BA%A7%E7%94%9F%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.</span> <span class="nav-text">01产生漏洞的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#file-get-contents"><span class="nav-number">1.1.1.</span> <span class="nav-text">file_get_contents()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">具体说明：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">函数作用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A6%81%E6%B1%82%EF%BC%9A"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">要求：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%9A"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">测试：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#readfile"><span class="nav-number">1.1.2.</span> <span class="nav-text">readfile()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AF%B4%E6%98%8E%EF%BC%9A-1"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">具体说明：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fsockopen"><span class="nav-number">1.1.3.</span> <span class="nav-text">fsockopen()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AF%B4%E6%98%8E%EF%BC%9A-2"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">具体说明：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%EF%BC%9A-1"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">函数作用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%9A-1"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">测试：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl-exec"><span class="nav-number">1.1.4.</span> <span class="nav-text">curl_exec()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AF%B4%E6%98%8E%EF%BC%9A-3"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">具体说明：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%EF%BC%9A-2"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">函数作用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%9A-2"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">测试：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#02%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.2.</span> <span class="nav-text">02常用的协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#File%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.2.1.</span> <span class="nav-text">File协议：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">作用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%EF%BC%9A"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">格式：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.2.2.</span> <span class="nav-text">http协议：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%EF%BC%9A-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">作用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">例子：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gopher%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.2.3.</span> <span class="nav-text">gopher协议：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dict%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.2.4.</span> <span class="nav-text">dict协议：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">如何使用？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%EF%BC%9F"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">常用命令？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A-1"><span class="nav-number">1.2.4.4.</span> <span class="nav-text">例子：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#03curl%E5%86%85%E5%AE%B9"><span class="nav-number">1.3.</span> <span class="nav-text">03curl内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#04%E6%BC%8F%E6%B4%9E%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.4.</span> <span class="nav-text">04漏洞出现的位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#05%E5%A6%82%E4%BD%95%E9%98%B2%E5%BE%A1"><span class="nav-number">1.5.</span> <span class="nav-text">05如何防御</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#06%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="nav-number">1.6.</span> <span class="nav-text">06过滤绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#url%E6%A0%BC%E5%BC%8F%EF%BC%9A"><span class="nav-number">1.6.1.</span> <span class="nav-text">url格式：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A0%E6%9B%B4%E6%94%B9ip%E5%9C%B0%E5%9D%80%E5%86%99%E6%B3%95%EF%BC%9A"><span class="nav-number">1.6.2.</span> <span class="nav-text">①更改ip地址写法：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B9%E5%8F%98%E7%BC%96%E7%A0%81"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">改变编码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91127-0-0-1%E7%9A%84%E5%85%B6%E5%AE%83%E8%A1%A8%E7%A4%BA"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">指向127.0.0.1的其它表示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A1%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%90%E5%88%B0%E5%86%85%E7%BD%91%E7%9A%84%E5%9F%9F%E5%90%8D"><span class="nav-number">1.6.3.</span> <span class="nav-text">②使用解析到内网的域名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A2%E5%88%A9%E7%94%A8%E8%A7%A3%E6%9E%90URL%E6%89%80%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">1.6.4.</span> <span class="nav-text">③利用解析URL所出现的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8readfile%E5%92%8Cparse-url%E5%87%BD%E6%95%B0%E7%9A%84%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E7%BB%95%E8%BF%87%E6%8C%87%E5%AE%9A%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">利用readfile和parse_url函数的解析差异绕过指定的端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8curl%E5%92%8Cparse-url%E7%9A%84%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E7%BB%95%E6%8C%87%E5%AE%9A%E7%9A%84host"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">利用curl和parse_url的解析差异绕指定的host</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A3DNS-Rebinding"><span class="nav-number">1.6.5.</span> <span class="nav-text">④DNS Rebinding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A4%E5%88%A9%E7%94%A8IPv6"><span class="nav-number">1.6.6.</span> <span class="nav-text">⑤利用IPv6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PortSwigger"><span class="nav-number">1.7.</span> <span class="nav-text">PortSwigger</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%94%BB%E5%87%BB%E5%BD%93%E5%89%8D%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.7.1.</span> <span class="nav-text">1. 攻击当前服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%94%BB%E5%87%BB%E5%85%B6%E5%AE%83%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.7.2.</span> <span class="nav-text">2. 攻击其它后端服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%9F%BA%E4%BA%8E%E9%BB%91%E5%90%8D%E5%8D%95%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6%E7%9A%84SSRF%E7%BB%95%E8%BF%87"><span class="nav-number">1.7.3.</span> <span class="nav-text">3. 基于黑名单防御机制的SSRF绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6%E7%9A%84SSRF%E7%BB%95%E8%BF%87"><span class="nav-number">1.7.4.</span> <span class="nav-text">4. 基于白名单防御机制的SSRF绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8Fdirsearch"><span class="nav-number">1.8.</span> <span class="nav-text">目录扫描dirsearch</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">H01iday</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://h01iday.github.io/2021/10/10/SSRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="H01iday">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-10 19:36:14" itemprop="dateCreated datePublished" datetime="2021-10-10T19:36:14+08:00">2021-10-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-10-25 13:01:29" itemprop="dateModified" datetime="2021-10-25T13:01:29+08:00">2021-10-25</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="SSRF服务器端请求伪造"><a href="#SSRF服务器端请求伪造" class="headerlink" title="SSRF服务器端请求伪造"></a>SSRF服务器端请求伪造</h1><h2 id="01产生漏洞的函数"><a href="#01产生漏洞的函数" class="headerlink" title="01产生漏洞的函数"></a>01产生漏洞的函数</h2><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h3><h4 id="具体说明："><a href="#具体说明：" class="headerlink" title="具体说明："></a>具体说明：</h4><p>​        file_get_contents( string <code>$filename</code>）</p>
<p>​        filename是文件或URL的名称。</p>
<h4 id="函数作用："><a href="#函数作用：" class="headerlink" title="函数作用："></a>函数作用：</h4><p>​        将整个文件读入一个字符串</p>
<h4 id="要求："><a href="#要求：" class="headerlink" title="要求："></a>要求：</h4><p>​        需要将php.ini的allow_url_fopen设置为On</p>
<h4 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h4><p>​        测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];;</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ssrf3.png" alt="ssrf3"></p>
<p><img src="D:\blog\H01iday\source_posts\pics\ssrf2.png" alt="ssrf2"></p>
<h3 id="readfile"><a href="#readfile" class="headerlink" title="readfile()"></a>readfile()</h3><h4 id="具体说明：-1"><a href="#具体说明：-1" class="headerlink" title="具体说明："></a>具体说明：</h4><p>readfile(filename）</p>
<p>该函数和file_get_contents函数用法类似。</p>
<p>如果在 php.ini 文件中 “fopen wrappers” 已经被激活，可以在本函数中把 URL 作为文件名来使用。</p>
<h3 id="fsockopen"><a href="#fsockopen" class="headerlink" title="fsockopen()"></a>fsockopen()</h3><h4 id="具体说明：-2"><a href="#具体说明：-2" class="headerlink" title="具体说明："></a>具体说明：</h4><p>fsockopen(string <code>$hostname</code>, int <code>$port</code> = -1, int <code>&amp;$errno</code> = ?, string <code>&amp;$errstr</code> = ?, float <code>$timeout</code> = ini_get(“default_socket_timeout”)）<br>    $hostname：要进行连接的主机地址</p>
<p>​    $port：端口号。默认为-1表示不使用端口</p>
<p>​    $errno：如果<code>errno</code>的返回值为<code>0</code>，而且这个函数的返回值为**<code>false</code>**，那么这表明该错误发生在套接字连接（<code>connect()</code>）调用之前</p>
<p>​    $errstr：错误信息以字符串的信息返回。</p>
<p>​    $timeout：设置连接的时限，单位为秒</p>
<h4 id="函数作用：-1"><a href="#函数作用：-1" class="headerlink" title="函数作用："></a>函数作用：</h4><p>​    打开一个网络连接或者一个Unix套接字连接</p>
<p>​    fsockopen()将返回一个文件句柄，之后可以被其他文件类函数调用（例如：fgets()，fgetss()，fwrite()，fclose()还有feof()）。</p>
<h4 id="测试：-1"><a href="#测试：-1" class="headerlink" title="测试："></a>测试：</h4><p>​    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$fp</span> = fsockopen(<span class="variable">$host</span>, <span class="number">80</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (<span class="subst">$errno</span>)&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$out</span> = <span class="string">&quot;GET / HTTP/1.1\r\n&quot;</span>;</span><br><span class="line">    <span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>;</span><br><span class="line">    <span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>;</span><br><span class="line">    fwrite(<span class="variable">$fp</span>, <span class="variable">$out</span>);</span><br><span class="line">    <span class="keyword">while</span> (!feof(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> fgets(<span class="variable">$fp</span>, <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(<span class="variable">$fp</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ssrf4.png" alt="ssrf4"></p>
<h3 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a>curl_exec()</h3><h4 id="具体说明：-3"><a href="#具体说明：-3" class="headerlink" title="具体说明："></a>具体说明：</h4><p>​        见03curl内容</p>
<h4 id="函数作用：-2"><a href="#函数作用：-2" class="headerlink" title="函数作用："></a>函数作用：</h4><p>​        执行cURL 会话</p>
<h4 id="测试：-2"><a href="#测试：-2" class="headerlink" title="测试："></a>测试：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$link</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">	<span class="variable">$curlobj</span> = curl_init(); <span class="comment">// 创建新的 cURL 资源</span></span><br><span class="line">	</span><br><span class="line">	curl_setopt(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>); <span class="comment">// 设置 URL 和相应的选项</span></span><br><span class="line">	</span><br><span class="line">	<span class="variable">$result</span>=curl_exec(<span class="variable">$curlobj</span>); <span class="comment">// 抓取 URL 并把它传递给浏览器</span></span><br><span class="line">	</span><br><span class="line">	curl_close(<span class="variable">$curlobj</span>); <span class="comment">// 关闭 cURL 资源，并且释放系统资源</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ssrf5.png" alt="ssrf5"></p>
<h2 id="02常用的协议"><a href="#02常用的协议" class="headerlink" title="02常用的协议"></a>02常用的协议</h2><p>以下所有协议用的测试代码，都是借助curl_exec来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$link</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">	<span class="variable">$curlobj</span> = curl_init(); <span class="comment">// 创建新的 cURL 资源</span></span><br><span class="line">	</span><br><span class="line">	curl_setopt(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>); <span class="comment">// 设置 URL 和相应的选项</span></span><br><span class="line">	</span><br><span class="line">	<span class="variable">$result</span>=curl_exec(<span class="variable">$curlobj</span>); <span class="comment">// 抓取 URL 并把它传递给浏览器</span></span><br><span class="line">	</span><br><span class="line">	curl_close(<span class="variable">$curlobj</span>); <span class="comment">// 关闭 cURL 资源，并且释放系统资源</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="File协议："><a href="#File协议：" class="headerlink" title="File协议："></a>File协议：</h3><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p>​        主要用于访问本地计算机中的文件。</p>
<h4 id="格式："><a href="#格式：" class="headerlink" title="格式："></a>格式：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file:///文件路径</span><br><span class="line">e.g：file:///E:/txt/index.txt</span><br></pre></td></tr></table></figure>



<p><img src="D:\blog\H01iday\source_posts\pics\ssrf6.png" alt="ssrf6"></p>
<h3 id="http协议："><a href="#http协议：" class="headerlink" title="http协议："></a>http协议：</h3><h4 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h4><p>​        探测内网主机存活。一般是先想办法得到目标主机的网络配置信息，如读取/etc/hosts、/proc/net/arp、/proc/net/fib_trie等文件，从而获得目标主机的内网网段并进行爆破。</p>
<p>​        hosts文件包含了ip地址与主机名之间的映射，还包括主机的别名。</p>
<h4 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h4><p>图中栗子是，已知外网ip为43.233。获取内网网段ip并且探测内网网段哪些ip地址的主机是存活的。</p>
<p>​    <img src="D:\blog\H01iday\source_posts\pics\ssrf7.png" alt="ssrf7"></p>
<p>我本地的栗子是，在iwebsec的虚拟机上实验。【外网ip192.168.201.132】</p>
<p>①通过file协议读取/etc/hosts文件，获得内网网段信息</p>
<p><img src="D:\blog\H01iday\source_posts\pics\ssrf8.png" alt="ssrf8"></p>
<p>②使用burp，探测172.17.0.x哪些ip地址的主机存活。</p>
<img src="D:\blog\H01iday\source\_posts\pics\ssrf9.png" alt="ssrf9" style="zoom:80%;" />

<img src="D:\blog\H01iday\source\_posts\pics\ssrf10.png" alt="ssrf9" style="zoom: 67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\ssrf11.png" alt="ssrf9" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\ssrf12.png" alt="ssrf9" style="zoom:67%;" />

<p>可以发现内网【172.17.0.1和172.17.0.2两台主机存活】</p>
<h3 id="gopher协议："><a href="#gopher协议：" class="headerlink" title="gopher协议："></a>gopher协议：</h3><p>​            <strong>是什么？</strong></p>
<p>​            它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。Gopher协议支持发出GET、POST请求【默认端口为70】</p>
<p>​            <strong>限制？</strong></p>
<p><img src="D:\blog\H01iday\source_posts\pics\gopher.png" alt="gopher"></p>
<p>​            <strong>如何使用？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</span><br></pre></td></tr></table></figure>

<p>​            <strong>Gopher发送HTTP GET请求？</strong></p>
<p>​                 1&gt;构造HTTP数据包</p>
<p>​                2&gt;URL编码、替换回车换行为%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码</p>
<p>​                3&gt;发送gopher协议</p>
<p>​                注意要素：</p>
<p>​                问号（？）需要转码为URL编码，也就是%3f<br>​                回车换行要变为%0d%0a,但如果直接用工具转，可能只会有%0a<br>​                在HTTP包的最后要加%0d%0a，代表消息结束（具体可研究HTTP包结束）</p>
<p>​                php代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hello &quot;</span>.<span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>].<span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                GET型的HTTP包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /ssrf/base/get.php?name=Margin HTTP/1.1</span><br><span class="line">Host: 192.168.201.1</span><br></pre></td></tr></table></figure>

<p>​            利用该脚本进行进一步生成符合Gopher格式的payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">payload =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;GET /echo.php?whoami=Bunny HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 47.xxx.xxx.72</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line"><span class="comment"># 注意后面一定要有回车，回车结尾表示http请求结束</span></span><br><span class="line">tmp = urllib.parse.quote(payload)<span class="comment"># 注意我在kali python2.7写法为urllib.quote(payload)</span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://47.xxx.xxx.72:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>​                URL编码：</p>
<p>注意gopher协议似乎只能在linux下支持。我在windows下尝试不成功，在kali下即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://192.168.201.1:80/_GET%20/ssrf/base/get.php%3fname=Margin%20HTTP/1.1%0d%0AHost:%20192.168.201.1%0d%0A</span><br><span class="line"></span><br><span class="line">成功得到结果 HelloMargin</span><br></pre></td></tr></table></figure>

<p>​            <strong>Gopher发送HTTP POST请求？</strong></p>
<p>​            php代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// echo.php</span><br><span class="line">&lt;?php</span><br><span class="line">echo &quot;Hello &quot;.$_POST[&quot;whoami&quot;].&quot;\n&quot;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>​            POST型的数据包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /echo.php HTTP/1.1</span><br><span class="line">Host: 47.xxx.xxx.72</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 12</span><br><span class="line"></span><br><span class="line">whoami=Bunny</span><br></pre></td></tr></table></figure>

<p>【<strong>上面那四个HTTP头是POST请求必须的，即POST、Host、Content-Type和Content-Length。如果少了会报错的，而GET则不用。并且，特别要注意Content-Length应为字符串“whoami=Bunny”的长度。</strong>】</p>
<p>​            URL编码：</p>
<p>编码和GET方式一样的脚本，成功执行得到 HelloBunny</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://47.xxx.xxx.72:80/_POST%20/echo.php%20HTTP/1.1%0D%0AHost%3A%2047.xxx.xxx.72%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%2012%0D%0A%0D%0Awhoami%3DBunny%0D%0A</span><br></pre></td></tr></table></figure>



<h3 id="dict协议："><a href="#dict协议：" class="headerlink" title="dict协议："></a>dict协议：</h3><h4 id="是什么？"><a href="#是什么？" class="headerlink" title="是什么？"></a>是什么？</h4><p>​            DICT is a dictionary network protocol. Its goal is to allow clients to <strong>access a variety of dictionaries</strong> via a uniform interface.The protocol consists of a few commands a server must recognize so a client can access the available data and <strong>lookup word definitions</strong>. </p>
<h4 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a><strong>如何使用？</strong></h4><p>​            A dictd server can be used from Telnet.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet dict.org 2628</span><br></pre></td></tr></table></figure>

<p><code>这个协议架设的服务可以用 telnet 来登陆，说明这个协议应该是基于 tcp 协议开发的。</code></p>
<p><code>所以像 mysql 的服务，因为也是基于 tcp 协议开发，所以用 dict 协议的方式打开也能强行读取一些 mysql 服务的返回内容</code></p>
<h4 id="常用命令？"><a href="#常用命令？" class="headerlink" title="常用命令？"></a><strong>常用命令？</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h：可以获取帮助</span><br><span class="line">show db：列出所有的字典</span><br><span class="line">define [字典名][单词]：获取一个单词的解释（例：define english hello）</span><br></pre></td></tr></table></figure>

<h4 id="例子：-1"><a href="#例子：-1" class="headerlink" title="例子："></a>例子：</h4><p>​    通过dict协议来查看内网主机上<strong>开放的端口</strong>及端口上运行服务的<strong>版本</strong>信息等</p>
<img src="D:\blog\H01iday\source\_posts\pics\ssrf13.png" alt="ssrf13" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\ssrf14.png" alt="ssrf14" style="zoom:67%;" />

<img src="D:\blog\H01iday\source\_posts\pics\ssrf15.png" alt="ssrf15" style="zoom:67%;" />

<h2 id="03curl内容"><a href="#03curl内容" class="headerlink" title="03curl内容"></a>03curl内容</h2><ol>
<li><p>curl_init() — 初始化 cURL 会话，创建一个新cURL资源</p>
</li>
<li><p>curl_setopt ( resource $ch , int $option , mixed $value )<br>为给定的cURL会话句柄设置一个选项。</p>
<p>ch：由 curl_init() 返回的 cURL 句柄。</p>
<p>option：需要设置的CURLOPT_XXX选项。</p>
<p>value：将设置在option选项上的值</p>
<p>curl_setopt($ch, CURLOPT_URL, ‘<a target="_blank" rel="noopener" href="http://www.baidu.com&/#39;);%E8%AE%BE%E5%AE%9A%E8%AF%B7%E6%B1%82%E7%9A%84URL">www.baidu.com&#39;);设定请求的URL</a></p>
</li>
<li><p>curl_exec($ch)执行一个cURL会话</p>
</li>
<li><p>curl_close($ch)关闭一个surl会话</p>
</li>
</ol>
<h2 id="04漏洞出现的位置"><a href="#04漏洞出现的位置" class="headerlink" title="04漏洞出现的位置"></a>04漏洞出现的位置</h2><p>只要是服务器可以主动发起网络请求便可能出现</p>
<h2 id="05如何防御"><a href="#05如何防御" class="headerlink" title="05如何防御"></a>05如何防御</h2><p>​    ①过滤返回信息</p>
<p>​            验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>
<p>​    ②统一错误信息</p>
<p>​            避免用户可以根据错误信息来判断远程服务器的端口状态。</p>
<p>​    ③限制请求的端口为http常用的端口</p>
<p>​            比如，80,443,8080,8090</p>
<p>​    ④黑名单内网IP</p>
<p>​            限制不能访问内网的ip，防止对内网进行攻击</p>
<p>​    ⑤禁用不需要的协议</p>
<p>​            仅仅允许http和https请求。</p>
<p>​    ⑥限制域名</p>
<p>​            限制访问的域名只能为<code>http://www.xxx.com</code></p>
<h2 id="06过滤绕过"><a href="#06过滤绕过" class="headerlink" title="06过滤绕过"></a>06过滤绕过</h2><h3 id="url格式："><a href="#url格式：" class="headerlink" title="url格式："></a>url格式：</h3><p>格式：<code>URI = scheme:[//authority]path[?query] [#fragment]</code></p>
<pre><code>       `authority = [userinfo@]host[:port]`
</code></pre>
<p>​            1)scheme：协议include <code>http</code>, <code>https</code>, <code>ftp</code>, <code>mailto</code>, <code>file</code>, <code>data</code>, and <code>irc</code></p>
<p>​            2)authority：①userinfo：[username:password] ②host：将访问的域名/ip地址</p>
<p>​            3)query</p>
<table>
<thead>
<tr>
<th>Query delimiter</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>Ampersand (<code>&amp;</code>)</td>
<td><code>key1=value1&amp;key2=value2</code></td>
</tr>
<tr>
<td>Semicolon (<code>;</code>)</td>
<td><code>key1=value1;key2=value2</code></td>
</tr>
</tbody></table>
<h3 id="①更改ip地址写法："><a href="#①更改ip地址写法：" class="headerlink" title="①更改ip地址写法："></a>①更改ip地址写法：</h3><h4 id="改变编码"><a href="#改变编码" class="headerlink" title="改变编码"></a>改变编码</h4><p>一些开发者会通过对传过来的URL参数进行<strong>正则匹配</strong>的方式来过滤掉内网IP，<strong>如采用如下正则表达式</strong>：</p>
<p>内网ip：</p>
<ul>
<li>C类：192.168.0.0 - 192.168.255.255</li>
<li>B类：172.16.0.0 - 172.31.255.255</li>
<li>A类：10.0.0.0 - 10.255.255.255</li>
</ul>
<p><code>^10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d))&#123;3&#125;$</code></p>
<p>200-249           250-255        [01]?：要有0/1中的0位或1位   故至少1位至多3位，且3位的是以0/1开头</p>
<p><code>^172\.([1][6-9]|[2]\d|3[01])(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d))&#123;2&#125;$</code></p>
<p><code>^192\.168(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d))&#123;2&#125;$</code></p>
<p>这三句就是过滤掉所有的内网ip地址</p>
<p>这种过滤方式可以改变ip地址写法来绕过：</p>
<p>比如地址：192.168.201.132</p>
<p>8进制：0300.0250.0311.0204【八进制数是0开头表示，这里的0是一个符号】</p>
<p>16进制：0xc0.0xa8.0xc9.0x84</p>
<p>10进制：3232287108</p>
<p>…</p>
<p>另外IP中的每一位，各个进制可以混用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进制转换代码</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;192.168.201.132&#x27;</span>;</span><br><span class="line"><span class="variable">$ip</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$ip</span>);</span><br><span class="line"><span class="variable">$r</span> = (<span class="variable">$ip</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (<span class="variable">$ip</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (<span class="variable">$ip</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | <span class="variable">$ip</span>[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$r</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="variable">$r</span> += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;十进制:&quot;</span>;     <span class="comment">// 2130706433</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$r</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;八进制:&quot;</span>;     <span class="comment">// 0177.0.0.1</span></span><br><span class="line"><span class="keyword">echo</span> decoct(<span class="variable">$r</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;十六进制:&quot;</span>;   <span class="comment">// 0x7f.0.0.1</span></span><br><span class="line"><span class="keyword">echo</span> dechex(<span class="variable">$r</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="指向127-0-0-1的其它表示"><a href="#指向127-0-0-1的其它表示" class="headerlink" title="指向127.0.0.1的其它表示"></a>指向127.0.0.1的其它表示</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/         # localhost就是代指127.0.0.1</span><br><span class="line">http://[0:0:0:0:0:ffff:127.0.0.1]/</span><br><span class="line">http://127。0。0。1/       # 用中文句号绕过</span><br><span class="line">http://①②⑦.⓪.⓪.①</span><br><span class="line">http://127.1/			  #仅windows可</span><br><span class="line">http://127.00000.00000.001/ # 0的数量多一点少一点都没影响 仅windows可</span><br></pre></td></tr></table></figure>

<h3 id="②使用解析到内网的域名"><a href="#②使用解析到内网的域名" class="headerlink" title="②使用解析到内网的域名"></a>②使用解析到内网的域名</h3><p>如果服务端直接过滤内网ip地址，而不是先将域名解析成ip再过滤内网地址。那么我们可以不使用内网ip地址，而是使用解析到内网的域名。比如，不用127.0.0.1，可以用localhost</p>
<p><strong>利用跳转302</strong></p>
<p>​            ①<code>http://nip.io</code> <code>http://sslip.io</code>这两个网址有特殊的功能</p>
<p>​            举个栗子：</p>
<p>​                10.0.0.1.nip.io   maps to   10.0.0.1</p>
<p>​                即访问10.0.0.1.nip.io会重定向到10.0.0.1。还有一些用法可以到上面的网址上具体看</p>
<p>​            ②<code>https://4m.cn/</code>短地址跳转绕过。这个就是输入一个地址A会生成一个短地址B。访问短地址B会自动302跳转到地址A。</p>
<p>​                </p>
<h3 id="③利用解析URL所出现的问题"><a href="#③利用解析URL所出现的问题" class="headerlink" title="③利用解析URL所出现的问题"></a>③利用解析URL所出现的问题</h3><p>​        当后端程序对访问的URL进行解析，可能对解析出来的host地址进行过滤。</p>
<p>​        通过解析URL不当，我们可以进行绕过</p>
<p>​        举个栗子：</p>
<p>​        <code>http://www.baidu.com@192.168.0.1/</code></p>
<p>​        当后端程序通过不正确的正则表达式（比如将http之后到com为止的字符内容)当作是host地址时，那么这里就会将<code>www.baidu.com</code>当作host地址。</p>
<p>​        而实际上url真正解析会将<code>www.baidu.com</code>解析为userinfo用户信息，真正的host其实时192.168.0.1。利用后端程序进行过滤时解析url不当的漏洞，实现绕过。</p>
<h4 id="利用readfile和parse-url函数的解析差异绕过指定的端口"><a href="#利用readfile和parse-url函数的解析差异绕过指定的端口" class="headerlink" title="利用readfile和parse_url函数的解析差异绕过指定的端口"></a><strong>利用readfile和parse_url函数的解析差异绕过指定的端口</strong></h4><p>​        1）关于parse_url函数</p>
<p>​                parse_url(string <code>$url</code>, int <code>$component</code> )</p>
<p>​                解析url，返回关联数组，包含url的各个部分。</p>
<p>​                component：</p>
<p>​                指定 PHP_URL_SCHEME、 PHP_URL_HOST、 PHP_URL_PORT、 PHP_URL_USER、 PHP_URL_PASS、 PHP_URL_PATH、 PHP_URL_QUERY 或 PHP_URL_FRAGMENT 的其中一个来获取 URL 中指定的部分的内容。</p>
<p>​                举个栗子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://username:password@hostname/path?arg=value#anchor&#x27;</span>;</span><br><span class="line"></span><br><span class="line">print_r(parse_url(<span class="variable">$url</span>));<span class="comment">//output:Array ( [scheme] =&gt; http [host] =&gt; hostname [user] =&gt; username [pass] =&gt; password [path] =&gt; /path [query] =&gt; arg=value [fragment] =&gt; anchor )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> parse_url(<span class="variable">$url</span>, PHP_URL_HOST);<span class="comment">//output:hostname</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        2）来看实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://&#x27;</span>. <span class="variable">$_GET</span>[url];</span><br><span class="line"><span class="variable">$parsed</span> = parse_url(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>( <span class="variable">$parsed</span>[port] == <span class="number">80</span> )&#123;  <span class="comment">// 这里限制了我们传过去的url只能是80端口的</span></span><br><span class="line">	readfile(<span class="variable">$url</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;Hacker!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\blog\H01iday\source_posts\pics\ssrf16.png" alt="ssrf16"></p>
<p>【simplehttpserver是什么：用于从一个电脑向另一个电脑传送文件的模块。使用方法：①进入待分享的目录，执行命令<code>python -m SimpleHTTPServer 端口号</code>  注意：大小写一定要区分。不填端口号则默认使用8000端口。 ②通过浏览器访问该主机的地址<a href="http://IP:端口号/文件名】">http://IP:端口号/文件名】</a></p>
<p>执行die</p>
<p><img src="D:\blog\H01iday\source_posts\pics\ssrf17.png" alt="ssrf17"></p>
<p>执行readfile</p>
<p><img src="D:\blog\H01iday\source_posts\pics\ssrf18.png" alt="ssrf18"></p>
<p>原因：parse_url解析的时候，认为后面的80为端口号。通过检验</p>
<p>​            而readfile函数解析的时候，认为前面的11211为端口号，故访问的是11211端口</p>
<p>​            所以能够读到开启simpleHttpServer的目录下面的flag.txt文件</p>
<p><img src="D:\blog\H01iday\source_posts\pics\ssrf19.jpg" alt="ssrf19"></p>
<p>这两个函数在解析host的时候也有区别</p>
<img src="D:\blog\H01iday\source\_posts\pics\ssrf20.jpg" alt="ssrf20" style="zoom:67%;" />

<h4 id="利用curl和parse-url的解析差异绕指定的host"><a href="#利用curl和parse-url的解析差异绕指定的host" class="headerlink" title="利用curl和parse_url的解析差异绕指定的host"></a>利用curl和parse_url的解析差异绕指定的host</h4><p>​        <img src="D:\blog\H01iday\source_posts\pics\ssrf22.jpg" alt="ssrf22"></p>
<p>测试代码：</p>
<p>在parse_url检测ip合法性的时候，检测的是google.com部分</p>
<p>在执行的时候是通过curl执行。检测的host是evil.com:80部分</p>
<p>【但是现在的curl版本已经不能再进行这种操作了，打了补丁，我尝试了很多都不能复现。所以这个部分就看作是一个参考】</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);<span class="comment">//对文件进行语法高亮显示。</span></span><br><span class="line"><span class="comment">//该函数为过滤作用</span></span><br><span class="line"><span class="comment">//①是否为http/https协议</span></span><br><span class="line"><span class="comment">//②解析域名，看ip地址是否为内网地址</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_inner_ip</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$match_result</span>=preg_match(<span class="string">&#x27;/^(http|https)?:\/\/.*(\/)?.*$/&#x27;</span>,<span class="variable">$url</span>);</span><br><span class="line">    <span class="comment">//^匹配输入字符串的开始位置。</span></span><br><span class="line">    <span class="comment">//^在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合</span></span><br><span class="line">    <span class="comment">//$匹配输入字符串的结尾位置。</span></span><br><span class="line">    <span class="comment">//|两项之间的一个选择</span></span><br><span class="line">    <span class="comment">//?匹配前面的子表达式零次或一次</span></span><br><span class="line">    <span class="comment">//*匹配前面的子表达式零次或多次</span></span><br><span class="line">    <span class="comment">//.匹配除换行符 \n 之外的任何单字符</span></span><br><span class="line">    <span class="comment">//这里只允许http和https两种协议</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$match_result</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$url_parse</span>=parse_url(<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$hostname</span>=<span class="variable">$url_parse</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$ip</span>=gethostbyname(<span class="variable">$hostname</span>);<span class="comment">//通过域名返回主机名</span></span><br><span class="line">    <span class="variable">$int_ip</span>=ip2long(<span class="variable">$ip</span>);<span class="comment">//将 IPV4 的字符串互联网协议转换成长整型数字</span></span><br><span class="line">    <span class="keyword">return</span> ip2long(<span class="string">&#x27;127.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> ||</span><br><span class="line">            ip2long(<span class="string">&#x27;10.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> ||</span><br><span class="line">          ip2long(<span class="string">&#x27;172.16.0.0&#x27;</span>)&gt;&gt;<span class="number">20</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">20</span> ||</span><br><span class="line">          ip2long(<span class="string">&#x27;192.168.0.0&#x27;</span>)&gt;&gt;<span class="number">16</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">16</span>;</span><br><span class="line">          <span class="comment">// 检查是否是内网ip</span></span><br><span class="line">          <span class="comment">//$a &gt;&gt; $b将 $a 中的位向右移动 $b 次（每一次移动都表示“除以 2”）。</span></span><br><span class="line">          <span class="comment">//&gt;&gt;24其实就是显示前8位(2进制)</span></span><br><span class="line">          <span class="comment">//172.16.0.0 - 172.31.255.255前面16位</span></span><br><span class="line">          <span class="comment">//10101100 00010000</span></span><br><span class="line">          <span class="comment">//10101100 00011111</span></span><br><span class="line">          <span class="comment">//故可以知道只需要前面12位相同即可。即右移32-12=20位</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//访问给定url</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request_url</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//先检查是否安全</span></span><br><span class="line">    <span class="keyword">if</span> (check_inner_ip(<span class="variable">$url</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27; is inner ip&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">0</span>);<span class="comment">//使返回的内容作为变量储存，而不是直接输出。</span></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">1</span>);<span class="comment">//不反悔http 请求的response信息</span></span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$result_info</span> = curl_getinfo(<span class="variable">$ch</span>);<span class="comment">//获取CURL请求输出的相关信息  类型为数组</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>])<span class="comment">//如果有重定向函数，再进行一次检查；通过检查才能执行redirect跳转</span></span><br><span class="line">        &#123;</span><br><span class="line">            safe_request_url(<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line">        var_dump(<span class="variable">$output</span>);</span><br><span class="line">        print_r (<span class="variable">$result_info</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hahha&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;version:&quot;</span>;</span><br><span class="line">        print_r(curl_version());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">    safe_request_url(<span class="variable">$url</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="④DNS-Rebinding"><a href="#④DNS-Rebinding" class="headerlink" title="④DNS Rebinding"></a>④DNS Rebinding</h3><p>一个常用的防护思路是：对于用户请求的URL参数，首先服务器端会对其进行DNS解析，然后对于DNS服务器返回的IP地址进行判断，如果在黑名单中，就禁止该次请求。</p>
<p>但是在整个过程中，第一次去请求DNS服务进行域名解析到第二次服务端去请求URL之间存在一个时间差，利用这个时间差，可以进行DNS重绑定攻击。</p>
<p>要完成DNS重绑定攻击，我们需要一个域名，并且将这个域名的解析指定到我们自己的DNS Server，在我们的可控的DNS Server上编写解析服务，设置TTL时间为0。【生存时间(<em>TTL</em>),来定义数据在缓存中的存放时间,生存时间一到期,名称<em>服务器</em>就丢弃原有的缓存数据并从权威名称<em>服务器</em>获取新的数据。】这样就可以进行攻击了，完整的攻击流程为：</p>
<ul>
<li>服务器端获得URL参数，进行第一次DNS解析，获得了一个非内网的IP</li>
<li>对于获得的IP进行判断，发现为非黑名单IP，则通过验证</li>
<li>服务器端对于URL进行访问，由于DNS服务器设置的TTL为0，所以再次进行DNS解析，这一次DNS服务器返回的是内网地址。 </li>
<li>由于已经绕过验证，所以服务器端返回访问内网资源的结果。</li>
</ul>
<h3 id="⑤利用IPv6"><a href="#⑤利用IPv6" class="headerlink" title="⑤利用IPv6"></a>⑤利用IPv6</h3><p>有些服务没有考虑IPv6的情况，但是内网又支持IPv6，则可以使用IPv6的本地IP如 <code>[::]</code> <code>0000::1</code> 或IPv6的内网域名来绕过过滤。</p>
<h2 id="PortSwigger"><a href="#PortSwigger" class="headerlink" title="PortSwigger"></a>PortSwigger</h2><h3 id="1-攻击当前服务器"><a href="#1-攻击当前服务器" class="headerlink" title="1. 攻击当前服务器"></a>1. 攻击当前服务器</h3><h3 id="2-攻击其它后端服务器"><a href="#2-攻击其它后端服务器" class="headerlink" title="2. 攻击其它后端服务器"></a>2. 攻击其它后端服务器</h3><h3 id="3-基于黑名单防御机制的SSRF绕过"><a href="#3-基于黑名单防御机制的SSRF绕过" class="headerlink" title="3. 基于黑名单防御机制的SSRF绕过"></a>3. 基于黑名单防御机制的SSRF绕过</h3><h3 id="4-基于白名单防御机制的SSRF绕过"><a href="#4-基于白名单防御机制的SSRF绕过" class="headerlink" title="4. 基于白名单防御机制的SSRF绕过"></a>4. 基于白名单防御机制的SSRF绕过</h3><h2 id="目录扫描dirsearch"><a href="#目录扫描dirsearch" class="headerlink" title="目录扫描dirsearch"></a>目录扫描dirsearch</h2><p>简单使用【仅在python3.7及以上版本可用】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py -u https://target</span><br><span class="line">python3 dirsearch.py -e php,html,js -u https://target</span><br><span class="line">-u：url</span><br><span class="line">-e:表示文件的后缀名</span><br><span class="line">--exclude-status 503:指排除503状态码的内容</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/10/09/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" rel="prev" title="">
                  <i class="fa fa-chevron-left"></i> 
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/10/15/DNSpod/" rel="next" title="">
                   <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">H01iday</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
